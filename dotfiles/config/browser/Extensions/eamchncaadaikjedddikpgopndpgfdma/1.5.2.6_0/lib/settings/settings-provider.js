!function(e,a){const c=()=>{const e=a.filters.getEnabledFilters();return e.filter(e=>!e.customUrl).map(e=>e.filterId)},d=()=>{const e=a.subscriptions.getCustomFilters();return e.map(e=>({customUrl:e.customUrl,enabled:e.enabled,title:e.name||"",trusted:e.trusted}))},u=()=>{const e=a.subscriptions.getGroups();return e.filter(e=>e.enabled).map(e=>e.groupId)},n=e=>e.reduce((e,s)=>e.then(t=>(e=>{const{customUrl:i,title:r,trusted:n}=e;return new Promise((t,e)=>{var s={title:r,trusted:n};a.filters.loadCustomFilter(i,s,e=>{t(e)},()=>{e()})})})(s).then(e=>(a.console.info("Settings sync: Was added custom filter: "+e.customUrl),[...t,{error:null,filter:e}])).catch(()=>{var e=s["customUrl"],e="Settings sync: Some error happened while downloading: "+e;return a.console.info(e),[...t,{error:e}]})),Promise.resolve([])),o=e=>{const s=a.subscriptions.getCustomFilters(),t=e.map(t=>(s.forEach(e=>{e.customUrl===t.customUrl&&(t.filterId=e.filterId)}),t));var i=t.filter(e=>!e.filterId);const r=t.filter(e=>e.filterId);var e=((e,t)=>{const s=t.map(e=>e.customUrl),i=e.filter(e=>!s.includes(e.customUrl));return i.map(e=>e.filterId)})(s,e);return 0<e.length&&((e=e).forEach(e=>{a.filters.removeFilter(e)}),a.console.info("Settings sync: Next filters were removed: "+e)),0===i.length?Promise.resolve(t):n(i).then(e=>{const t=e.filter(e=>null===e.error).map(e=>e.filter);e=t.map(e=>e.filterId);return a.console.info("Settings sync: Were added custom filters: "+e),[...r,...t]})},l=i=>new Promise(s=>{a.filters.addAndEnableFilters(i,()=>{const e=a.filters.getEnabledFilters();var t=e.filter(e=>!i.includes(e.filterId)).map(e=>e.filterId);a.filters.disableFilters(t),s()})}),f=t=>{t.forEach(e=>{a.filters.enableGroup(e)}),a.console.info("Settings sync: Next groups were enabled: "+t);const e=a.subscriptions.getGroups(),s=e.map(e=>e.groupId).filter(e=>!t.includes(e));s.forEach(e=>{a.filters.disableGroup(e)})};e.settingsProvider={loadSettingsBackup:function(t){const s={"protocol-version":"1.0"};!function(e){const t=c();var s=0<=t.indexOf(a.utils.filters.ids.SEARCH_AND_SELF_PROMO_FILTER_ID);e({"general-settings":{"app-language":a.app.getLocale(),"allow-acceptable-ads":s,"show-blocked-ads-count":a.settings.showPageStatistic(),"autodetect-filters":a.settings.isAutodetectFilters(),"safebrowsing-enabled":a.settings.safebrowsingInfoEnabled(),"filters-update-period":a.settings.getFiltersUpdatePeriod()}})}(e=>{s["general-settings"]=e["general-settings"],(e=>{s["extension-specific-settings"]=e["extension-specific-settings"],(t=>{const s=c(),i=u(),r=d(),n=a.whitelist.getWhiteListedDomains()||[],o=a.whitelist.getBlockListedDomains()||[],l=!!a.whitelist.isDefaultMode();a.userrules.getUserRulesText(e=>{e={filters:{"enabled-groups":i,"enabled-filters":s,"custom-filters":r,"user-filter":{rules:e,"disabled-rules":""},whitelist:{inverted:!l,domains:n,"inverted-domains":o}}};t(e)})})(e=>{s.filters=e.filters,t(JSON.stringify(s))})})({"extension-specific-settings":{"use-optimized-filters":a.settings.isUseOptimizedFiltersEnabled(),"collect-hits-count":a.settings.collectHitsCount(),"show-context-menu":a.settings.showContextMenu(),"show-info-about-adguard":a.settings.isShowInfoAboutAdguardFullVersion(),"show-app-updated-info":a.settings.isShowAppUpdatedNotification()}})})},applySettingsBackup:function(t,s){function i(e){e?a.console.info("Settings import finished successfully"):a.console.error("Error importing settings"),a.listeners.notifyListeners(a.listeners.SETTINGS_UPDATED,e),s&&s(e)}let r=null;try{r=JSON.parse(t)}catch(e){return a.console.error("Error parsing input json {0}, {1}",t,e),void i(!1)}if(!r||"1.0"!==r["protocol-version"])return a.console.error("Json input is invalid {0}",t),void i(!1);!function(e,t){e=e["general-settings"];a.settings.changeShowPageStatistic(!!e["show-blocked-ads-count"]),a.settings.changeAutodetectFilters(!!e["autodetect-filters"]),a.settings.changeEnableSafebrowsing(!!e["safebrowsing-enabled"]),a.settings.setFiltersUpdatePeriod(e["filters-update-period"]),e["allow-acceptable-ads"]?a.filters.addAndEnableFilters([a.utils.filters.ids.SEARCH_AND_SELF_PROMO_FILTER_ID],()=>{t(!0)}):(a.filters.disableFilters([a.utils.filters.ids.SEARCH_AND_SELF_PROMO_FILTER_ID]),t(!0))}(r,e=>{e?function(e,t){e=e["extension-specific-settings"];a.settings.changeUseOptimizedFiltersEnabled(!!e["use-optimized-filters"]),a.settings.changeCollectHitsCount(!!e["collect-hits-count"]),a.settings.changeShowContextMenu(!!e["show-context-menu"]),a.settings.changeShowInfoAboutAdguardFullVersion(!!e["show-info-about-adguard"]),a.settings.changeShowAppUpdatedNotification(!!e["show-app-updated-info"]),t(!0)}(r,e=>{e?function(s,t){var e=s.filters.whitelist||{},i=e.domains||[],r=e["inverted-domains"]||[];a.whitelist.configure(i,r,!e.inverted);e=(s.filters["user-filter"]||{}).rules||"";a.userrules.updateUserRulesText(e);const n=s.filters["custom-filters"]||[];o(n).then(e=>{var t=e.filter(t=>{var e=n.find(e=>{if(!e.customUrl)throw new Error("Custom filter should always have custom URL: "+JSON.stringify(e));return e.customUrl===t.customUrl});return e&&e.enabled}).map(e=>e.filterId),e=s.filters["enabled-filters"]||[];return l([...e,...t])}).then(()=>{var e=s.filters["enabled-groups"]||[];f(e),t(!0)}).catch(e=>{a.console.error(e)})}(r,e=>{i(e)}):i(!1)}):i(!1)})}}}(adguard.sync,adguard);