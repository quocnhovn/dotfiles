!function(g){"use strict";var p=Object.create(null);function e(s,r,i){switch(s.type){case"unWhiteListFrame":g.userrules.unWhiteListFrame(s.frameInfo);break;case"addEventListener":return u=r,b=g.listeners.addSpecifiedListener(s.events,function(){var e=p[b];e&&g.tabs.sendMessage(e.tab.tabId,{type:"notifyListeners",args:Array.prototype.slice.call(arguments)})}),p[b]=u,{listenerId:b};case"removeListener":var a=s.listenerId;g.listeners.removeListener(a),delete p[a];break;case"initializeFrameScript":return function(){var e,t,s=Object.create(null),r=g.utils.filters.ids;for(e in r)r.hasOwnProperty(e)&&(t=r[e],g.filters.isFilterEnabled(t)&&(s[t]=!0));return{userSettings:g.settings.getAllSettings(),enabledFilters:s,filtersMetadata:g.subscriptions.getFilters(),requestFilterInfo:g.requestFilter.getRequestFilterInfo(),environmentOptions:{isMacOs:g.utils.browser.isMacOs(),canBlockWebRTC:g.stealthService.canBlockWebRTC(),isChrome:g.utils.browser.isChromeBrowser(),Prefs:{locale:g.app.getLocale(),mobile:g.prefs.mobile||!1},appVersion:g.app.getVersion()},constants:{AntiBannerFiltersId:g.utils.filters.ids,EventNotifierTypes:g.listeners.events}}}();case"changeUserSetting":g.settings.setProperty(s.key,s.value);break;case"checkRequestFilterReady":return{ready:g.requestFilter.isReady()};case"addAndEnableFilter":g.filters.addAndEnableFilters([s.filterId]);break;case"disableAntiBannerFilter":s.remove?g.filters.uninstallFilters([s.filterId]):g.filters.disableFilters([s.filterId]);break;case"removeAntiBannerFilter":g.filters.removeFilter(s.filterId);break;case"enableFiltersGroup":g.categories.enableFiltersGroup(s.groupId);break;case"disableFiltersGroup":g.categories.disableFiltersGroup(s.groupId);break;case"changeDefaultWhiteListMode":g.whitelist.changeDefaultWhiteListMode(s);break;case"changeWhiteListFilter":g.whitelist.changeWhiteListFilter();break;case"getWhiteListBtnStatus":i({status:g.whitelist.getWhiteListBtnStatus()});break;case"changeBlackListFilter":g.whitelist.changeBlackListFilter();break;case"getBlackListBtnStatus":i({status:g.whitelist.getBlackListBtnStatus()});break;case"getWhiteListDomains":a=g.whitelist.optionsUserWhiteListlData("get");i({content:a||""});break;case"getBlackListDomains":var n=g.whitelist.optionsUserBlackListlData("get");i({content:n});break;case"saveBlackListDomains":n=s.content.split(/[\r\n]+/).map(e=>e.trim()).filter(e=>0<e.length);g.whitelist.optionsUserBlackListlData("set",n),g.whitelist.filterWhiteListChange();break;case"saveWhiteListDomains":var o=s.content.split(/[\r\n]+/).map(e=>e.trim()).filter(e=>0<e.length);g.whitelist.optionsUserWhiteListlData("set",o),g.whitelist.filterWhiteListChange();break;case"getUserRules":return g.userrules.getUserRulesText(e=>{var t=g.app.getVersion();i({content:e,appVersion:t})}),!0;case"saveUserRules":g.userrules.updateUserRulesText(s.content);break;case"addUserRule":g.userrules.addRules([s.ruleText]);break;case"removeUserRule":g.userrules.removeRule(s.ruleText);break;case"checkAntiBannerFiltersUpdate":g.ui.checkFiltersUpdates();break;case"loadCustomFilterInfo":return g.filters.loadCustomFilterInfo(s.url,{title:s.title},e=>{i({filter:e})},e=>{i({error:e})}),!0;case"subscribeToCustomFilter":var{url:o,title:l,trusted:c}=s;return g.filters.loadCustomFilter(o,{title:l,trusted:c},e=>{g.filters.addAndEnableFilters([e.filterId],()=>{i(e)})},()=>{i()}),!0;case"getFiltersMetadata":return g.categories.getFiltersMetadata();case"setFiltersUpdatePeriod":g.settings.setFiltersUpdatePeriod(s.updatePeriod);break;case"openThankYouPage":g.ui.openThankYouPage();break;case"openExtensionStore":g.ui.openExtensionStore();break;case"openFilteringLog":g.ui.openFilteringLog(s.tabId);break;case"openExportRulesTab":g.ui.openExportRulesTab(s.hash);break;case"openSafebrowsingTrusted":g.safebrowsing.addToSafebrowsingTrusted(s.url),g.tabs.getActive(function(e){g.tabs.reload(e.tabId,s.url)});break;case"openTab":g.ui.openTab(s.url,s.options);break;case"resetBlockedAdsCount":g.frames.resetBlockedAdsCount();break;case"getSelectorsAndScripts":{let e;return e=g.utils.url.isHttpOrWsRequest(s.documentUrl)||0===r.frameId?s.documentUrl:r.tab.url,g.webRequestService.processGetSelectorsAndScripts(r.tab,e)||{}}case"checkPageScriptWrapperRequest":return{block:g.webRequestService.checkPageScriptWrapperRequest(r.tab,s.elementUrl,s.documentUrl,s.requestType),requestId:s.requestId};case"processShouldCollapse":return{collapse:g.webRequestService.processShouldCollapse(r.tab,s.elementUrl,s.documentUrl,s.requestType),requestId:s.requestId};case"processShouldCollapseMany":return{requests:g.webRequestService.processShouldCollapseMany(r.tab,s.documentUrl,s.requests)};case"onOpenFilteringLogPage":g.filteringLog.onOpenFilteringLogPage();break;case"onCloseFilteringLogPage":g.filteringLog.onCloseFilteringLogPage();break;case"reloadTabById":s.preserveLogEnabled||g.filteringLog.clearEventsByTabId(s.tabId),g.tabs.reload(s.tabId);break;case"clearEventsByTabId":g.filteringLog.clearEventsByTabId(s.tabId);break;case"getTabFrameInfoById":return s.tabId?{frameInfo:g.frames.getFrameInfo({tabId:s.tabId})}:(g.tabs.getActive(function(e){e=g.frames.getFrameInfo(e);i({frameInfo:e})}),!0);case"getFilteringInfoByTabId":return{filteringInfo:g.filteringLog.getFilteringInfoByTabId(s.tabId)};case"synchronizeOpenTabs":return g.filteringLog.synchronizeOpenTabs(function(e){i({tabs:e})}),!0;case"addFilterSubscription":var{url:l,title:c}=s;g.ui.openSettingsTab("antibanner0",{action:"add_filter_subscription",title:c,url:l});break;case"showAlertMessagePopup":g.ui.showAlertMessagePopup(s.title,s.text);break;case"addWhiteListDomainPopup":g.tabs.getActive(function(e){g.ui.whiteListTab(e)});break;case"removeWhiteListDomainPopup":g.tabs.getActive(function(e){g.ui.unWhiteListTab(e)});break;case"changeApplicationFilteringDisabled":g.ui.changeApplicationFilteringDisabled(s.disabled);break;case"openSiteReportTab":g.ui.openSiteReportTab(s.url);break;case"openAbuseTab":g.ui.openAbuseTab(s.url);break;case"openSettingsTab":g.ui.openSettingsTab();break;case"openAssistant":g.ui.openAssistant();break;case"getTabInfoForPopup":return g.tabs.getActive(e=>{e=g.frames.getFrameInfo(e);i({frameInfo:e,options:{showStatsSupported:!0,isFirefoxBrowser:g.utils.browser.isFirefoxBrowser(),showInfoAboutFullVersion:g.settings.isShowInfoAboutAdguardFullVersion(),isMacOs:g.utils.browser.isMacOs(),isEdgeBrowser:g.utils.browser.isEdgeBrowser()||g.utils.browser.isEdgeChromiumBrowser(),notification:g.notifications.getCurrentNotification(),isDisableShowAdguardPromoInfo:g.settings.isDisableShowAdguardPromoInfo()}})}),!0;case"setNotificationViewed":g.notifications.setNotificationViewed(s.withDelay);break;case"getStatisticsData":return g.localStorage.isInitialized()?(i({stats:g.pageStats.getStatisticsData()}),!0):{};case"resizePanelPopup":g.browserAction.resize(s.width,s.height);break;case"closePanelPopup":g.browserAction.close();break;case"sendFeedback":g.backend.sendUrlReport(s.url,s.topic,s.comment);break;case"saveCssHitStats":!function(t,s){if(g.webRequestService.isCollectingCosmeticRulesHits(t)){var r=g.frames.getMainFrameUrl(t);for(let e=0;e<s.length;e+=1){var i=s[e],a=g.rules.builder.createRule(i.ruleText,i.filterId);g.webRequestService.recordRuleHit(t,a,r),g.filteringLog.addCosmeticEvent(t,i.element,t.url,g.RequestTypes.DOCUMENT,a)}}}(r.tab,s.stats);break;case"loadSettingsJson":{const d=g.app.getVersion();return g.sync.settingsProvider.loadSettingsBackup(e=>{i({content:e,appVersion:d})}),!0}case"applySettingsJson":g.sync.settingsProvider.applySettingsBackup(s.json);break;case"disableGetPremiumNotification":g.settings.disableShowAdguardPromoInfo();break;case"uosReport":g.uos.userReport(function(e){g.runtimeImpl.sendMessage({type:"reportSuccess",title:"举报成功"})});break;case"uosAddBlackList":g.localStorage.setItem("is-blackList-filter-status",JSON.stringify(!1));let t=g.utils.url.getHost(s.url),e=g.whitelist.optionsUserBlackListlData("get");e=e.map(e=>g.utils.url.getHost(e)||e),e.find(e=>e==t)||(e.push(t),g.whitelist.optionsUserBlackListlData("set",e),g.whitelist.filterWhiteListChange()),g.runtimeImpl.sendMessage({type:"reportSuccess",title:"已开启保护"});break;default:return!0}var u,b}g.runtime.onMessage.addListener(e),g.runtime.onMessageHandler=e}(adguard);