!function(h,t){"use strict";function R(e,u,s,o,l,t,i){if(i){if(e.convertedRuleText&&i[e.convertedRuleText])return;if(i[e.ruleText])return}if(t||!e.isGeneric()){if(!e.hasPermittedDomains())return e.isFiltered(u,o,l)&&e.isPermitted(s);if(l!==h.RequestTypes.DOCUMENT&&l!==h.RequestTypes.SUBDOCUMENT)return e.isFiltered(u,o,l)&&e.isPermitted(s);let t=e.isPermitted(s);return e.isAnyUrl()?(t=e.isPermitted(h.utils.url.getHost(u)),o=!1):t=t||e.isPermitted(h.utils.url.getHost(u)),e.isFiltered(u,o,l)&&t}}const s=t=>t.isImportant&&t.whiteListRule?4:t.isImportant?3:t.whiteListRule?2:t.isRedirectRule()?1:0;function c(t,e){var u=s(t);return s(e)<=u?t:e}function p(e,u,s,o,l,i,r){let n=null;if(l===h.RequestTypes.DOCUMENT)for(let t=0;t<e.length;t+=1){const c=e[t];c.isDocumentLevel()&&R(c,u,s,o,l,i,r)&&(n=n||[],n.push(c))}for(let t=0;t<e.length;t+=1){var a=e[t];R(a,u,s,o,l,i,r)&&(n=n||[],n.push(a))}return n}function e(){this.shortcutsLookupTable=new t.ShortcutsLookupTable,this.domainsLookupTable=new t.DomainsLookupTable,this.rulesWithoutShortcuts=[]}e.prototype={addRule(t){this.shortcutsLookupTable.addRule(t)||this.domainsLookupTable.addRule(t)||this.rulesWithoutShortcuts.push(t)},removeRule(t){this.shortcutsLookupTable.removeRule(t),this.domainsLookupTable.removeRule(t),h.utils.collections.removeRule(this.rulesWithoutShortcuts,t)},clearRules(){this.shortcutsLookupTable.clearRules(),this.domainsLookupTable.clearRules(),this.rulesWithoutShortcuts=[]},getRules(){let t=[];return t=t.concat(this.rulesWithoutShortcuts),t=t.concat(this.shortcutsLookupTable.getRules()),t=t.concat(this.domainsLookupTable.getRules()),t},concatRules(t,e){return e&&0<e.length?t.concat(e):t},findRule(t,e,u,s,o,l){if(!t)return null;var i=t.toLowerCase();let r=[],n=this.shortcutsLookupTable.lookupRules(i);r=this.concatRules(r,n);let a=e;if(null===a?a=h.utils.url.getHost(t):s===h.RequestTypes.DOCUMENT&&(n=this.domainsLookupTable.lookupRules(h.utils.url.getHost(t)),r=this.concatRules(r,n)),n=this.domainsLookupTable.lookupRules(a),r=this.concatRules(r,n),r=this.concatRules(r,this.rulesWithoutShortcuts),0<r.length){l=function(t,e,u,s,o,l,i){const r=p(t,e,u,s,o,l,i);return r?r.reduce(c):null}(r,t,e,u,s,o,l);if(l)return l}return null},findRules(t,e,u,s,o){if(!t)return null;let l=[];var i=t.toLowerCase();let r=this.shortcutsLookupTable.lookupRules(i);return r&&(l=l.concat(r)),null===e&&(i=h.utils.url.getHost(t),r=this.domainsLookupTable.lookupRules(i),r&&0<r.length&&(l=l.concat(r))),r=this.domainsLookupTable.lookupRules(e),r&&(l=l.concat(r)),l=l.concat(this.rulesWithoutShortcuts),l&&0<l.length?p(l,t,e,u,s,!0,o):null}},t.UrlFilterRuleLookupTable=e}(adguard,adguard.rules);