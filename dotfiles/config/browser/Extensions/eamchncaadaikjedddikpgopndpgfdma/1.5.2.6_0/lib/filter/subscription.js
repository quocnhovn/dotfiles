adguard.subscriptions=function(U){"use strict";const S=0,d=99;let u=[],c=[],p={},y=[],N={};function m(e,t){this.tagId=e,this.keyword=t}function k(e){var{filterId:t,groupId:r,name:i,description:s,homepage:a,version:n,timeUpdated:o,displayNumber:l,languages:d,expires:u,subscriptionUrl:c,tags:p,customUrl:m,trusted:g,checksum:e}=e;this.filterId=t,this.groupId=r,this.name=i,this.description=s,this.homepage=a,this.version=n,this.timeUpdated=o,this.displayNumber=l,this.languages=d,this.expires=u,this.subscriptionUrl=c,this.tags=p,void 0!==m&&(this.customUrl=m),void 0!==g&&(this.trusted=g),void 0!==e&&(this.checksum=e)}const g=function(e,t,r){this.groupId=e,this.groupName=t,this.displayNumber=r};const f=function(e){var t=+e.filterId,r=+e.groupId,i=e.name,s=e.description,a=e["homepage"],n=e["version"],o=function(e){if(Number.isInteger(e))return new Date(e);let t=Date.parse(e);return Number.isNaN(t)&&(t=Date.parse(e.replace(/\+(\d{2})(\d{2})$/,"+$1:$2"))),Number.isNaN(t)&&(t=(new Date).getTime()),t}(e.timeUpdated),l=+e.expires,d=e["subscriptionUrl"],u=e["languages"],c=+e.displayNumber;const p=e["tags"];var m=e["customUrl"],g=e["trusted"],e=e["checksum"];return 0===p.length&&p.push(0),new k({filterId:t,groupId:r,name:i,description:s,homepage:a,version:n,timeUpdated:o,displayNumber:c,languages:u,expires:l,subscriptionUrl:d,tags:p,customUrl:m,trusted:g,checksum:e})},l=e=>{var t=e.match(/(\d+)\s+(day|hour)/);if(!t){var r=Number.parseInt(e,10);return Number.isNaN(r)?0:r}var[,r,t]=t;let i=1;switch(t){case"day":i=86400;break;case"hour":i=3600}return r*i},w=o=>{var e=t=>{let r="";var i=Math.min(50,o.length);for(let e=0;e<i;e+=1){const n=o[e];var s=`! ${t}: `,a=n.indexOf(s);0<=a&&(r=n.substring(a+s.length))}return"Expires"===t&&(r=l(r)),r};return{name:e("Title"),description:e("Description"),homepage:e("Homepage"),version:e("Version"),expires:e("Expires"),timeUpdated:e("TimeUpdated")}},F=1e3,s="custom_filters",h=()=>{var e=U.localStorage.getItem(s);return e?JSON.parse(e):[]},L=t=>{const e=h();let r=!1;const i=e.map(e=>e.filterId===t.filterId?(r=!0,t):e);r||i.push(t),U.localStorage.setItem(s,JSON.stringify(i))};const x=(t,e)=>{const{checksum:r,version:i,timeUpdated:s,lastCheckTime:a,expires:n}=e;t.checksum=r||t.checksum,t.version=i||t.version,t.timeUpdated=s||t.timeUpdated,t.lastCheckTime=a||t.lastCheckTime,t.expires=n||t.expires,y=y.map(e=>(e.filterId===t.filterId&&(e.version=i||e.version,e.checksum=r||e.checksum,e.timeUpdated=s||e.timeUpdated,e.lastCheckTime=a||t.lastCheckTime,e.expires=n||t.expires),e)),N[t.filterId]=t,L(t)};async function e(){var t,r,i,s,a=await U.backend.loadLocalFiltersMetadata();u=[],c=[],p={},y=[],N={};for(let e=0;e<a.tags.length;e+=1)u.push((t=a.tags[e],r=void 0,r=+t.tagId,t=t.keyword,new m(r,t)));for(let e=0;e<a.filters.length;e+=1){var n=f(a.filters[e]);y.push(n),N[n.filterId]=n}for(let e=0;e<a.groups.length;e+=1){var o=(o=a.groups[e],s=i=void 0,i=+o.groupId,s=o.groupName,o=+o.displayNumber,new g(i,s,o));c.push(o),p[o.groupId]=o}var e=new g(S,U.i18n.getMessage("options_antibanner_custom_group"),d);c.push(e),p[e.groupId]=e;const l=h();l.forEach(e=>{e=f(e);y.push(e),N[e.filterId]=e}),y.sort((e,t)=>e.displayNumber-t.displayNumber),c.sort((e,t)=>e.displayNumber-t.displayNumber),U.console.info("Filters metadata loaded")}async function t(){var t,r,i,s,a,n,e=await U.backend.loadLocalFiltersI18Metadata(),o=e.tags,l=e.filters,d=e.groups;for(let e=0;e<u.length;e+=1)t=u[e],r=void 0,r=t.tagId,!(r=o[r])||(r=r[U.utils.i18n.normalize(r,U.app.getLocale())])&&(t.name=r.name,t.description=r.description);for(let e=0;e<y.length;e+=1)i=y[e],s=void 0,s=i.filterId,!(s=l[s])||(s=s[U.utils.i18n.normalize(s,U.app.getLocale())])&&(i.name=s.name,i.description=s.description);for(let e=0;e<c.length;e+=1)a=c[e],n=void 0,n=a.groupId,!(n=d[n])||(n=n[U.utils.i18n.normalize(n,U.app.getLocale())])&&(a.groupName=n.name);U.console.info("Filters i18n metadata loaded")}function a(t){if(!t)return[];const r=[];for(let e=0;e<y.length;e+=1){var i=y[e],s=i["languages"];s&&0<s.length&&U.utils.i18n.normalize(s,t)&&r.push(i.filterId)}return r}return U.listeners.addListener((e,t)=>{var r;e===U.listeners.FILTER_ADD_REMOVE&&t&&t.removed&&((r=t)&&r.filterId&&(delete N[r.filterId],y=y.filter(e=>e.filterId!==r.filterId)),(t=>{const e=h();var r=e.filter(e=>e.filterId!==t.filterId||t.installed);U.localStorage.setItem(s,JSON.stringify(r))})(t))}),{init:async function(){try{await e(),await t(),await async function(){const e=U.rules.LocalScriptRulesService;var t;void 0!==e&&(t=await U.backend.loadLocalScriptRules(),e.setLocalScriptRules(t),U.console.info("Filters local script rules loaded"))}(),await async function(){const e=U.rules.RedirectFilterService;var t;void 0!==e&&(t=await U.backend.loadRedirectSources(),e.setRedirectSources(t),U.console.info("Filters redirect sources loaded"))}()}catch(e){U.console.error("Error loading metadata, cause: "+e.message)}},getFilterIdsForLanguage:a,getTags:function(){return u},getGroups:()=>c,getGroup:e=>p[e],groupHasEnabledStatus:e=>{e=p[e];return e&&void 0!==e.enabled},getFilters:function(){return y},getCustomFilters:function(){return y.filter(e=>e.customUrl)},getFilter:function(e){return N[e]},isTrustedFilter:e=>{if(e<F)return!0;e=N[e];return!(!e||!e.trusted||!0!==e.trusted)},createSubscriptionFilterFromJSON:f,updateCustomFilter:function(h,e,v){const{title:I,trusted:b}=e;U.backend.loadFilterRulesBySubscriptionUrl(h,e=>{var t,r,i=(()=>{let t=0;return y.forEach(e=>{e.filterId>t&&(t=e.filterId)}),t>=F?t+1:F})(),s=w(e),a=s["timeUpdated"],{description:n,homepage:o,version:l,expires:d}=s,u=I,a=a||(new Date).toISOString(),c=S,p=h;let m;l||(m=(e=>{e=e.join("\n");return CryptoJS.MD5(e).toString()})(e));let g=y.find(e=>e.customUrl===h),f=!0;if(g){if(t=l,r=m,s=g,!(t?!U.utils.browser.isGreaterOrEqualsVersion(s.version,t):!s.checksum||r!==s.checksum))return v(),void x(g,{lastCheckTime:Date.now()})}else g=new k({filterId:i,groupId:c,name:u,description:n,homepage:o,version:l,timeUpdated:a,displayNumber:0,languages:[],expires:d,subscriptionUrl:p,tags:[0],customUrl:h,checksum:m,trusted:b}),g.loaded=!0,y.push(g),N[g.filterId]=g,L(g),f=!1;f&&x(g,{version:l,checksum:m,timeUpdated:a,expires:d}),x(g,{lastCheckTime:Date.now()}),U.listeners.notifyListeners(U.listeners.SUCCESS_DOWNLOAD_FILTER,g),U.listeners.notifyListeners(U.listeners.UPDATE_FILTER_RULES,g,e),v(g.filterId)},e=>{U.console.error(`Error download filter by url ${h}, cause: `+(e||"")),v()})},getCustomFilterInfo:(u,e,c)=>{const p=e["title"];U.backend.loadFilterRulesBySubscriptionUrl(u,e=>{var t=w(e),{name:r,timeUpdated:i}=t,{description:s,homepage:a,version:n,expires:o}=t,r=r||p,i=i||(new Date).toISOString(),l=S,t=u,e=e.filter(e=>0!==e.trim().indexOf("!")).length;let d=y.find(e=>e.customUrl===u);d?c({error:U.i18n.getMessage("options_antibanner_custom_filter_already_exists")}):(d=new k({groupId:l,name:r,description:s,homepage:a,version:n,timeUpdated:i,displayNumber:0,languages:[],expires:o,subscriptionUrl:t,tags:[0]}),d.loaded=!0,d.customUrl=u,d.rulesCount=e,c({filter:d}))},e=>{U.console.error(`Error download filter by url ${u}, cause: `+(e||"")),c()})},getLangSuitableFilters:()=>{let t=[];var r=a(U.app.getLocale());t=t.concat(r);var i=U.utils.browser.getNavigatorLanguages(2);for(let e=0;e<i.length;e+=1)r=a(i[e]),t=t.concat(r);return[...new Set(t)]},CUSTOM_FILTERS_START_ID:F}}(adguard);