(()=>{"use strict";
/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */
const{entries:e,setPrototypeOf:t,isFrozen:n,getPrototypeOf:o,getOwnPropertyDescriptor:i}=Object;let{freeze:r,seal:a,create:s}=Object,{apply:c,construct:l}="undefined"!=typeof Reflect&&Reflect;r||(r=function(e){return e}),a||(a=function(e){return e}),c||(c=function(e,t,n){return e.apply(t,n)}),l||(l=function(e,t){return new e(...t)});const u=C(Array.prototype.forEach),d=C(Array.prototype.lastIndexOf),f=C(Array.prototype.pop),p=C(Array.prototype.push),m=C(Array.prototype.splice),h=C(String.prototype.toLowerCase),g=C(String.prototype.toString),y=C(String.prototype.match),w=C(String.prototype.replace),v=C(String.prototype.indexOf),b=C(String.prototype.trim),k=C(Object.prototype.hasOwnProperty),E=C(RegExp.prototype.test),S=(x=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return l(x,t)});var x;function C(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return c(e,t,o)}}function T(e,o){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;t&&t(e,null);let r=o.length;for(;r--;){let t=o[r];if("string"==typeof t){const e=i(t);e!==t&&(n(o)||(o[r]=e),t=e)}e[t]=!0}return e}function _(e){for(let t=0;t<e.length;t++){k(e,t)||(e[t]=null)}return e}function A(t){const n=s(null);for(const[o,i]of e(t)){k(t,o)&&(Array.isArray(i)?n[o]=_(i):i&&"object"==typeof i&&i.constructor===Object?n[o]=A(i):n[o]=i)}return n}function O(e,t){for(;null!==e;){const n=i(e,t);if(n){if(n.get)return C(n.get);if("function"==typeof n.value)return C(n.value)}e=o(e)}return function(){return null}}const N=r(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),L=r(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),R=r(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),I=r(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),M=r(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),P=r(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),F=r(["#text"]),U=r(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),D=r(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),B=r(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=r(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),K=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),W=a(/<%[\w\W]*|[\w\W]*%>/gm),z=a(/\$\{[\w\W]*/gm),q=a(/^data-[\-\w.\u00B7-\uFFFF]+$/),j=a(/^aria-[\-\w]+$/),V=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),G=a(/^(?:\w+script|data):/i),$=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Q=a(/^html$/i),Y=a(/^[a-z][.\w]*(-[.\w]+)+$/i);var X=Object.freeze({__proto__:null,ARIA_ATTR:j,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:Y,DATA_ATTR:q,DOCTYPE_NAME:Q,ERB_EXPR:W,IS_ALLOWED_URI:V,IS_SCRIPT_OR_DATA:G,MUSTACHE_EXPR:K,TMPLIT_EXPR:z});const J=1,Z=3,ee=7,te=8,ne=9,oe=function(){return"undefined"==typeof window?null:window};var ie=function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe();const o=e=>t(e);if(o.version="3.2.4",o.removed=[],!n||!n.document||n.document.nodeType!==ne||!n.Element)return o.isSupported=!1,o;let{document:i}=n;const a=i,c=a.currentScript,{DocumentFragment:l,HTMLTemplateElement:x,Node:C,Element:_,NodeFilter:K,NamedNodeMap:W=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:z,DOMParser:q,trustedTypes:j}=n,G=_.prototype,$=O(G,"cloneNode"),Y=O(G,"remove"),ie=O(G,"nextSibling"),re=O(G,"childNodes"),ae=O(G,"parentNode");if("function"==typeof x){const e=i.createElement("template");e.content&&e.content.ownerDocument&&(i=e.content.ownerDocument)}let se,ce="";const{implementation:le,createNodeIterator:ue,createDocumentFragment:de,getElementsByTagName:fe}=i,{importNode:pe}=a;let me={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};o.isSupported="function"==typeof e&&"function"==typeof ae&&le&&void 0!==le.createHTMLDocument;const{MUSTACHE_EXPR:he,ERB_EXPR:ge,TMPLIT_EXPR:ye,DATA_ATTR:we,ARIA_ATTR:ve,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:ke,CUSTOM_ELEMENT:Ee}=X;let{IS_ALLOWED_URI:Se}=X,xe=null;const Ce=T({},[...N,...L,...R,...M,...F]);let Te=null;const _e=T({},[...U,...D,...B,...H]);let Ae=Object.seal(s(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Oe=null,Ne=null,Le=!0,Re=!0,Ie=!1,Me=!0,Pe=!1,Fe=!0,Ue=!1,De=!1,Be=!1,He=!1,Ke=!1,We=!1,ze=!0,qe=!1,je=!0,Ve=!1,Ge={},$e=null;const Qe=T({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ye=null;const Xe=T({},["audio","video","img","source","image","track"]);let Je=null;const Ze=T({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),et="http://www.w3.org/1998/Math/MathML",tt="http://www.w3.org/2000/svg",nt="http://www.w3.org/1999/xhtml";let ot=nt,it=!1,rt=null;const at=T({},[et,tt,nt],g);let st=T({},["mi","mo","mn","ms","mtext"]),ct=T({},["annotation-xml"]);const lt=T({},["title","style","font","a","script"]);let ut=null;const dt=["application/xhtml+xml","text/html"];let ft=null,pt=null;const mt=i.createElement("form"),ht=function(e){return e instanceof RegExp||e instanceof Function},gt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!pt||pt!==e){if(e&&"object"==typeof e||(e={}),e=A(e),ut=-1===dt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,ft="application/xhtml+xml"===ut?g:h,xe=k(e,"ALLOWED_TAGS")?T({},e.ALLOWED_TAGS,ft):Ce,Te=k(e,"ALLOWED_ATTR")?T({},e.ALLOWED_ATTR,ft):_e,rt=k(e,"ALLOWED_NAMESPACES")?T({},e.ALLOWED_NAMESPACES,g):at,Je=k(e,"ADD_URI_SAFE_ATTR")?T(A(Ze),e.ADD_URI_SAFE_ATTR,ft):Ze,Ye=k(e,"ADD_DATA_URI_TAGS")?T(A(Xe),e.ADD_DATA_URI_TAGS,ft):Xe,$e=k(e,"FORBID_CONTENTS")?T({},e.FORBID_CONTENTS,ft):Qe,Oe=k(e,"FORBID_TAGS")?T({},e.FORBID_TAGS,ft):{},Ne=k(e,"FORBID_ATTR")?T({},e.FORBID_ATTR,ft):{},Ge=!!k(e,"USE_PROFILES")&&e.USE_PROFILES,Le=!1!==e.ALLOW_ARIA_ATTR,Re=!1!==e.ALLOW_DATA_ATTR,Ie=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Me=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Pe=e.SAFE_FOR_TEMPLATES||!1,Fe=!1!==e.SAFE_FOR_XML,Ue=e.WHOLE_DOCUMENT||!1,He=e.RETURN_DOM||!1,Ke=e.RETURN_DOM_FRAGMENT||!1,We=e.RETURN_TRUSTED_TYPE||!1,Be=e.FORCE_BODY||!1,ze=!1!==e.SANITIZE_DOM,qe=e.SANITIZE_NAMED_PROPS||!1,je=!1!==e.KEEP_CONTENT,Ve=e.IN_PLACE||!1,Se=e.ALLOWED_URI_REGEXP||V,ot=e.NAMESPACE||nt,st=e.MATHML_TEXT_INTEGRATION_POINTS||st,ct=e.HTML_INTEGRATION_POINTS||ct,Ae=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ht(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ae.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ht(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ae.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Ae.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Pe&&(Re=!1),Ke&&(He=!0),Ge&&(xe=T({},F),Te=[],!0===Ge.html&&(T(xe,N),T(Te,U)),!0===Ge.svg&&(T(xe,L),T(Te,D),T(Te,H)),!0===Ge.svgFilters&&(T(xe,R),T(Te,D),T(Te,H)),!0===Ge.mathMl&&(T(xe,M),T(Te,B),T(Te,H))),e.ADD_TAGS&&(xe===Ce&&(xe=A(xe)),T(xe,e.ADD_TAGS,ft)),e.ADD_ATTR&&(Te===_e&&(Te=A(Te)),T(Te,e.ADD_ATTR,ft)),e.ADD_URI_SAFE_ATTR&&T(Je,e.ADD_URI_SAFE_ATTR,ft),e.FORBID_CONTENTS&&($e===Qe&&($e=A($e)),T($e,e.FORBID_CONTENTS,ft)),je&&(xe["#text"]=!0),Ue&&T(xe,["html","head","body"]),xe.table&&(T(xe,["tbody"]),delete Oe.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');se=e.TRUSTED_TYPES_POLICY,ce=se.createHTML("")}else void 0===se&&(se=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const o="data-tt-policy-suffix";t&&t.hasAttribute(o)&&(n=t.getAttribute(o));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}}(j,c)),null!==se&&"string"==typeof ce&&(ce=se.createHTML(""));r&&r(e),pt=e}},yt=T({},[...L,...R,...I]),wt=T({},[...M,...P]),vt=function(e){p(o.removed,{element:e});try{ae(e).removeChild(e)}catch(t){Y(e)}},bt=function(e,t){try{p(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(He||Ke)try{vt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},kt=function(e){let t=null,n=null;if(Be)e="<remove></remove>"+e;else{const t=y(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===ut&&ot===nt&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=se?se.createHTML(e):e;if(ot===nt)try{t=(new q).parseFromString(o,ut)}catch(e){}if(!t||!t.documentElement){t=le.createDocument(ot,"template",null);try{t.documentElement.innerHTML=it?ce:o}catch(e){}}const r=t.body||t.documentElement;return e&&n&&r.insertBefore(i.createTextNode(n),r.childNodes[0]||null),ot===nt?fe.call(t,Ue?"html":"body")[0]:Ue?t.documentElement:r},Et=function(e){return ue.call(e.ownerDocument||e,e,K.SHOW_ELEMENT|K.SHOW_COMMENT|K.SHOW_TEXT|K.SHOW_PROCESSING_INSTRUCTION|K.SHOW_CDATA_SECTION,null)},St=function(e){return e instanceof z&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof W)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},xt=function(e){return"function"==typeof C&&e instanceof C};function Ct(e,t,n){u(e,(e=>{e.call(o,t,n,pt)}))}const Tt=function(e){let t=null;if(Ct(me.beforeSanitizeElements,e,null),St(e))return vt(e),!0;const n=ft(e.nodeName);if(Ct(me.uponSanitizeElement,e,{tagName:n,allowedTags:xe}),e.hasChildNodes()&&!xt(e.firstElementChild)&&E(/<[/\w]/g,e.innerHTML)&&E(/<[/\w]/g,e.textContent))return vt(e),!0;if(e.nodeType===ee)return vt(e),!0;if(Fe&&e.nodeType===te&&E(/<[/\w]/g,e.data))return vt(e),!0;if(!xe[n]||Oe[n]){if(!Oe[n]&&At(n)){if(Ae.tagNameCheck instanceof RegExp&&E(Ae.tagNameCheck,n))return!1;if(Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(n))return!1}if(je&&!$e[n]){const t=ae(e)||e.parentNode,n=re(e)||e.childNodes;if(n&&t){for(let o=n.length-1;o>=0;--o){const i=$(n[o],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,ie(e))}}}return vt(e),!0}return e instanceof _&&!function(e){let t=ae(e);t&&t.tagName||(t={namespaceURI:ot,tagName:"template"});const n=h(e.tagName),o=h(t.tagName);return!!rt[e.namespaceURI]&&(e.namespaceURI===tt?t.namespaceURI===nt?"svg"===n:t.namespaceURI===et?"svg"===n&&("annotation-xml"===o||st[o]):Boolean(yt[n]):e.namespaceURI===et?t.namespaceURI===nt?"math"===n:t.namespaceURI===tt?"math"===n&&ct[o]:Boolean(wt[n]):e.namespaceURI===nt?!(t.namespaceURI===tt&&!ct[o])&&!(t.namespaceURI===et&&!st[o])&&!wt[n]&&(lt[n]||!yt[n]):!("application/xhtml+xml"!==ut||!rt[e.namespaceURI]))}(e)?(vt(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!E(/<\/no(script|embed|frames)/i,e.innerHTML)?(Pe&&e.nodeType===Z&&(t=e.textContent,u([he,ge,ye],(e=>{t=w(t,e," ")})),e.textContent!==t&&(p(o.removed,{element:e.cloneNode()}),e.textContent=t)),Ct(me.afterSanitizeElements,e,null),!1):(vt(e),!0)},_t=function(e,t,n){if(ze&&("id"===t||"name"===t)&&(n in i||n in mt))return!1;if(Re&&!Ne[t]&&E(we,t));else if(Le&&E(ve,t));else if(!Te[t]||Ne[t]){if(!(At(e)&&(Ae.tagNameCheck instanceof RegExp&&E(Ae.tagNameCheck,e)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(e))&&(Ae.attributeNameCheck instanceof RegExp&&E(Ae.attributeNameCheck,t)||Ae.attributeNameCheck instanceof Function&&Ae.attributeNameCheck(t))||"is"===t&&Ae.allowCustomizedBuiltInElements&&(Ae.tagNameCheck instanceof RegExp&&E(Ae.tagNameCheck,n)||Ae.tagNameCheck instanceof Function&&Ae.tagNameCheck(n))))return!1}else if(Je[t]);else if(E(Se,w(n,ke,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(n,"data:")||!Ye[e]){if(Ie&&!E(be,w(n,ke,"")));else if(n)return!1}else;return!0},At=function(e){return"annotation-xml"!==e&&y(e,Ee)},Ot=function(e){Ct(me.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||St(e))return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Te,forceKeepAttr:void 0};let i=t.length;for(;i--;){const r=t[i],{name:a,namespaceURI:s,value:c}=r,l=ft(a);let d="value"===a?c:b(c);if(n.attrName=l,n.attrValue=d,n.keepAttr=!0,n.forceKeepAttr=void 0,Ct(me.uponSanitizeAttribute,e,n),d=n.attrValue,!qe||"id"!==l&&"name"!==l||(bt(a,e),d="user-content-"+d),Fe&&E(/((--!?|])>)|<\/(style|title)/i,d)){bt(a,e);continue}if(n.forceKeepAttr)continue;if(bt(a,e),!n.keepAttr)continue;if(!Me&&E(/\/>/i,d)){bt(a,e);continue}Pe&&u([he,ge,ye],(e=>{d=w(d,e," ")}));const p=ft(e.nodeName);if(_t(p,l,d)){if(se&&"object"==typeof j&&"function"==typeof j.getAttributeType)if(s);else switch(j.getAttributeType(p,l)){case"TrustedHTML":d=se.createHTML(d);break;case"TrustedScriptURL":d=se.createScriptURL(d)}try{s?e.setAttributeNS(s,a,d):e.setAttribute(a,d),St(e)?vt(e):f(o.removed)}catch(e){}}}Ct(me.afterSanitizeAttributes,e,null)},Nt=function e(t){let n=null;const o=Et(t);for(Ct(me.beforeSanitizeShadowDOM,t,null);n=o.nextNode();)Ct(me.uponSanitizeShadowNode,n,null),Tt(n),Ot(n),n.content instanceof l&&e(n.content);Ct(me.afterSanitizeShadowDOM,t,null)};return o.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,i=null,r=null,s=null;if(it=!e,it&&(e="\x3c!--\x3e"),"string"!=typeof e&&!xt(e)){if("function"!=typeof e.toString)throw S("toString is not a function");if("string"!=typeof(e=e.toString()))throw S("dirty is not a string, aborting")}if(!o.isSupported)return e;if(De||gt(t),o.removed=[],"string"==typeof e&&(Ve=!1),Ve){if(e.nodeName){const t=ft(e.nodeName);if(!xe[t]||Oe[t])throw S("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof C)n=kt("\x3c!----\x3e"),i=n.ownerDocument.importNode(e,!0),i.nodeType===J&&"BODY"===i.nodeName||"HTML"===i.nodeName?n=i:n.appendChild(i);else{if(!He&&!Pe&&!Ue&&-1===e.indexOf("<"))return se&&We?se.createHTML(e):e;if(n=kt(e),!n)return He?null:We?ce:""}n&&Be&&vt(n.firstChild);const c=Et(Ve?e:n);for(;r=c.nextNode();)Tt(r),Ot(r),r.content instanceof l&&Nt(r.content);if(Ve)return e;if(He){if(Ke)for(s=de.call(n.ownerDocument);n.firstChild;)s.appendChild(n.firstChild);else s=n;return(Te.shadowroot||Te.shadowrootmode)&&(s=pe.call(a,s,!0)),s}let d=Ue?n.outerHTML:n.innerHTML;return Ue&&xe["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&E(Q,n.ownerDocument.doctype.name)&&(d="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+d),Pe&&u([he,ge,ye],(e=>{d=w(d,e," ")})),se&&We?se.createHTML(d):d},o.setConfig=function(){gt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),De=!0},o.clearConfig=function(){pt=null,De=!1},o.isValidAttribute=function(e,t,n){pt||gt({});const o=ft(e),i=ft(t);return _t(o,i,n)},o.addHook=function(e,t){"function"==typeof t&&p(me[e],t)},o.removeHook=function(e,t){if(void 0!==t){const n=d(me[e],t);return-1===n?void 0:m(me[e],n,1)[0]}return f(me[e])},o.removeHooks=function(e){me[e]=[]},o.removeAllHooks=function(){me={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},o}();const re={keyCodesMac:{Minus:["-","_"],Equal:["=","+"],BracketLeft:["[","{"],BracketRight:["]","}"],Backslash:["\\","|"],Semicolon:[";",":"],Quote:["'",'"'],Comma:[",","<"],Period:[".",">"],Slash:["/","?"]},keyCodes:{ESC:27,backspace:8,deleteKey:46,enter:13,ctrlEnter:10,space:32,shiftKey:16,ctrlKey:17,f1:112,f12:123,comma:188,tab:9,downArrow:40,upArrow:38},modifierKeys:{16:"Shift",17:"Ctrl",18:"Alt",91:"Meta",92:"Meta",93:"ContextMenu",229:"Process"},keyNames:{8:"Backspace",9:"Tab",12:"NumLock",27:"Esc",32:"Space",46:"Delete"},keyIdentifierCorrectionMap:{"U+00C0":["U+0060","U+007E"],"U+0030":["U+0030","U+0029"],"U+0031":["U+0031","U+0021"],"U+0032":["U+0032","U+0040"],"U+0033":["U+0033","U+0023"],"U+0034":["U+0034","U+0024"],"U+0035":["U+0035","U+0025"],"U+0036":["U+0036","U+005E"],"U+0037":["U+0037","U+0026"],"U+0038":["U+0038","U+002A"],"U+0039":["U+0039","U+0028"],"U+00BD":["U+002D","U+005F"],"U+00BB":["U+003D","U+002B"],"U+00DB":["U+005B","U+007B"],"U+00DD":["U+005D","U+007D"],"U+00DC":["U+005C","U+007C"],"U+00BA":["U+003B","U+003A"],"U+00DE":["U+0027","U+0022"],"U+00BC":["U+002C","U+003C"],"U+00BE":["U+002E","U+003E"],"U+00BF":["U+002F","U+003F"]}};function ae(e,t){var n,o=0;return-1!==e.indexOf("Ctrl-")&&(o|=1),-1!==e.indexOf("Alt-")&&(o|=2),-1!==e.indexOf("Meta-")&&(o|=4),-1!==e.indexOf("Shift-")&&(o|=8),n=8192+((n=t.length>1?256+re.specialKeys.indexOf(t):t.charCodeAt(0))<<4)+o,String.fromCharCode(n)}re.platform="Windows","undefined"!=typeof navigator&&(-1!==navigator.platform.indexOf("Mac")?re.platform="Mac":-1!==navigator.userAgent.indexOf("Linux")&&(re.platform="Linux")),re.getKeyChar=function(e){var t;if(e.keyCode in this.modifierKeys)t="";else{if(this.keyNames.hasOwnProperty(e.keyCode))t="{0}".format(this.keyNames[e.keyCode]);else if(t=e.key||"",-1!==["Shift","Meta","Alt","Ctrl"].indexOf(t)&&(t=""),t)t.charCodeAt(0)>127||"Dead"===t?e.keyCode<127?(t=String.fromCharCode(e.keyCode),t=e.shiftKey?t:t.toLowerCase()):this.keyCodesMac.hasOwnProperty(e.code)&&(t=this.keyCodesMac[e.code][e.shiftKey?1:0]):"Unidentified"===t&&(t="");else if(e.keyIdentifier)if("U+"!==e.keyIdentifier.slice(0,2))t="{0}".format(e.keyIdentifier);else{var n=e.keyIdentifier;if(("Windows"===re.platform||"Linux"===re.platform)&&this.keyIdentifierCorrectionMap[n]){var o=this.keyIdentifierCorrectionMap[n];n=e.shiftKey?o[1]:o[0]}var i="0x"+n.substring(2);t=String.fromCharCode(parseInt(i)),t=e.shiftKey?t:t.toLowerCase()}e.shiftKey&&t.length>1&&(t="Shift-"+t),t.length>0&&(e.metaKey&&(t="Meta-"+t),e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t)),t.length>1&&(t="<{0}>".format(t))}return re.decodeKeystroke(re.encodeKeystroke(t))===t&&(t=re.encodeKeystroke(t)),t},re.isWordChar=function(e){return e.keyCode<123&&e.keyCode>=97||e.keyCode<91&&e.keyCode>=65||e.keyCode<58&&e.keyCode>=48},re.encodeKeystroke=function(e){for(var t,n=/<(?:Ctrl-)?(?:Alt-)?(?:Meta-)?(?:Shift-)?([^>]+|.)>/g,o="",i=0;null!==(t=n.exec(e));)o+=e.substr(i,t.index-i),o+=ae(t[0],t[1]),i=n.lastIndex;return o+=e.substr(i)},re.specialKeys=["Esc","Space","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Backspace","Enter","Tab","Delete","End","Home","Insert","NumLock","PageDown","PageUp","Pause","ScrollLock","CapsLock","PrintScreen","Escape","Hyper"],re.decodeKeystroke=function(e){for(var t="",n=0;n<e.length;n++){var o=e[n].charCodeAt(0);if(o>8192){var i=(o-=8192)%4096>>4,r=15&o;o=o>>12?re.specialKeys[i%256]:String.fromCharCode(i),8&r&&(o="Shift-"+o),4&r&&(o="Meta-"+o),2&r&&(o="Alt-"+o),1&r&&(o="Ctrl-"+o),t+="<"+o+">"}else t+=e[n]}return t};const se=re;function ce(e,t,n){void 0===n&&(n=document),n.dispatchEvent(new CustomEvent(`surfingkeys:${e}`,{detail:t}))}function le(e,t,n){(t=t||{}).action=e,-1!==["closeTab","nextTab","previousTab","moveTab","reloadTab","setZoom","closeTabLeft","closeTabRight","focusTabByIndex"].indexOf(e)&&(t.repeats=le.repeats,le.repeats=1);try{t.needResponse=void 0!==n,chrome.runtime.sendMessage(t,n),"read"===e&&ue.on("onTtsEvent",n)}catch(e){ce("front",["showPopup","[runtime exception] "+e])}}const ue=function(){const e={conf:{autoSpeakOnInlineQuery:!1,lastKeys:"",blocklistPattern:void 0,lurkingPattern:void 0,disabledOnActiveElementPattern:void 0,smartCase:!0,caseSensitive:!1,clickablePat:/(https?:\/\/|thunder:\/\/|magnet:)\S+/gi,clickableSelector:"",editableSelector:"div.CodeMirror-scroll,div.ace_content",cursorAtEndOfInput:!0,defaultLLMProvider:"ollama",defaultSearchEngine:"g",defaultVoice:"Daniel",editableBodyCare:!0,enableAutoFocus:!0,enableEmojiInsertion:!1,experiment:!1,focusFirstCandidate:!1,focusOnSaved:!0,hintAlign:"center",hintExplicit:!1,hintShiftNonActive:!1,historyMUOrder:!0,language:void 0,lastQuery:"",modeAfterYank:"",nextLinkRegex:/(\b(next)\b)|下页|下一页|后页|下頁|下一頁|後頁|>>|»/i,digitForRepeat:!0,omnibarMaxResults:10,omnibarHistoryCacheSize:100,omnibarPosition:"middle",omnibarSuggestion:!0,omnibarSuggestionTimeout:200,omnibarTabsQuery:{},pageUrlRegex:[],prevLinkRegex:/(\b(prev|previous)\b)|上页|上一页|前页|上頁|上一頁|前頁|<<|«/i,richHintsForKeystroke:1e3,scrollStepSize:70,showModeStatus:!1,showProxyInStatusBar:!1,smartPageBoundary:!1,smoothScroll:!0,startToShowEmoji:2,stealFocusOnLoad:!0,tabIndicesSeparator:"|",tabsThreshold:100,verticalTabs:!0,textAnchorPat:/(^[\n\r\s]*\S{3,}|\b\S{4,})/g,ignoredFrameHosts:["https://tpc.googlesyndication.com"],scrollFriction:0,aceKeybindings:"vim",caretViewport:null,mouseSelectToQuery:[],useNeovim:!1,useLocalMarkdownAPI:!0}},t={},n=new Promise((function(e,t){window===top?e(window.location.href):le("getTopURL",null,(function(t){e(t.url)}))}));return e.on=function(e,n){t[e]=n},e.bookMessage=function(e,n){return!t[e]&&(t[e]=n,!0)},e.releaseMessage=function(e){delete t[e]},chrome.runtime.onMessage.addListener((function(e,n,o){t[e.subject]&&t[e.subject](e,n,o)})),e.getTopURL=function(e){n.then((function(t){e(t)}))},e.postTopMessage=function(e){n.then((function(t){window===top&&(t=window.location.origin),"null"!==t&&"file://"!==new URL(t).origin||(t="*"),top.postMessage({surfingkeys_uihost_data:e},t)}))},e.getCaseSensitive=function(t){return e.conf.caseSensitive||e.conf.smartCase&&/[A-Z]/.test(t)},e}(),de=["#4169E1","#E74C3C","#2ECC71","#9B59B6","#F39C12","#16A085","#E67E22","#3498DB","#C0392B","#27AE60","#8E44AD","#D35400","#2980B9","#FF5733","#1ABC9C","#8B008B","#F1C40F","#008080","#FF8C00","#4682B4","#8B0000","#32CD32","#9932CC","#FF4500","#1E90FF","#DC143C","#20B2AA","#BA55D3","#DAA520","#008B8B","#CD853F","#6495ED","#B22222","#3CB371","#9370DB","#A0522D","#87CEEB","#CD5C5C","#48D1CC","#DDA0DD","#FFD700","#5F9EA0","#FFA07A","#00BFFF","#8B4513","#90EE90","#FF69B4","#D2691E","#B0C4DE","#FA8072","#66CDAA","#DB7093","#FF8C69","#556B2F","#FF7F50","#2E8B57","#9400D3","#B8860B","#FF6347","#40E0D0","#DA70D6","#BDB76B","#F4A460","#87CEFA","#98FB98","#C71585","#B0E0E6","#F08080","#7FFFD4","#FFA500","#FF6B6B","#00CED1","#E9967A","#4B0082","#7B68EE","#6A5ACD","#483D8B","#5D478B","#8A2BE2","#7EC0EE","#009ACD","#00868B","#00C78C","#00CD66","#66CD00","#CDCD00","#CD9B1D","#CD6600","#CD4F39","#CD3278","#CD3333","#8B4789","#8B8B00","#8B7355","#8B636C","#2F4F4F","#FF1493","#800080","#708090","#6B8E23"];function fe(e){return de[e]}function pe(e,t,n){ce("front",["addVimMap",e,t,n])}function me(){ce("front",["addVimKeyMap",Array.from(arguments)])}function he(){if(-1!==window.navigator.userAgent.indexOf("Chrome"))return"Chrome";if(0===window.navigator.vendor.indexOf("Apple Computer, Inc.")){return/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?"Safari-iOS":"Safari"}return-1!==window.navigator.userAgent.indexOf("Firefox")?"Firefox":"Chrome"}function ge(){return window!==top&&0===document.location.href.indexOf(chrome.runtime.getURL("/"))}function ye(){var e=window.location.origin?window.location.origin:"*";return"file://"!==e&&"null"!==e||(e="*"),e}function we(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function ve(e,t,n){const o=[];let i;const r=document.createNodeIterator(e,t,null);for(;i=r.nextNode();)n(i)&&o.push(i),i.shadowRoot&&o.push(...ve(i.shadowRoot,t,n));return o}function be(e){var t="a, button, select, input, textarea, summary, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button, *[role=button], *[role=link], *[role=menuitem], *[role=option], *[role=switch], *[role=tab], *[role=checkbox], *[role=combobox], *[role=menuitemcheckbox], *[role=menuitemradio]";return ue.conf.clickableSelector.length&&(t+=", "+ue.conf.clickableSelector),e.matches(t)||"pointer"===getComputedStyle(e).cursor||"url("===getComputedStyle(e).cursor.substr(0,4)||null!==e.closest("a, *[onclick], *[contenteditable=true], *.jfk-button, *.goog-flat-menu-button")}function ke(e,t){ce("front",["showBanner",e,t])}function Ee(e){ce("front",["showPopup",e])}function Se(e,t,n){const o={},i=n?{capture:!0}:{};return document.addEventListener(`surfingkeys:${e}`,(function(e){let i=e.detail;const r=i.shift();n&&(i.length>0&&"Array"===i[0].constructor.name&&"__EVENT_TARGET__"===i[0][0]?i[0][0]=e.target:i.push(e.target)),o.hasOwnProperty(r)&&(o[r](...i),delete o[r]),t.hasOwnProperty(r)&&t[r](...i)}),i),o}function xe(e,t,n){t.forEach((function(t){const o=new MouseEvent(t,{bubbles:!0,cancelable:!0,composed:!0,view:window,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey});e.dispatchEvent(o)}))}function Ce(e){for(var t=e?e.target:document.activeElement;t&&t.shadowRoot;){if(!t.shadowRoot.activeElement){if(t.shadowRoot.querySelector("input, textarea, select")){t=t.shadowRoot.querySelector("input, textarea, select");break}break}t=t.shadowRoot.activeElement}return t===window&&(t=document.body),t}function Te(){var e=Ce(),t=e.value;t.match(/^"|"$/)?e.value=t.replace(/^"?(.*?)"?$/,"$1"):e.value='"'+t+'"'}function _e(e){return e&&!e.disabled&&("textarea"===e.localName||"select"===e.localName||e.isContentEditable||e.matches&&e.matches(ue.conf.editableSelector)||"input"===e.localName&&/^(?!button|checkbox|file|hidden|image|radio|reset|submit)/i.test(e.type))}function Ae(e,t){e=encodeURIComponent(e),t="%23%23+Error+details%0A%0A{0}%0A%0ASurfingKeys%3A+{1}%0A%0AChrome%3A+{2}%0A%0AURL%3A+{3}%0A%0A%23%23+Context%0A%0A%2A%2APlease+replace+this+with+a+description+of+how+you+were+using+SurfingKeys.%2A%2A".format(encodeURIComponent(t),chrome.runtime.getManifest().version,encodeURIComponent(navigator.userAgent),encodeURIComponent(window.location.href)),Ee('<h2>Uh-oh! The SurfingKeys extension encountered a bug.</h2> <p>Please click <a href="https://github.com/brookhong/Surfingkeys/issues/new?title={0}&body={1}" target=_blank>here</a> to start filing a new issue, append a description of how you were using SurfingKeys before this message appeared, then submit it.  Thanks for your help!</p>'.format(e,t))}function Oe(e,t){e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():Le(e,t)||e.scrollIntoView()}function Ne(e,t){var n=_e(e)?1:4;return(t=t||e.getBoundingClientRect()).width>n&&t.height>n&&(parseFloat(getComputedStyle(e).opacity)>.1||"INPUT"==e.tagName&&"text"!=e.type)}function Le(e,t){var n=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth;return(t||Ne(e,n))&&n.top<o&&n.bottom>0&&n.left<i&&n.right>0}function Re(e){for(var t=Array.from(document.documentElement.getElementsByTagName("*")),n=[],o=0;o<t.length;o++){var i=t[o];if(i.shadowRoot)for(var r=i.shadowRoot.querySelectorAll("*"),a=0;a<r.length;a++)t.push(r[a]);var s=i.getBoundingClientRect();s.top<=window.innerHeight&&s.bottom>=0&&s.left<=window.innerWidth&&s.right>=0&&s.height>0&&"hidden"!==getComputedStyle(i).visibility&&e(i,n)}return n}function Ie(e){var t=document.getSelection(),n=[t.type,t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset],o=document.scrollingElement.scrollTop;e(t),document.scrollingElement.scrollTop=o,"None"===n[0]?t.empty():"Caret"===n[0]?t.setPosition(n[3],n[4]):"Range"===n[0]&&(t.setPosition(n[1],n[2]),t.extend(n[3],n[4]))}function Me(e){if(0===e.length)return e;var t=[];return e.forEach((function(e,n){if(Fe(e))t.push(e);else{for(var o=0;o<t.length;o++){if(t[o].contains(e))return void("A"===t[o].tagName&&t[o].href||(t[o]=e));if(t[o].shadowRoot&&t[o].shadowRoot.contains(e))return;if(e.contains(t[o]))return void console.log("skip: ",e,t[o])}t.push(e)}})),t}function Pe(e){var t;return 0===e.childElementCount?3===(t=e.getClientRects()).length?t[1]:2===t.length?t[0]:e.getBoundingClientRect():1===e.childElementCount&&e.firstElementChild.textContent?(((t=e.firstElementChild.getBoundingClientRect()).width<4||t.height<4)&&(t=e.getBoundingClientRect()),t):e.getBoundingClientRect()}function Fe(e){return ue.conf.clickableSelector&&e.matches(ue.conf.clickableSelector)}function Ue(e){return Me(e=e.filter((function(e){var t=Pe(e);if(e.disabled||e.readOnly||!Ne(e,t))return!1;if(e.matches("input, textarea, select, form")||"true"===e.contentEditable||Fe(e))return!0;var n=e.getRootNode().elementFromPoint(t.left+t.width/2,t.top+t.height/2);return!n||n.shadowRoot&&(0===n.childElementCount||n.shadowRoot.contains(e))||n.contains(e)||e.contains(n)})))}function De(e,t){return Ue(ve(document.body,NodeFilter.SHOW_ELEMENT,(function(n){return n.offsetHeight&&n.offsetWidth&&"pointer"===getComputedStyle(n).cursor&&(n.matches(e)||t&&(t.test(n.textContent)||t.test(n.getAttribute("aria-label"))))})))}function Be(e,t,n){var o=["script","style","noscript","surfingkeys_mark"],i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(!e.data.trim()||!e.parentNode.offsetParent||-1!==o.indexOf(e.parentNode.localName.toLowerCase())||!t.test(e.data))return t.lastIndex=0,NodeFilter.FILTER_REJECT;var n=e.parentNode.getBoundingClientRect();return n.width<4||n.height<4?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1),r=[];if(1===n)r.push(i.firstChild());else if(-1===n)r.push(i.lastChild());else{if(0===n)return i;if(2===n)for(;i.nextNode();)r.push(i.currentNode.parentNode);else for(;i.nextNode();)r.push(i.currentNode)}return r}function He(e,t,n){var o=document.getSelection();o.setBaseAndExtent(e,t,e,n?t+n:e.data.length);var i=o.rangeCount>0?o.getRangeAt(0).getClientRects()[0]:null,r={left:-1,top:-1};return i&&i.height>0&&i.width>0&&(r.left=i.left,r.top=i.top,r.width=i.width,r.height=i.height),r}var Ke=document.createRange();function We(){let e=[];try{let t=arguments[1];for(;0===e.length&&t>=0;)Ke.setStart(arguments[0],t),arguments.length>3?Ke.setEnd(arguments[2],arguments[3]):arguments.length>2?Ke.setEnd(arguments[0],arguments[2]):Ke.setEnd(arguments[0],arguments[1]),e=Ke.getClientRects(),t--}catch(e){return[]}return e}function ze(e){let t=e.focusNode.parentElement;Oe(t,!0);var n=We(e.focusNode,e.focusOffset)[0];return n||(n=e.focusNode.getBoundingClientRect()),n?(((n={left:n.left,top:n.top,width:n.width,height:n.height}).left<0||n.left>=window.innerWidth)&&(t.scrollLeft+=n.left-window.innerWidth/2,n.left=window.innerWidth/2),(n.top<0||n.top>=window.innerHeight)&&(t.scrollTop+=n.top-window.innerHeight/2,n.top=window.innerHeight/2),n):null}var qe=null;function je(e){var t=document.getSelection();if(t.focusNode&&t.focusNode.textContent){var n=function(e,t){var n=[0,e.length],o=/\W/;t<0?t=0:t>=e.length&&(t=e.length-1);var i=!0;if(o.test(e[t])){var r=0;for(i=!1;!i&&(t>r||t+r<e.length);)i=t-++r>=0&&!o.test(e[t-r])||t+r<e.length&&!o.test(e[t+r]);t=t-r>=0&&!o.test(e[t-r])?t-r:t+r}if(i){for(var a=t,s=t;a>=0&&!o.test(e[a]);)a--;for(;s<e.length&&!o.test(e[s]);)s++;n=[a+1,s-a-1]}return n}(t.focusNode.textContent,t.focusOffset),o=We(t.focusNode,n[0],n[0]+n[1])[0],i=t.focusNode.textContent.substr(n[0],n[1]);if(o&&i&&(!e||qe&&o.has(qe[0],qe[1],0,0)))return i.trim()}return null}function Ve(e){const t=ue.conf.language||window.navigator.language;"en-US"===t?e((function(e){return e})):fetch(chrome.runtime.getURL("pages/l10n.json")).then((function(e){return e.json()})).then((function(n){"object"==typeof n[t]?(n=n[t],e((function(e){return n[e]?n[e]:e}))):e((function(e){return e}))}))}function Ge(e){let t=e.annotation;"String"===t.constructor.name&&(t=[t]);const n=t[0].match(/^#(\d+)(.*)/);return null!==n&&(e.feature_group=parseInt(n[1]),t[0]=n[2]),e.annotation=0===t[0].length?"":t,e}function $e(e,t,n,o){n=se.encodeKeystroke(n);var i=e.mappings.find(n);if(i){t=se.encodeKeystroke(t),e.mappings.remove(t);var r=Object.assign({},i.meta);o&&(r=Object.assign(r,Ge({annotation:o}))),e.mappings.add(t,r),ge()||ce("front",["addMapkey",e.name,t,n])}return i}function Qe(e){return e.getWords().map((function(t){var n=e.find(t).meta;return{word:t,feature_group:n.feature_group,annotation:n.annotation}})).filter((function(e){return e.annotation&&e.annotation.length>0}))}function Ye(e,t){var n;t=t||5,(n=(n="Array"===e.constructor.name?e:e instanceof NodeList?Array.from(e).map((function(e){return e.href})):e.trim().split("\n")).map((function(e){return e.trim()})).filter((function(e){return e.length>0}))).slice(0,t).forEach((function(e){le("openLink",{tab:{tabbed:!0},url:e})})),n.length>t&&le("queueURLs",{urls:n.slice(t)})}function Xe(e){return e.filter((function(e){return e.offsetHeight&&e.offsetWidth&&!e.getAttribute("disabled")&&Le(e)&&"hidden"!==getComputedStyle(e).visibility}))}function Je(e,t){e.innerHTML=ie.sanitize(t)}function Ze(e,t,n){var o=document.createElement(e);if(t&&Je(o,t),n)for(var i in n)o.setAttribute(i,n[i]);return o}document.addEventListener("mousedown",(e=>{qe=[e.clientX,e.clientY]})),DOMRect.prototype.has=function(e,t,n,o){return t>this.top-o&&t<this.bottom+o&&e>this.left-n&&e<this.right+n},String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","gi");e=e.replace(n,arguments[t])}return e},String.prototype.reverse=function(){return this.split("").reverse().join("")},RegExp.prototype.toJSON=function(){return{source:this.source,flags:this.flags}},Array.prototype.flatMap||(Array.prototype.flatMap=function(e){return Array.prototype.concat.apply([],this.map(e))});var et=document.createElement("div");function tt(e){return et.innerText=e,et.innerHTML}HTMLElement.prototype.one=function(e,t){this.addEventListener(e,(function n(){t.call(this),this.removeEventListener(e,n)}))},HTMLElement.prototype.show=function(){this.style.display=""},HTMLElement.prototype.hide=function(){this.style.display="none"},HTMLElement.prototype.removeAttributes=function(){for(;this.attributes.length>0;)this.removeAttribute(this.attributes[0].name)},HTMLElement.prototype.containsWithShadow=function(e){const t=[this];for(;t.length;){const n=t.shift();if(n.contains(e))return!0;if(t.push(...n.children),n.shadowRoot){if(n.shadowRoot.contains(e))return!0;t.push(...n.shadowRoot.children)}}return!1},NodeList.prototype.remove=function(){this.forEach((function(e){e.remove()}))},NodeList.prototype.show=function(){this.forEach((function(e){e.show()}))},NodeList.prototype.hide=function(){this.forEach((function(e){e.hide()}))};const nt=Ze("div","",{style:"position: fixed; box-shadow: 0px 0px 4px 2px #63b2ff; background: transparent; z-index: 2140000000"});function ot(e,t){var n=Pe(e);nt.style.left=n.left+"px",nt.style.top=n.top+"px",nt.style.width=n.width+"px",nt.style.height=n.height+"px",document.body.appendChild(nt),setTimeout((()=>{nt.remove(),t()}),100)}function it(e,t){const n={candidates:0};if(t.length>0)for(const o of e){const e=o.label;if(t===e){n.matched=o.link;break}0===e.indexOf(t)?(o.style.opacity=1,Je(o,`<span style="opacity: 0.2;">${t}</span>`+e.substr(t.length)),n.candidates++):o.style.opacity=0}else if(1===e.length)n.matched=e[0].link;else{for(const t of e)t.style.opacity=1,Je(t,t.label);n.candidates=e.length}return n}var rt=[];const at=function(e,t){this.name=e,this.statusLine=t,this.eventListeners={},this.addEventListener=function(e,t){return this.eventListeners[e]=t,ft.hasOwnProperty(e)||(ft[e]=function(t){lt(e,t)},window.addEventListener(e,ft[e],!0)),this},this.enter=function(e,t){var n=rt.indexOf(this);if(this.priority||(this.priority=e||rt.length),-1===n)rt.unshift(this);else if(n>0)if(t)rt=rt.slice(n);else{var o=rt.map((function(e){return e.name})).join(",");Ae("Mode {0} pushed into mode stack again.".format(this.name),"Modes in stack: {0}".format(o))}return rt.sort((function(e,t){return e.priority<t.priority?1:t.priority<e.priority?-1:0})),this.onEnter&&this.onEnter(),at.showStatus(),n},this.exit=function(e){var t=rt.indexOf(this);if(-1!==t)if(this.priority=0,e)rt.splice(t,1);else{t++;rt.slice(0,t);rt=rt.slice(t)}at.showStatus(),this.onExit&&this.onExit(t)}};at.getCurrent=()=>rt[0],at.specialKeys={"<Alt-s>":["<Alt-s>"],"<Esc>":["<Esc>"]},at.isSpecialKeyOf=function(e,t){return-1!==at.specialKeys[e].indexOf(se.decodeKeystroke(t))};var st=[];function ct(e,t){t.sk_stopPropagation&&(t.stopImmediatePropagation(),t.preventDefault())}function lt(e,t,n){for(var o=0;o<rt.length&&!t.sk_stopPropagation;o++){var i=rt[o];if(!t.sk_suppressed&&i.eventListeners.hasOwnProperty(e))(0,i.eventListeners[e])(t),ct(0,t);if("Disabled"===i.name)break;n&&n(i)}}at.suppressKeyUp=function(e){-1===st.indexOf(e)&&st.push(e)};let ut=0;var dt=0,ft={sentinel:e=>{ut++},keydown:function(e){if(e.sk_keyName=se.getKeyChar(e),0===rt.length&&window!==top)return ce("iframeBoot"),void document.addEventListener("surfingkeys:userSettingsLoaded",(()=>{lt("keydown",e)}),{once:!0});lt("keydown",e)},keyup:function(e){lt("keyup",e,(function(t){var n=st.indexOf(e.keyCode);-1!==n&&(e.stopImmediatePropagation(),st.splice(n,1))}))},scroll:function(e){lt("scroll",e),dt>0&&(e.stopImmediatePropagation(),e.preventDefault(),dt--)}};function pt(e){for(var t in rt=[],ft)window.addEventListener(t,ft[t],!0);e&&e()}at.hasScroll=function(e,t,n){var o="y"===t?["scrollTop","height"]:["scrollLeft","width"],i=e[o[0]];if(i<n){var r=e[o[0]];e[o[0]]=e.getBoundingClientRect()[o[1]],(i=e[o[0]])!==r&&dt++,e[o[0]]=r}return i>=n},at.getScrollableElements=function(){var e=ve(document.body,NodeFilter.SHOW_ELEMENT,(function(e){return at.hasScroll(e,"y",16)&&e.scrollHeight>200||at.hasScroll(e,"x",16)&&e.scrollWidth>200}));return e.sort((function(e,t){return t.contains(e)?1:e.contains(t)?-1:t.scrollHeight*t.scrollWidth-e.scrollHeight*e.scrollWidth})),document.scrollingElement&&(document.scrollingElement.scrollHeight>window.innerHeight||document.scrollingElement.scrollWidth>window.innerWidth)&&e.unshift(document.scrollingElement),e},at.init=e=>{"about:blank"!==window.location.href||!window.frameElement||document.body&&0!==document.body.childElementCount?pt(e):window.frameElement.addEventListener("load",(function(t){try{pt(e)}catch(e){console.log("Error on blank iframe loaded: "+e)}}))},at.showStatus=function(){if(document.hasFocus()&&rt.length){var e=rt[0],t=e.statusLine||(ue.conf.showModeStatus?e.name:"");if(""!==t&&window!==top&&!ge()){var n=window.location.pathname.split("/");n.length&&(t+=" - frame: "+n[n.length-1])}ce("front",["showStatus",[t]])}},at.finish=function(e){var t=!1;return(e.map_node!==e.mappings||null!=e.pendingMap||e.repeats)&&(e.map_node=e.mappings,e.pendingMap=null,e.isTrustedEvent&&ce("front",["hideKeystroke"]),e.repeats&&(e.repeats=""),t=!0),t},at.handleMapKey=function(e,t){var n=e.sk_keyName;this.isTrustedEvent=this.__trust_all_events__||e.isTrusted;var o=at.isSpecialKeyOf("<Esc>",n);o&&(n=se.encodeKeystroke("<Esc>"));var i=!1;if(o&&at.finish(this))e.sk_stopPropagation=!0,e.sk_suppressed=!0,i=!0;else if(this.pendingMap){this.setLastKeys&&this.setLastKeys(this.map_node.meta.word+n);var r=this.pendingMap.bind(this);e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(n),r(n),i=at.finish(this)}else if(void 0!==this.repeats&&this.map_node===this.mappings&&ue.conf.digitForRepeat&&(n>="1"||""!==this.repeats&&n>="0")&&n<="9"&&this.map_node.getWords().length>0)this.repeats+=n,this.isTrustedEvent&&ce("front",["showKeystroke",n,this]),e.sk_stopPropagation=!0;else{var a=this.map_node;if(this.map_node=this.map_node.find(n),this.map_node)if(this.map_node.meta){var s=this.map_node.meta.code;if(s.length)this.pendingMap=s,this.isTrustedEvent&&ce("front",["showKeystroke",n,this]),e.sk_stopPropagation=!0;else{for(this.setLastKeys&&this.setLastKeys(this.map_node.meta.word),le.repeats=parseInt(this.repeats)||1,e.sk_stopPropagation=!this.map_node.meta.stopPropagation||this.map_node.meta.stopPropagation(n);le.repeats>0;)s(),le.repeats--;i=at.finish(this)}}else this.isTrustedEvent&&ce("front",["showKeystroke",n,this]),e.sk_stopPropagation=!0;else t&&t(a),e.sk_suppressed=a!==this.mappings,i=at.finish(this)}return i},at.checkEventListener=e=>{const t=ut;window.dispatchEvent(new CustomEvent("sentinel")),t===ut&&(pt(),e())};const mt=at;function ht(){arguments.length>0&&(this.stem=arguments[0]),arguments.length>1&&(this.meta=arguments[1])}ht.prototype={find:function(e){for(var t=this,n=e.length,o=0;o<n&&t;o++)t=t[e[o]];return t},add:function(e,t){for(var n=this,o=e.length,i=0;i<o;i++){var r=e[i];if(n.hasOwnProperty(r))n=n[r];else{var a=new ht(r);n[r]=a,n=a}}t.word=e,n.meta=t},remove:function(e){for(var t=this,n=e.length,o=[],i=0;i<n&&t;i++)o.push(t),t=t[e[i]];if(t){var r=o[i=o.length-1];delete r[t.stem];for(var a=r;a!==this&&1===Object.keys(a).length;)delete(r=o[--i])[a.stem],a=r}return t},getWords:function(e,t){var n=[];e=(e||"")+(t?"":this.stem||"");for(var o in this.hasOwnProperty("meta")&&n.push(e),this)1===o.length&&(n=n.concat(this[o].getWords(e)));return n},getMetas:function(e){var t=[];for(var n in this.hasOwnProperty("meta")&&e(this.meta)&&t.push(this.meta),this)1===n.length&&(t=t.concat(this[n].getMetas(e)));return t},getPrefixWord:function(){if(0===Object.keys(this).length)return"";for(var e="",t=this.stem,n=this;""===e;)for(var o=Object.keys(n),i=0;i<o.length;i++){if("meta"===o[i]){e=n.meta.word;break}if("stem"!==o[i]){t+=o[i],n=n[o[i]];break}}return e.substr(0,e.length-t.length+1)}};const gt=ht;const yt=function(e){var t=new mt("Normal");t.mappings=new gt,t.map_node=t.mappings;var n=!1;let o;t.passFocus=function(e){n=e},t.startLurk=()=>{let e="lurking";return o?mt.getCurrent()!==o&&(e="enabled"):(t.exit(),o=function(e){const t=new mt("Lurk");function n(){e.enter(),window===top&&le("setSurfingkeysIcon",{status:"enabled"})}return t.mappings=new gt,t.map_node=t.mappings,t.mappings.add(se.encodeKeystroke("<Alt-i>"),{annotation:"Enter normal mode",feature_group:16,code:n}),t.mappings.add("p",{annotation:"Enter ephemeral normal mode to temporarily enable SurfingKeys",feature_group:16,code:function(){n(),setTimeout((()=>{e.revertToLurk()}),1e3)}}),t.addEventListener("keydown",(function(e){!_e(Ce(e))&&e.sk_keyName.length&&(mt.handleMapKey.call(t,e),e.sk_stopPropagation&&mt.suppressKeyUp(e.keyCode))})),t}(t),i.forEach((e=>{$e(o,e[0],e[1]),o.mappings.remove(se.encodeKeystroke(e[1]))})),i=void 0,o.enter(0,!0)),e},t.revertToLurk=()=>{t.exit(!0),window===top&&le("setSurfingkeysIcon",{status:"lurking"})},t.getLurkMode=()=>o;let i=[];t.addLurkMap=(e,t)=>{i.push([e,t])};var r=!1;t.addEventListener("keydown",(function(n){var i=Ce(n);if(_e(i)&&n.isTrusted)if(mt.isSpecialKeyOf("<Esc>",n.sk_keyName))i.blur(),e.exit();else if(ue.conf.editableBodyCare&&i===document.body&&"i"!==n.key)t.statusLine="Press i to enter Insert mode",ue.conf.showModeStatus=!0,n.sk_keyName.length&&mt.handleMapKey.call(t,n);else{n.sk_stopPropagation=ue.conf.editableBodyCare&&i===document.body&&"i"===n.key,n.sk_stopPropagation&&(t.passFocus(!0),i.focus());var a=!1;if(!Le(i)){for(var s=i;s!==document.documentElement&&!s.newlyCreated;)s=s.parentElement;a=s!==document.documentElement&&s.newlyCreated}a?(i.blur(),delete s.newlyCreated,mt.handleMapKey.call(t,n)):e.enter(i,!0)}else if(mt.isSpecialKeyOf("<Alt-s>",n.sk_keyName))t.toggleBlocklist(),mt.finish(t),n.sk_stopPropagation=!0;else if(n.sk_keyName.length){var c=mt.handleMapKey.call(t,n,(()=>{mt.isSpecialKeyOf("<Esc>",n.sk_keyName)&&o&&t.revertToLurk()}));r&&c&&(r=!1,t.exit())}n.sk_stopPropagation&&mt.suppressKeyUp(n.keyCode)})),t.addEventListener("blur",(function(e){l=0})),t.addEventListener("focus",(function(e){if(mt.showStatus(),ue.conf.stealFocusOnLoad&&!ge()){var t=Ce(e);_e(t)&&(n||t.enableAutoFocus?ue.conf.enableAutoFocus||(n=!1):(t.blur(),e.sk_stopPropagation=!0))}})),t.addEventListener("keyup",(function(e){setTimeout((function(){l=0}),0)})),t.addEventListener("mousedown",(function(n){ue.conf.enableAutoFocus?t.passFocus(!0):t.passFocus(n.isTrusted);var o=Ce(n);_e(o)?e.enter(o,!0):e.exit()})),t.toggleBlocklist=function(){0!==document.location.href.indexOf(chrome.runtime.getURL("/"))?le("toggleBlocklist",{blocklistPattern:ue.conf.blocklistPattern?ue.conf.blocklistPattern:""},(function(e){"disabled"===e.state?e.blocklist.hasOwnProperty(".*")?ke("Surfingkeys is globally disabled, please enable it globally from popup menu.",3e3):ke("Surfingkeys turned OFF for "+e.url,3e3):ke("Surfingkeys turned ON for "+e.url,3e3)})):ke("You could not toggle Surfingkeys on its own pages.",3e3)};const a=function(){var e,t,n=new mt("PassThrough");return n.addEventListener("keydown",(function(o){o.sk_suppressed=!0,mt.isSpecialKeyOf("<Esc>",o.sk_keyName)?(n.exit(),o.sk_stopPropagation=!0):t>0&&(e&&(clearTimeout(e),e=void 0),e=setTimeout((function(){n.exit()}),t))})).addEventListener("mousedown",(function(e){e.sk_suppressed=!0})),n.addEventListener("focus",(function(e){e.sk_suppressed=!0})),n.onEnter=function(){t>0?(e=setTimeout((function(){n.exit()}),t),n.statusLine=`ephemeral(${t}ms) pass through`):n.statusLine="pass through"},n.setTimeout=function(e){t=e},n}();t.passThrough=function(e){return a.setTimeout(e),a.enter(),a},t.once=()=>{r=!0,t.enter()},t.mappings.add(se.encodeKeystroke("<Alt-i>"),{annotation:"Enter PassThrough mode to temporarily suppress SurfingKeys",feature_group:0,code:function(){t.passThrough()}}),t.mappings.add("p",{annotation:"Enter ephemeral PassThrough mode to temporarily suppress SurfingKeys",feature_group:0,code:function(){t.passThrough(1e3)}}),t.repeats="";var s,c,l=0,u=0,d=[];function f(){s&&0!==s.length||((s=mt.getScrollableElements()).forEach((function(e){e.removeEventListener("mousedown",p),e.addEventListener("mousedown",p),e.dataset.hint_scrollable=!0})),u=0)}function p(e){if(e.currentTarget.contains(e.target)){for(var t=s.lastIndexOf(e.target),n=s.length-1;n>=0&&-1===t;n--)s[n]!==document.body&&s[n].contains(e.target)&&(t=n);-1!==t&&(u=t)}}function m(){le("localData",{data:{lastKeys:c}})}t.highlightElement=function(e){var t;ce("front",["highlightElement",{duration:200,rect:{top:(t=document.scrollingElement===e?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:e.getBoundingClientRect()).top,left:t.left,width:t.width,height:t.height}}])},t.scroll=function(e){f();var n=document.scrollingElement;if(s.length>0&&(n=s[u])!==document.scrollingElement&&n!==document.body){var o=n.getBoundingClientRect();0!==o.width&&0!==o.height&&Le(n)&&(mt.hasScroll(n,"x",16)||mt.hasScroll(n,"y",16))||(t.refreshScrollableElements(),n=s[u])}if(n||document.scrollingElement||!document.body||(document.body.style.overflow="visible",n=document.scrollingElement),n){var i;n.skScrollBy||((i=n).skScrollBy=function(e,t){if(ue.conf.smartPageBoundary&&(this===document.scrollingElement||1===s.length&&this===s[0])){if(0===this.scrollTop&&t<0)return ce("hints",["topBoundaryHit"]);if(this.scrollHeight-this.scrollTop<=this.clientHeight+1&&t>0)return ce("hints",["bottomBoundaryHit"])}if(le.repeats>1&&(e=le.repeats*e,t=le.repeats*t,le.repeats=0),ue.conf.smoothScroll){var n=Math.max(100,20*Math.log(Math.abs(e||t)));i.smoothScrollBy(e,t,n)}else ce("hints",["scrollStarted"]),i.scrollBy({behavior:"instant",left:e,top:t}),ce("hints",["scrollDone"])},i.safeScroll_=(e,t,n)=>{const o=i===document.scrollingElement?window.innerHeight:i.clientHeight,r=i===document.scrollingElement?window.innerWidth:i.clientWidth,a="scrollTop"===e?[0,i.scrollHeight-o]:[0,i.scrollWidth-r],s=n?a[1]:a[0];return t>=a[0]&&t<=a[1]?(i[e]=t,!1):(i[e]=s,!0)},i.smoothScrollBy=function(e,t,n){if(!l){var[o,r]=t?["scrollTop",t]:["scrollLeft",e],a=n,s=0,c=i[o],u=!1;function d(e){if(0===s)return s=e,ce("hints",["scrollStarted"]),window.requestAnimationFrame(d);var t=i[o],n=(e-s)*r/a;let f=!1;Math.abs(t+n-c)>=Math.abs(r)?(u=!0,l>ue.conf.scrollFriction?(f=i.safeScroll_(o,t+n,r>0),c=i[o]):l>0?l++:f=i.safeScroll_(o,c+r,r>0)):f=i.safeScroll_(o,t+n,r>0),s=e,l||!f&&!u?window.requestAnimationFrame(d):(i.style.scrollBehavior="",ce("hints",["scrollDone"]))}l=1,i.style.scrollBehavior="auto",window.requestAnimationFrame(d)}},d.push(i));var r=n===document.scrollingElement?[window.innerWidth,window.innerHeight]:[n.offsetWidth,n.offsetHeight];switch(n.lastScrollTop=n.scrollTop,n.lastScrollLeft=n.scrollLeft,e){case"down":n.skScrollBy(0,ue.conf.scrollStepSize);break;case"up":n.skScrollBy(0,-ue.conf.scrollStepSize);break;case"pageDown":n.skScrollBy(0,Math.round(r[1]/2));break;case"fullPageDown":n.skScrollBy(0,r[1]);break;case"pageUp":n.skScrollBy(0,-Math.round(r[1]/2));break;case"fullPageUp":n.skScrollBy(0,-r[1]);break;case"top":n.skScrollBy(0,-n.scrollTop);break;case"bottom":n.skScrollBy(n.scrollLeft,n.scrollHeight-n.scrollTop);break;case"left":n.skScrollBy(-Math.round(ue.conf.scrollStepSize/2),0);break;case"right":n.skScrollBy(Math.round(ue.conf.scrollStepSize/2),0);break;case"leftmost":n.skScrollBy(-n.scrollLeft-10,0);break;case"rightmost":n.skScrollBy(n.scrollWidth-n.scrollLeft-r[0]+20,0);break;case"byRatio":var a=parseInt(le.repeats*n.scrollHeight/100)-r[1]/2-n.scrollTop;le.repeats=0,n.skScrollBy(0,a)}ce("observer",["turnOff"])}},t.refreshScrollableElements=function(){return s=null,f(),s},t.addScrollableElement=function(e){s&&(e.contains(s[u])||-1!==s.indexOf(e))||(f(),s.push(e),u=s.length-1)},t.rotateFrame=function(){le("nextFrame",{frameId:window.frameId})},t.feedkeys=function(e){setTimeout((function(){for(var n=new Event("keydown"),o=0;o<e.length;o++)n.sk_keyName=e[o],mt.handleMapKey.call(t,n)}),1)},t.setLastKeys=function(e){!this.map_node.meta.repeatIgnore&&e.length>1&&(c=[e],m())},t.appendKeysForRepeat=function(e,t){c&&c.length>0&&(c.push("{0}\t{1}".format(e,t)),m())},t.addVIMark=function(e,t){t=t||window.location.href;var n={};n[e]={url:t,scrollLeft:document.scrollingElement.scrollLeft,scrollTop:document.scrollingElement.scrollTop},le("addVIMark",{mark:n}),ke("Mark '{0}' added for: {1}.".format(e,t))},t.jumpVIMark=function(e){if("'"===e){let e=document.scrollingElement;if(f(),s.length>0&&(e=s[u],void 0!==e.lastScrollTop&&void 0!==e.lastScrollLeft)){const t=e.scrollTop,n=e.scrollLeft;e.scrollTop=e.lastScrollTop,e.scrollLeft=e.lastScrollLeft,e.lastScrollTop=t,e.lastScrollLeft=n}}else le("jumpVIMark",{mark:e})},t.moveTab=function(e){le("moveTab",{position:e})},t.captureElement=function(e){le("getCaptureSize",null,(function(t){var n=t.width/window.innerWidth;e.scrollTop=0,e.scrollLeft=0;var o=-1,i=-1,r=e.style.overflowY;e.style.overflowY="hidden";var a=e.style.overflowX;e.style.overflowX="hidden";var s=e.style.borderStyle;e.style.borderStyle="none",ce("front",["toggleStatus",!1]);var c,l,u,d,f,p,m=0,h=0,g=e.scrollHeight,y=e.scrollWidth;if(e===document.scrollingElement)f=window.innerWidth,p=window.innerHeight,c=0,l=0;else{var w=e.getBoundingClientRect(),v=[Math.max(w.left,0),Math.max(w.top,0),Math.min(w.right,window.innerWidth),Math.min(w.bottom,window.innerHeight)];f=v[2]-v[0],p=v[3]-v[1],c=v[0]*n,l=v[1]*n}u=f*n,d=p*n;var b=document.createElement("canvas");b.width=y*n,b.height=g*n;var k=b.getContext("2d"),E=(w=e.getBoundingClientRect(),document.createElement("img"));E.onload=function(){k.drawImage(E,c,l,u,d,m,h,u,d),o===e.scrollTop?i===e.scrollLeft?(ce("front",["toggleStatus",!0]),Ee("<img src='{0}' />".format(b.toDataURL("image/png"))),e.style.overflowY=r,e.style.overflowX=a,e.style.borderStyle=s):(o=-1,e.scrollTop=0,h=0,i=e.scrollLeft,e.scrollLeft+2*f<y?(e.scrollLeft+=f,m+=f*n):(e.scrollLeft+=y%f,m=e.scrollLeft*n),setTimeout((function(){le("captureVisibleTab",null,(function(e){E.src=e.dataUrl}))}),1e3)):(o=e.scrollTop,e.scrollTop+2*p<g?(e.scrollTop+=p,h+=p*n):(e.scrollTop+=g%p,h=e.scrollTop*n),setTimeout((function(){le("captureVisibleTab",null,(function(e){E.src=e.dataUrl}))}),1e3))},setTimeout((function(){le("captureVisibleTab",null,(function(e){E.src=e.dataUrl}))}),500)}))},t.mappings.add("yG",{annotation:"Capture current full page",feature_group:7,code:function(){t.captureElement(document.scrollingElement)}}),t.mappings.add("yS",{annotation:"Capture scrolling element",feature_group:7,code:function(){var e=document.scrollingElement;f(),s.length>0&&(e=s[u]),t.captureElement(e)}}),t.mappings.add("cS",{annotation:"Reset scroll target",feature_group:2,code:function(){if(s=null,f(),s.length>0){var e=s[u];t.highlightElement(e)}}});const h=e=>{const n=t.scroll.bind(t,e);return n.isSKScrollInHints=!0,n};function g(e){-1===ue.conf.mouseSelectToQuery.indexOf(window.origin)||be(e.target)||e.target.matches(".cm-matchhighlight")||setTimeout((()=>{ce("front",["querySelectedWord"])}),1)}t.isScrollKeyInHints=e=>{const n=t.mappings[e];return n&&n.meta&&n.meta.code&&n.meta.code.isSKScrollInHints},t.mappings.add("e",{annotation:"Scroll half page up",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"pageUp")}),t.mappings.add("U",{annotation:"Scroll full page up",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"fullPageUp")}),t.mappings.add("d",{annotation:"Scroll half page down",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"pageDown")}),t.mappings.add("P",{annotation:"Scroll full page down",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"fullPageDown")}),t.mappings.add("gg",{annotation:"Scroll to the top of the page",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"top")}),t.mappings.add("G",{annotation:"Scroll to the bottom of the page",feature_group:2,repeatIgnore:!0,code:h("bottom")}),t.mappings.add("j",{annotation:"Scroll down",feature_group:2,repeatIgnore:!0,code:h("down")}),t.mappings.add("k",{annotation:"Scroll up",feature_group:2,repeatIgnore:!0,code:h("up")}),t.mappings.add("h",{annotation:"Scroll left",feature_group:2,repeatIgnore:!0,code:h("left")}),t.mappings.add("l",{annotation:"Scroll right",feature_group:2,repeatIgnore:!0,code:h("right")}),t.mappings.add("0",{annotation:"Scroll all the way to the left",feature_group:2,repeatIgnore:!0,code:h("leftmost")}),t.mappings.add("$",{annotation:"Scroll all the way to the right",feature_group:2,repeatIgnore:!0,code:h("rightmost")}),t.mappings.add("%",{annotation:"Scroll to percentage of current page",feature_group:2,repeatIgnore:!0,code:t.scroll.bind(t,"byRatio")}),t.mappings.add("cs",{annotation:"Change scroll target",feature_group:2,repeatIgnore:!0,code:function(){!function(e){if((s=mt.getScrollableElements()).length>0){u=(u+1)%s.length;var n=s[u];Oe(n),e||t.highlightElement(n)}}()}}),t.mappings.add("/",{annotation:"Find in current page",feature_group:9,repeatIgnore:!0,code:function(){ce("front",["openFinder"])}}),t.mappings.add("E",{annotation:"Go one tab left",feature_group:3,repeatIgnore:!0,code:function(){le("previousTab")}}),t.mappings.add("R",{annotation:"Go one tab right",feature_group:3,repeatIgnore:!0,code:function(){le("nextTab")}});var y=null;return t.disable=function(e){y||(y=function(e){const t=new mt("Disabled");return t.statusLine="",t.priority=99,t.activatedOnElement=!1,t.addEventListener("keydown",(function(n){n.sk_suppressed=!0,t.activatedOnElement&&!document.activeElement.matches(ue.conf.disabledOnActiveElementPattern)?(e.enable(),t.activatedOnElement=!1):mt.isSpecialKeyOf("<Alt-s>",n.sk_keyName)&&(e.toggleBlocklist(),t.exit(),n.sk_stopPropagation=!0)})),t}(t),y.enter(0,!0)),y.activatedOnElement=e,ce("observer",["turnOff"]),document.removeEventListener("mouseup",g)},t.enable=function(){y&&(y.exit(),y=null),document.addEventListener("mouseup",g)},t.enable(),t.onExit=function(){ce("observer",["turnOff"]),d.forEach((function(e){delete e.skScrollBy,delete e.smoothScrollBy}))},t};const wt=function(e){var t=void 0,n=new MutationObserver((function(n){var o=[];for(var i of n)for(var r of i.addedNodes)r.nodeType!==Node.ELEMENT_NODE||r.fromSurfingKeys||(r.newlyCreated=!0,o.push(r));o.length&&(t&&(clearTimeout(t),t=void 0),t=setTimeout((function(){var t=Re((function(e,t){var n=e.getBoundingClientRect();n.width>300&&n.height>300&&n.width<=window.innerWidth&&n.height<=window.innerHeight&&n.top>=0&&n.left>=0&&mt.hasScroll(e,"y",16)&&function(e){for(;e!==document.body;){if("relative"===getComputedStyle(e).position)return!0;e=e.parentElement}return!1}(e)&&t.push(e)}));t.length&&e.addScrollableElement(t[0])}),200))}));n.isConnected=!1,Se("observer",{turnOn:()=>{n.isConnected||(n.observe(document,{childList:!0,subtree:!0}),n.isConnected=!0)},turnOff:()=>{n.isConnected&&(n.disconnect(),n.isConnected=!1)}})};const vt=class{#e=!1;constructor(e,t,n){this.element=Ze("div","",{class:"sk_cursor_prompt",style:"display: block; opacity: 1;"}),this.renderer=e,this.picker=t,this.fetcher=n,this.initMode()}initMode(){const e=new mt("CursorPrompt");e.addEventListener("keydown",(function(t){t.sk_keyName.length&&mt.handleMapKey.call(e,t),t.sk_suppressed=!0})),e.addEventListener("keyup",this.onKeyUp.bind(this)),e.mappings=new gt,e.map_node=e.mappings,e.mappings.add(se.encodeKeystroke("<Esc>"),{code:this.close.bind(this)}),e.mappings.add(se.encodeKeystroke("<Enter>"),{code:this.onEnter.bind(this)}),e.mappings.add(se.encodeKeystroke("<Tab>"),{code:this.rotate.bind(this,!1)}),e.mappings.add(se.encodeKeystroke("<Shift-Tab>"),{code:this.rotate.bind(this,!0)}),this.mode=e}activate(e,t,n,o){this.insertOffset=o||0,this.threshold=n||0,this.parentElement=e,this.isNativeInput=void 0!==e.selectionStart&&void 0!==e.value;let i="";[i,this.matchStart]=this.#t(),this.activator=i[this.matchStart-1],t&&t.length&&(this.data=t),this.data?this.#n():this.fetcher&&this.fetcher.then((e=>{this.data=e,this.#n()})),this.#e=!1,this.mode.enter()}rotate(e){const t=Array.from(this.element.children);if(1===t.length)return void this.onEnter();const n=this.element.querySelector("div.selected"),o=(t.indexOf(n)+(e?-1:1))%t.length;n.classList.remove("selected"),t[o].classList.add("selected"),this.#e=!0}onEnter(){const e=this.picker(this.element.querySelector("div.selected")),t=this.matchStart+e.length;if(this.isNativeInput){const n=this.parentElement.value;this.parentElement.value=n.substr(0,this.matchStart+this.insertOffset)+e+n.substr(this.parentElement.selectionStart),this.parentElement.setSelectionRange(t,t)}else{const n=document.getSelection(),o=n.focusNode.data;n.focusNode.data=o.substr(0,this.matchStart+this.insertOffset)+e+o.substr(n.focusOffset),n.setPosition(n.focusNode,t)}this.close(),this.matchStart=-1}#t(){if(this.isNativeInput)return[this.parentElement.value,this.parentElement.selectionStart];{const e=document.getSelection();return[e.focusNode.data,e.focusOffset]}}onKeyUp(e){if(!this.#e&&-1!==this.matchStart){let[e,t]=this.#t();t<this.matchStart||e[this.matchStart-1]!==this.activator?this.element.remove():this.#n()}this.#e=!1}close(){this.element.remove(),this.mode.exit()}#n(){let e="";if(this.isNativeInput)e=this.parentElement.value.substr(this.matchStart,this.parentElement.selectionStart-this.matchStart);else{const t=document.getSelection();e=t.focusNode.data.substr(this.matchStart,t.focusOffset-this.matchStart)}if(e.length<this.threshold||" "===e[0])this.element.remove();else{const t=this.data.filter((function(t){return-1!==t.indexOf(e)})).slice(0,5).map(this.renderer).join("");if(""===t)this.element.remove();else{Je(this.element,t),document.body.append(this.element),this.element.firstElementChild.classList.add("selected");const e=this.isNativeInput?this.#o(this.parentElement):ze(document.getSelection());let n=e.top+e.height+4;this.element.style.borderRadius="0px 0px 4px 4px",window.innerHeight-n<this.element.offsetHeight&&(n=e.top-this.element.offsetHeight,this.element.style.borderRadius="4px 4px 0px 0px"),this.element.style.position="fixed",this.element.style.top=n+"px",this.element.style.left=e.left+"px"}}}#o(e){var t=getComputedStyle(e),n=e.getBoundingClientRect(),o=document.createElement("div"),i=document.createElement("span");o.style.font=t.font,o.style.position="fixed",Je(o,e.value),o.style.left=e.clientLeft+n.left+"px",o.style.top=e.clientTop+n.top+"px",o.style.color="red",o.style.overflow="scroll",o.style.visibility="hidden",o.style.whiteSpace="pre-wrap",o.style.padding=t.padding,o.style.width=t.width,o.style.height=t.height,i.innerText="I";var r=e.selectionStart;if(r===e.value.length)o.appendChild(i);else{var a=o.childNodes[0].splitText(r);o.insertBefore(i,a)}return document.body.appendChild(o),Oe(i),n=i.getBoundingClientRect(),o.remove(),n}};const bt=function(){var e=new mt("Insert");function t(){var e=Ce();if(void 0!==e.setSelectionRange)try{e.setSelectionRange(e.value.length,e.value.length)}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}else if(_e(e)&&e.childNodes.length>0){var t=e.childNodes[e.childNodes.length-1];if(t.nodeType===Node.TEXT_NODE)document.getSelection().setPosition(t,t.data.length);else{t.querySelector(".CodeMirror-line")?function(e){let t=document.createRange();t.selectNodeContents(e),t.collapse(!1);let n=window.getSelection();n.removeAllRanges(),n.addRange(t)}(e):document.getSelection().setPosition(t,t.childNodes.length)}}}e.mappings=new gt,e.map_node=e.mappings,e.mappings.add(se.encodeKeystroke("<Ctrl-e>"),{annotation:"Move the cursor to the end of the line",feature_group:15,code:t});const n="Windows"===se.platform?"<Ctrl-f>":"<Ctrl-a>";e.mappings.add(se.encodeKeystroke(n),{annotation:"Move the cursor to the beginning of the line",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange)e.setSelectionRange(0,0);else{var t=document.getSelection();t.setPosition(t.focusNode,0)}}}),e.mappings.add(se.encodeKeystroke("<Ctrl-u>"),{annotation:"Delete all entered characters before the cursor",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange)e.value=e.value.substr(e.selectionStart),e.setSelectionRange(0,0);else{var t=document.getSelection();t.focusNode.data=t.focusNode.data.substr(t.focusOffset)}}}),e.mappings.add(se.encodeKeystroke("<Alt-b>"),{annotation:"Move the cursor Backward 1 word",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange){var t=i(e.value,-1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","backward","word")}}),e.mappings.add(se.encodeKeystroke("<Alt-f>"),{annotation:"Move the cursor Forward 1 word",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange){var t=i(e.value,1,e.selectionStart);e.setSelectionRange(t,t)}else document.getSelection().modify("move","forward","word")}}),e.mappings.add(se.encodeKeystroke("<Alt-w>"),{annotation:"Delete a word backwards",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange){var t=r(e.value,-1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","backward","word");var i=n.focusNode.data,a=n.focusOffset;n.focusNode.data=i.substr(0,a)+i.substr(o),n.setPosition(n.focusNode,a)}}}),e.mappings.add(se.encodeKeystroke("<Alt-d>"),{annotation:"Delete a word forwards",feature_group:15,code:function(){var e=Ce();if(void 0!==e.setSelectionRange){var t=r(e.value,1,e.selectionStart);e.value=t[0],e.setSelectionRange(t[1],t[1])}else{var n=document.getSelection(),o=n.focusOffset;document.getSelection().modify("move","forward","word");var i=n.focusNode.data,a=n.focusOffset;n.focusNode.data=i.substr(0,o)+i.substr(a),n.setPosition(n.focusNode,o)}}}),e.mappings.add(se.encodeKeystroke("<Esc>"),{annotation:"Exit insert mode",feature_group:15,stopPropagation:function(e){return e.charCodeAt(0)<256},code:function(){Ce().blur(),e.exit()}});const o=new vt((e=>{const t=e.split("\t"),n=String.fromCodePoint.apply(null,t[0].split(","));return"<div><span>{0}</span>{1}</div>".format(n,t[1])}),(e=>e.firstElementChild.innerText),new Promise((e=>{fetch(chrome.runtime.getURL("pages/emoji.tsv")).then((e=>Promise.all([e.text()]))).then((t=>{e(t[0].split("\n"))}))})));function i(e,t,n){var o=/\W/;for(n=t>0?n:n+t;;){if(n<0){n=0;break}if(n>=e.length){n=e.length;break}if(o.test(e[n]))break;n+=t}return n}function r(e,t,n){var o=i(e,t,n);return[o>n?e.substr(0,n)+e.substr(o):o<n?e.substr(0,o)+e.substr(n):e.substr(0,o)+e.substr(o+1),t>0?n:o]}var a;e.enableEmojiInsertion=()=>{e.mappings.add(":",{annotation:"Input emoji",feature_group:15,stopPropagation:function(){return!1},code:function(){setTimeout((()=>{o.activate(Ce(),void 0,ue.conf.startToShowEmoji,-1)}),100)}})},e.addEventListener("keydown",(function(t){t.key&&t.key.charCodeAt(0)>127?t.sk_suppressed=!0:(_e(Ce(t))?t.sk_keyName.length&&mt.handleMapKey.call(e,t,(function(e){var t=e.getPrefixWord();if(t){var n=Ce(),o=n.value,i=n.selectionStart;if(void 0!==o&&void 0!==i)n.value=o.substr(0,n.selectionStart)+t+o.substr(n.selectionEnd),i+=t.length,n.setSelectionRange(i,i);else{var r=(n=document.getSelection()).getRangeAt(0),a=document.createTextNode(t);"Caret"===n.type?void 0===(o=n.focusNode.data)?(r.insertNode(a),n.setPosition(a,a.length)):(i=n.focusOffset,n.focusNode.data=o.substr(0,i)+t+o.substr(i),n.setPosition(n.focusNode,i+t.length)):(r.deleteContents(),r.insertNode(a),n.setPosition(a,a.length))}}})):e.exit(),t.sk_suppressed=!0)})),e.addEventListener("focus",(function(t){var n=Ce(t);t.target==window||_e(n)?t.sk_suppressed=!0:e.exit()}));var s=e.enter;return e.enter=function(n,o){n===document.body&&(ue.conf.showModeStatus=!1);var i=-1===s.call(e,0,!0);a!==n&&(a=n,i=!0),i&&!o&&ue.conf.cursorAtEndOfInput&&"SELECT"!==n.nodeName&&t()},e};const kt=function(e,t){var n=new mt("Visual");n.addEventListener("keydown",(function(e){if(g){var t=!1;e.sk_stopPropagation=!0,e.sk_suppressed=!0,se.isWordChar(e)?(w(g,e.sk_keyName),y=[g,e.sk_keyName],t=!0):mt.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(t=!0),t&&(n.statusLine=n.name+" - "+p[f],mt.showStatus(),g=0)}else e.sk_keyName.length&&(mt.handleMapKey.call(n,e),e.sk_stopPropagation?e.sk_suppressed=!0:mt.isSpecialKeyOf("<Esc>",e.sk_keyName)&&(f>1?(n.hideCursor(),l.collapse(l.anchorNode,l.anchorOffset),n.showCursor()):(n.visualClear(),n.exit()),f--,C(),e.sk_stopPropagation=!0,e.sk_suppressed=!0))})),n.addEventListener("scroll",(function(e){u.forEach((function(e){const t=We(e[0],e[1])[0];e[2].forEach((e=>{e.style.left=document.scrollingElement.scrollLeft+t.left+"px",e.style.top=document.scrollingElement.scrollTop+t.top+"px"}))}))})),n.addEventListener("click",(function(e){switch(l.type){case"None":n.hideCursor(),f=0;break;case"Caret":f&&(n.hideCursor(),0===f&&(f=1),n.showCursor());break;case"Range":f&&(n.hideCursor(),f=2,n.showCursor())}C()})),n.addEventListener("resize",(function(e){ue.conf.lastQuery&&n.visualUpdate(ue.conf.lastQuery),u[d]&&v(u[d])}));let o=null;const i=()=>{o&&o.forEach((e=>{e.remove()}))};n.addEventListener("selectionchange",(function(e){var t,n,r,a;i(),t=l.anchorNode,n=l.anchorOffset,r=l.focusNode,a=l.focusOffset,o=E("surfingkeys_selection_mark",t,n,r,a)})),n.mappings=new gt,n.map_node=n.mappings,n.repeats="",n.mappings.add("l",{annotation:"forward character",feature_group:9,code:b}),n.mappings.add("h",{annotation:"backward character",feature_group:9,code:b}),n.mappings.add("j",{annotation:"forward line",feature_group:9,code:b}),n.mappings.add("k",{annotation:"backward line",feature_group:9,code:b}),n.mappings.add("w",{annotation:"forward word",feature_group:9,code:b}),n.mappings.add("e",{annotation:"forward word",feature_group:9,code:b}),n.mappings.add("b",{annotation:"backward word",feature_group:9,code:b}),n.mappings.add(")",{annotation:"forward sentence",feature_group:9,code:b}),n.mappings.add("(",{annotation:"backward sentence",feature_group:9,code:b}),n.mappings.add("}",{annotation:"forward paragraphboundary",feature_group:9,code:b}),n.mappings.add("{",{annotation:"backward paragraphboundary",feature_group:9,code:b}),n.mappings.add("0",{annotation:"backward lineboundary",feature_group:9,code:b}),n.mappings.add("$",{annotation:"forward lineboundary",feature_group:9,code:b}),n.mappings.add("G",{annotation:"forward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=document.scrollingElement.scrollHeight,"Firefox"!==he()?b():(n.hideCursor(),l.setPosition(document.body.lastChild,0),n.showCursor()),u.length&&ce("front",["showStatus",[void 0,void 0,(d=u.length-1)+1+" / "+u.length]])}}),n.mappings.add("gg",{annotation:"backward documentboundary",feature_group:9,code:function(){document.scrollingElement.scrollTop=0,d=0,u.length&&ce("front",["showStatus",[void 0,void 0,d+1+" / "+u.length]]),"Firefox"!==he()?b():(n.hideCursor(),l.setPosition(document.body.firstChild,0),n.showCursor())}}),n.mappings.add("o",{annotation:"Go to Other end of highlighted text",feature_group:9,code:function(){n.hideCursor();var e=[l.anchorNode,l.anchorOffset];l.collapse(l.focusNode,l.focusOffset),l.extend(e[0],e[1]),n.showCursor()}});var r={w:"word",l:"lineboundary",s:"sentence",p:"paragraphboundary"};function a(e){if("Firefox"!==he()||"p"!==e&&"s"!==e){var t=r[e];l.modify("extend","forward",t)}}var s=[{},{annotation:"Yank a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(t){var o=[l.focusNode,l.focusOffset];n.hideCursor(),a(t),e.write(l.toString()),l.collapseToStart(),l.setPosition(o[0],o[1]),n.showCursor()}},{annotation:"Copy selected text",feature_group:9,code:function(){var t=[l.focusNode,l.focusOffset];e.write(l.toString()),"Caret"===ue.conf.modeAfterYank?(l.setPosition(t[0],t[1]),n.showCursor(),f=1,C()):"Normal"===ue.conf.modeAfterYank&&(f=2,n.toggle())}}];function c(e,t){ot(e,(()=>{xe(e,["click"],{shiftKey:t})}))}n.mappings.add("*",{annotation:"Search word under the cursor",feature_group:9,code:function(){n.star()}}),n.mappings.add(se.encodeKeystroke("<Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){c(l.focusNode.parentNode,!1)}}),n.mappings.add(se.encodeKeystroke("<Shift-Enter>"),{annotation:"Click on node under cursor.",feature_group:9,code:function(){c(l.focusNode.parentNode,!0)}}),n.mappings.add("zt",{annotation:"make cursor at top of window.",feature_group:9,code:function(){var e=h.getBoundingClientRect().top;n.hideCursor(),document.scrollingElement.scrollTop+=e,n.showCursor()}}),n.mappings.add("zz",{annotation:"make cursor at center of window.",feature_group:9,code:function(){var e=h.getBoundingClientRect().top-window.innerHeight/2;n.hideCursor(),document.scrollingElement.scrollTop+=e,n.showCursor()}}),n.mappings.add("zb",{annotation:"make cursor at bottom of window.",feature_group:9,code:function(){var e=window.innerHeight-h.getBoundingClientRect().bottom;n.hideCursor(),document.scrollingElement.scrollTop-=e,n.showCursor()}}),n.mappings.add("f",{annotation:"Forward to next char.",feature_group:9,code:function(){n.statusLine=n.name+" - "+p[f]+" - forward",mt.showStatus(),g=1}}),n.mappings.add("F",{annotation:"Backward to next char.",feature_group:9,code:function(){n.statusLine=n.name+" - "+p[f]+" - backward",mt.showStatus(),g=-1}}),n.mappings.add(";",{annotation:"Repeat latest f, F",feature_group:9,code:function(){y&&w(y[0],y[1])}}),n.mappings.add(",",{annotation:"Repeat latest f, F in opposite direction",feature_group:9,code:function(){y&&w(-y[0],y[1])}}),n.mappings.add("p",{annotation:"Expand selection to parent element",feature_group:9,code:function(){for(var e=l.focusNode;e!==document.body;){var t=Be(e=e.parentElement,/./),o=t[t.length-1],i=l.getRangeAt(0);if(-1===i.comparePoint(t[0],0)||1===i.comparePoint(o,o.length)){n.hideCursor(),f=2,C(),l.setBaseAndExtent(t[0],0,o,o.length),n.showCursor();break}}}}),n.mappings.add("V",{annotation:"Select a word(w) or line(l) or sentence(s) or paragraph(p)",feature_group:9,code:function(e){n.hideCursor(),f=2,C(),a(e),n.showCursor()}});var l=document.getSelection(),u=[],d=0,f=0,p=["","Caret","Range"],m=document.createElement("div"),h=document.createElement("div");h.className="surfingkeys_cursor",h.style.zIndex=2147483299;var g=0,y=null;function w(e,t){n.hideCursor();var o=[l.anchorNode,l.anchorOffset];if(l.focusNode&&l.focusNode.textContent&&l.focusNode.textContent.length&&l.focusNode.textContent[l.focusOffset]===t&&1===e&&l.setPosition(l.focusNode,l.focusOffset+1),_(t,!0,-1===e))if(1===f)l.setPosition(l.focusNode,l.focusOffset-1);else{var i=[l.focusNode,l.focusOffset-1];l.collapseToStart(),l.setPosition(o[0],o[1]),l.extend(i[0],i[1])}else l.setPosition(o[0],o[1]);n.showCursor()}function v(e){n.hideCursor(),l.anchorNode&&2===f?l.extend(e[0],e[1]):l.setPosition(e[0],e[1]),n.showCursor()}function b(){var e=n.map_node.meta.annotation.split(" "),t=2===f?"extend":"move";n.hideCursor();var o=[l.focusNode,l.focusOffset];l.modify(t,e[0],e[1]),o[0]===l.focusNode&&o[1]===l.focusOffset&&l.modify(t,e[0],"word"),n.showCursor()}n.hideCursor=function(){document.body.contains(h)&&(h.remove(),ce("front",["hideBubble"]))},n.showCursor=function(){if(l.focusNode&&(l.focusNode.offsetHeight>0||l.focusNode.parentNode.offsetHeight>0)){let e=ze(l);e&&(h.style.position="fixed",h.style.left=e.left+"px",h.style.top=e.top+"px",h.style.height=e.height+"px"),document.body.appendChild(h)}},n.getCursorPixelPos=function(){return h.getBoundingClientRect()};const k=document.createElement("div");function E(e,t,n,o,i){let r=We(t,n,o,i);if(r.length>100)return[];const a=Array.from(r).map((t=>{if(t.width>0&&t.height>0){var n=m.cloneNode(!1);return n.className=e,n.style.position="absolute",n.style.zIndex=2147483299,n.style.left=document.scrollingElement.scrollLeft+t.left+"px",n.style.top=document.scrollingElement.scrollTop+t.top+"px",n.style.width=t.width+"px",n.style.height=t.height+"px",k.appendChild(n),n}return null})).filter((e=>null!==e));return a.length&&!document.documentElement.contains(k)&&document.documentElement.prepend(k),a}function S(e,t,n,o){const i=E("surfingkeys_match_mark",e,t,n,o);i.length&&u.push([e,t,i])}function x(e){const t=new RegExp(e.source,"g"+e.flags);if(Be(document.body,e).forEach((function(e){for(var n;null!==(n=t.exec(e.data));){var o=n[0];if(!o.length)break;var i=t.lastIndex-o.length;S(e,i,e,i+o.length)}})),u.length){d=0;for(var n=0;n<u.length;n++){if(u[n][2][0].getBoundingClientRect().top>0){d=n;break}}ce("front",["showStatus",[void 0,void 0,d+1+" / "+u.length]])}}function C(){n.mappings.add("y",s[f]),n.statusLine=n.name+" - "+p[f],mt.showStatus()}function T(){f=(f+1)%3,C()}function _(e,t,n){for(var o=!1,i=null;window.find(e,t,n);){if(l.anchorNode.splitText){o=!0;break}if(null===i)i=l.anchorNode;else if(i===l.anchorNode)break}return o}n.visualClear=function(){i(),n.hideCursor(),u=[],Je(k,""),k.remove(),ce("front",["showStatus",[void 0,void 0,""]])},n.emptySelection=function(){document.getSelection().empty()},n.onEnter=function(){T()},n.onExit=function(){n.visualClear()},n.restore=function(){l&&l.anchorNode&&(l.setPosition(l.anchorNode,l.anchorOffset),n.showCursor(),n.enter())},n.toggle=function(e){switch(f){case 1:l.extend(l.anchorNode,l.anchorOffset),T();break;case 2:n.hideCursor(),l.collapse(l.focusNode,l.focusOffset),n.exit(),T();break;default:t.create(ue.conf.textAnchorPat,(function(t){setTimeout((function(){l.setPosition(t[0],t[1]),n.enter(),"z"===e&&(0===t[1]?l.extend(t[0],t[0].textContent.length):l.extend(t[0],t[1]+t[2].length),T()),n.showCursor()}),0)}))}},n.star=function(){if(l.focusNode&&l.focusNode.nodeValue){var e=je();if(e.length&&"."!==e){n.hideCursor();var t=[l.focusNode,l.focusOffset];le("updateInputHistory",{find:e}),n.visualClear(),x(new RegExp(e,ue.getCaseSensitive(e)?"":"i")),l.setPosition(t[0],t[1]),n.showCursor()}}},n.next=function(e){u.length?(0===f&&n.enter(),d=(e?u.length+d-1:d+1)%u.length,v(u[d]),ce("front",["showStatus",[void 0,void 0,d+1+" / "+u.length]])):ue.conf.lastQuery&&(x(new RegExp(ue.conf.lastQuery,ue.getCaseSensitive(ue.conf.lastQuery)?"":"i")),n.visualEnter(ue.conf.lastQuery))},n.feedkeys=function(e){setTimeout((function(){for(var t=new Event("keydown"),o=0;o<e.length;o++)t.sk_keyName=e[o],mt.handleMapKey.call(n,t)}),1)},n.visualUpdate=function(e){n.visualClear(),l.setPosition(function(e){for(var t=null,n=Be(document.body,/./,0);n.nextNode();)if(n.currentNode.parentNode.getBoundingClientRect().top>window.innerHeight*e){t=n.currentNode;break}return t}(0),0);var t=document.scrollingElement.scrollTop,o=[l.anchorNode,l.anchorOffset],i=ue.getCaseSensitive(e);if(_(e,i,!1)?l.setPosition(o[0],o[1]):l.setPosition(document.body.firstChild,0),_(e,i,!1)){for(document.scrollingElement.scrollTop!==t&&(t=document.scrollingElement.scrollTop,o=[l.anchorNode,l.anchorOffset]),S(l.anchorNode,l.anchorOffset,l.focusNode,l.focusOffset);document.scrollingElement.scrollTop===t&&_(e,i,!1);)S(l.anchorNode,l.anchorOffset,l.focusNode,l.focusOffset);document.scrollingElement.scrollTop=t,l.setPosition(o[0],o[1])}},n.visualEnter=function(e){0!==e.length&&"."!==e&&(n.visualClear(),x(new RegExp(e,ue.getCaseSensitive(e)?"":"i")),u.length?(n.enter(),v(u[d])):ce("front",["showStatus",[void 0,void 0,"Pattern not found: {0}".format(e)],1e3]))},n.findSentenceOf=function(e){var t=new RegExp("\\b"+e+"\\b"),n=Re((function(e,n){t.test(e.innerText)&&n.push(e)}));n=Me(n);var o="";return Ie((function(t){t.setPosition(n[0],0),window.find(e,!1,!1,!0,!0)&&(a("s"),o=t.toString())})),o};var A={};return n.style=function(e,t){A[e]=t,h.setAttribute("style",A.cursor||""),m.setAttribute("style",A.marks||"")},n};function Et(e){let t=document.querySelector("dialog");t&&Ne(t)||(t=document.documentElement),t.appendChild(e)}function St(e){const t=new mt("RegionalHints");t.mappings=new gt,t.map_node=t.mappings;const n=document.createElement("div");n.className="surfingkeys_hints_host",n.attachShadow({mode:"open"});const o=Ze("style",'\ndiv.menu {\n    font-size: 14px;\n    color: #fff;\n}\ndiv.menu-item {\n    display: inline-block;\n    padding: 4px;\n    margin: 4px;\n    background: #454545;\n    box-shadow: inset 0 -1px 0 #bbb;\n    border-radius: 3px;\n    font-size: 14px;\n}\nkbd {\n    white-space: nowrap;\n    display: inline-block;\n    padding: 3px 5px;\n    font: 14px Consolas, "Liberation Mono", Menlo, Courier, monospace;\n    line-height: 10px;\n    vertical-align: middle;\n    border: solid 1px #ccc;\n    border-bottom-color: #bbb;\n    border-radius: 3px;\n    box-shadow: inset 0 -1px 0 #bbb;\n    margin-right: 4px;\n}\n');n.shadowRoot.appendChild(o),t.mappings.add(se.encodeKeystroke("<Esc>"),{annotation:"Exit regional hints mode",feature_group:17,code:function(){t.exit()}}),t.mappings.add("ct",{annotation:"copy text from target element",feature_group:17,code:function(){e.write(r.link.innerText)}}),t.mappings.add("ch",{annotation:"copy html from target element",feature_group:17,code:function(){e.write(r.link.innerHTML)}}),t.mappings.add("d",{annotation:"delete target element",feature_group:17,code:function(){r.link.remove(),t.exit()}}),t.mappings.add("l",{annotation:"learn more about target element",feature_group:17,code:function(){const e=r.link.innerText;ce("front",["openOmnibar",{type:"LLMChat",extra:{system:e}}]),t.exit()}});const i=Ze("div","",{class:"menu"});Qe(t.mappings).forEach((e=>{const t=Ze("div","",{class:"menu-item"});t.appendChild(Ze("kbd",tt(se.decodeKeystroke(e.word)))),t.appendChild(Ze("span",e.annotation)),i.appendChild(t)})),t.addEventListener("keydown",(function(e){mt.handleMapKey.call(t,e)}));let r=null;return t.onExit=function(){r.remove(),n.remove()},t.attach=e=>{r&&r.remove(),r=e,n.shadowRoot.appendChild(r),Et(n),r.appendChild(i),t.enter()},t.onScrollStarted=()=>{document.documentElement.contains(n)&&(r.style.display="none")},t.onScrollDone=()=>{const e=r.link.getBoundingClientRect();r.style.top=e.top+"px",r.style.left=e.left+"px",r.style.display=""},t}const xt=function(e,t,n){const o=new mt("Hints"),i=document.createElement("div");i.className="surfingkeys_hints_host",i.attachShadow({mode:"open"});const r=Ze("style","\ndiv {\n    position: absolute;\n    display: block;\n    font-size: 8pt;\n    font-weight: bold;\n    padding: 0px 2px 0px 2px;\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#FFF785), color-stop(100%,#FFC542));\n    color: #000;\n    border: solid 1px #C38A22;\n    border-radius: 3px;\n    box-shadow: 0px 3px 7px 0px rgba(0, 0, 0, 0.3);\n    width: auto;\n}\ndiv:empty {\n    display: none;\n}\n[mode=text] div {\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#aaa), color-stop(100%,#fff));\n}\ndiv.hint-scrollable {\n    background: rgba(170, 170, 255, 0.85);\n}\n[mode=text] div.begin {\n    color: #00f;\n}\n[mode=input] mask {\n    background: rgba(255, 217, 0, 0.25);\n}\n[mode=input] mask.activeInput {\n    background: rgba(0, 0, 255, 0.25);\n}");r.onload=()=>{const e=Math.floor(document.documentElement.scrollTop+document.documentElement.clientHeight)-1,t=Math.floor(document.documentElement.scrollLeft+document.documentElement.clientWidth)-1;i.style.height=`${e}px`,i.style.width=`${t}px`},i.shadowRoot.appendChild(r);const a=St(n);let s=!1;o.setNumeric=function(){s=!0};let c="asdfgqwertzxcvb",l=[];o.setCharacters=function(e){c=e;for(const n of e)t.isScrollKeyInHints(n)&&l.push(n)},o.getCharacters=()=>c,o.addEventListener("keydown",(function(n){n.sk_stopPropagation=!0;let o=h.querySelector("[mode=input]>mask.activeInput");if(null!==o){const t=h.querySelectorAll("mask");var i=o.link;return void(mt.isSpecialKeyOf("<Esc>",n.sk_keyName)?(i.blur(),S()):n.keyCode===se.keyCodes.tab?(o.classList.remove("activeInput"),y.activeInput=(y.activeInput+(n.shiftKey?-1:1))%t.length,o=t[y.activeInput],o.classList.add("activeInput"),(i=o.link).focus()):n.keyCode!==se.keyCodes.shiftKey&&(n.sk_stopPropagation=!1,S(),e.enter(i)))}const r=h.querySelectorAll("div");if(mt.isSpecialKeyOf("<Esc>",n.sk_keyName))S();else if(n.keyCode===se.keyCodes.space)h.style.display="none";else if(n.keyCode===se.keyCodes.shiftKey)!function(){var e=h.querySelectorAll("div");e[0].style.zIndex==e[0].zIndex?e.forEach((function(t,n){var o=parseInt(t.style.zIndex);t.style.zIndex=e.length-n+2147483e3-o})):e.forEach((function(e,t){e.style.zIndex=e.zIndex}))}();else if(r.length>0)if(n.keyCode===se.keyCodes.backspace)d.length>0?(d=d.substr(0,d.length-1),k(n)):f.length>0&&(f=f.substr(0,f.length-1),E());else{var a=n.sk_keyName;(function(e){return e===e.toUpperCase()&&e!==e.toLowerCase()})(a)&&(g=!0),""!==a&&(s?(a>="0"&&a<="9"?d+=a:(f+=a,E()),k(n)):-1!==c.toLowerCase().indexOf(a.toLowerCase())?(d+=a.toUpperCase(),k(n)):t.isScrollKeyInHints(a)&&-1===l.indexOf(a)?n.sk_stopPropagation=!1:S())}})),o.addEventListener("keyup",(function(e){e.keyCode===se.keyCodes.space&&(h.style.display="")})),o.dispatchMouseClick=function(n){if(_e(n))o.exit(),t.passFocus(!0),n.focus(),e.enter(n);else{m.multipleHits||o.exit();let e=m.tabbed,i=m.active;if(m.multipleHits){const t=n.getAttribute("href");null!==t&&"#"!==t&&(e=!0,i=!1)}const r={shiftKey:g||i};if(g&&ue.conf.hintShiftNonActive&&(e=!0,r.shiftKey=!1),e){const e=-1!==navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey";r[e]=!0}ot(n,(()=>{e&&he().startsWith("Safari")?le("openLink",{tab:{tabbed:e,active:r.shiftKey},url:C(n)}):(o.mouseoutLastElement(),xe(n,m.mouseEvents,r),ce("observer",["turnOn"]),p=n,document.activeElement.matches(ue.conf.disabledOnActiveElementPattern)&&setTimeout((()=>{t.disable(!0)}),100)),m.multipleHits&&setTimeout(x,300)}))}n.classList.remove("surfingkeys--hints--clicking")};const u=["mouseover","pointerdown","mousedown","pointerup","mouseup","click","focus","focusin"];var d="",f="",p=null,m={mouseEvents:u},h=Ze("section","",{style:"display: block; opacity: 1;"}),g=!1,y={},w=o.dispatchMouseClick,v="";function b(e){var t=0;do{var n=parseInt(getComputedStyle(e).getPropertyValue("z-index"));t+=isNaN(n)||n<0?0:n,e=e.parentNode}while(e&&e!==document.body&&e!==document&&e.nodeType!==e.DOCUMENT_FRAGMENT_NODE);return t}function k(e){const n=h.querySelectorAll("div:not(:empty)"),o=it(n,d),i=o.matched;if(i){if(t.appendKeysForRepeat("Hints",d),"function"==typeof w)m.regionalHints?setTimeout((()=>{const e=O(i,i.skColorIndex,"99");e.link=i,a.attach(e)}),10):w(i);else if("Array"===i.constructor.name){const e=i[0];i[0]="__EVENT_TARGET__",ce("user",["onHintClicked",i],e)}else ce("user",["onHintClicked"],i);m.multipleHits?it(n,d=""):S()}else 0===o.candidates&&S();e&&(mt.suppressKeyUp(e.keyCode),e.stopImmediatePropagation(),e.preventDefault())}function E(){var e=h.querySelectorAll("div");e=Array.from(e),f.length>0&&(e=e.filter((function(e){e.label="",Je(e,"");var t=e.link,n=t.innerText;return void 0===n&&(n=t[0]?t[0].textContent:""),-1!==n.indexOf(f)})));var t=o.genLabels(e.length);e.forEach((function(e,n){e.label=t[n],Je(e,t[n])}))}function S(){m={mouseEvents:u},Je(h,""),h.remove(),i.remove(),d="",f="",g=!1,o.exit()}function x(){if(mt.getCurrent()===o&&document.documentElement.contains(i)){var e=(new Date).getTime(),t=L(v,y);t>0&&(o.statusLine+=" - "+((new Date).getTime()-e)+"ms / "+t,mt.showStatus())}}function C(e){for(var t=e.href;!t&&e;)t=(e=e.parentElement).href;return t}function T(e){for(var t=0;t<ue.conf.pageUrlRegex.length;t++){var n=window.location.href.match(ue.conf.pageUrlRegex[t]);if(n&&4===n.length){var o=parseInt(n[2]);if(o<4294967295)return window.location.href=n[1]+(o+e)+n[3],!0}}return!1}function _(e){let t={};return e.forEach((function(e){let n=e.getAttribute("href");t[n]||(t[n]=e)})),Object.values(t)}function A(e){Je(h,""),h.setAttribute("mode",e),h.style.display=""}function O(e,t,n){e.skColorIndex=t;const o=e.getBoundingClientRect(),i=b(e),r=document.createElement("mask");return r.style.position="fixed",r.style.top=o.top+"px",r.style.left=o.left+"px",r.style.width=o.width-4+"px",r.style.height=o.height-4+"px",r.style.zIndex=i+9999,r.style.background=fe(t)+n,r.style.border=`2px solid ${fe(t)}`,r}function N(e){A("click");const t=o.genLabels(e.length),n=o.coordinate(),r=Ze("style",I);h.prepend(r),m.regionalHints&&e.forEach((function(e,t){h.append(O(e,t,"33"))}));let a=-1,s=-1;var c=e.map((function(e,o){var i,r=Pe(e),c=b(e),l=Math.min(r.width,window.innerWidth);(i="right"===ue.conf.hintAlign?window.pageXOffset+r.left-n.left+l:"left"===ue.conf.hintAlign?window.pageXOffset+r.left-n.left:window.pageXOffset+r.left-n.left+l/2)<window.pageXOffset?i=window.pageXOffset:i+32>window.pageXOffset+window.innerWidth&&(i=window.pageXOffset+window.innerWidth-32);var u=Ze("div",t[o]);e.dataset.hint_scrollable&&u.classList.add("hint-scrollable");let d=Math.max(r.top+window.pageYOffset-n.top,0);return d===a&&Math.abs(i-s)<20?i+=20-Math.abs(i-s):i===s&&Math.abs(d-a)<20&&(d+=20-Math.abs(d-a)),u.style.top=d+"px",u.style.left=i+"px",u.style.zIndex=c+9999,m.regionalHints&&(u.style.background=fe(o)),u.zIndex=u.style.zIndex,u.label=t[o],u.link=e,a=d,s=i,u}));c.forEach((function(e){h.appendChild(e)}));for(var l=h.querySelectorAll("div"),u=Pe(l[0]),d=1;d<l.length;d++){var f=l[d],p=Pe(f);p.top===u.top&&Math.abs(p.left-u.left)<u.width&&(f.style.top=f.offsetTop+f.offsetHeight+"px"),u=Pe(f)}i.shadowRoot.appendChild(h)}function L(e,t){return Et(i),"RegExp"===e.constructor.name?function(e,t){for(var n in t)m[n]=t[n];o.statusLine=t&&t.statusLine||"Hints to select text";var r,a=Re((function(e,t){for(var n=e.childNodes,o=0,i=n.length;o<i;o++)if(n[o].nodeType==Node.TEXT_NODE&&n[o].data.length>0){t.push(e);break}}));if(a=a.flatMap((function(e){for(var t=e.childNodes,n=[],o=0,i=t.length;o<i;o++)t[o].nodeType==Node.TEXT_NODE&&t[o].data.trim().length>1&&n.push(t[o]);return n})),-1===e.flags.indexOf("g"))r=a.map((function(e){return[e,0,""]}));else{r=[];for(var s=0,c=a.length;s<c;s++)for(var l,u=a[s];null!=(l=e.exec(u.data));)r.push([u,l.index,l[0]])}if(a=r.map((function(e){var t=He(e[0],e[1]),n=[0,0,window.innerHeight,window.innerWidth];if(ue.conf.caretViewport&&4===ue.conf.caretViewport.length&&(n=ue.conf.caretViewport),0===e[0].data.trim().length||t.top<n[0]||t.left<n[1]||t.top>n[2]||t.left>n[3])return null;var o=b(e[0].parentNode),i=document.createElement("div");return 0===e[1]&&(i.className="begin"),i.style.position="fixed",i.style.top=t.top+"px",i.style.left=t.left+"px",i.style.zIndex=o+9999,i.zIndex=i.style.zIndex,i.link=e,i})).filter((function(e){return null!==e})),document.getSelection().anchorNode&&document.getSelection().collapseToStart(),a.length>0){A("text");var d=o.genLabels(a.length);a.forEach((function(e,t){e.label=d[t],Je(e,d[t]),h.append(e)}));var f=Ze("style",R);h.prepend(f),i.shadowRoot.appendChild(h)}return a.length}(e,t):Array.isArray(e)?function(e,t){for(var n in t=t||{})m[n]=t[n];return o.statusLine=t&&t.statusLine||"Hints to click",(e=Xe(e)).length>0&&N(e),e.length}(e,t):function(e,t){for(var n in o.statusLine="Hints to click",t=t||{})m[n]=t[n];let i;return""===e?(i=Re((function(e,t){be(e)&&t.push(e)})),i=Ue(i)):Array.isArray(e)?i=Xe(e):(i=Re((function(t,n){!t.matches(e)||t.disabled||t.readOnly||n.push(t)})),i=Xe(i),i=Ue(i)),i.length>0&&N(i),i.length}(e,t)}o.click=function(e,t){"string"==typeof e&&(e=De(e)),e.length>1?t?e.forEach((function(e){o.dispatchMouseClick(e)})):o.create(e,o.dispatchMouseClick):1===e.length&&o.dispatchMouseClick(e[0])},o.previousPage=function(){var e=_(De("[rel=prev]",ue.conf.prevLinkRegex));return e.length?(o.click(e),!0):T(-1)},o.nextPage=function(){var e=_(De("[rel=next]",ue.conf.nextLinkRegex));return e.length?(o.click(e),!0):T(1)},o.onScrollStarted=()=>{document.documentElement.contains(i)&&(Je(h,""),h.remove(),d="")},o.onScrollDone=x,Se("hints",{scrollStarted:()=>{const e=mt.getCurrent();e.onScrollStarted&&e.onScrollStarted()},scrollDone:()=>{const e=mt.getCurrent();e.onScrollDone&&e.onScrollDone()},topBoundaryHit:o.previousPage,bottomBoundaryHit:o.nextPage,dispatchMouseClick:o.dispatchMouseClick},!0),o.genLabels=function(e){let t=c.toUpperCase();for(var n=[""],o=0;n.length-o<e||0==o;)for(var i=n[o++],r=0;r<t.length;r++)n.push(i+t[r]);return n=n.slice(o,o+e)},o.coordinate=function(){var e=Ze("div","A",{style:"top: 0; left: 0;"});h.prepend(e),i.shadowRoot.appendChild(h);var t=e.getBoundingClientRect(),n={top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft};return Je(h,""),h.remove(),n},o.createInputLayer=function(){Et(i);const n="input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor";var r=Re((function(e,t){!e.matches(n)||e.disabled||e.readOnly||"text"!==e.type&&"email"!==e.type&&"search"!==e.type&&"password"!==e.type||t.push(e)}));if(0===r.length&&null!==document.querySelector(n)&&(document.querySelector(n).scrollIntoView(),r=Re((function(e,t){!e.matches(n)||e.disabled||e.readOnly||t.push(e)}))),r.length>1){o.enter(),A("input"),r.forEach((function(e,t){var n=e.getBoundingClientRect(),o=b(e),i=document.createElement("mask");i.style.position="fixed",i.style.top=n.top+"px",i.style.left=n.left+"px",i.style.width=n.width+"px",i.style.height=n.height+"px",i.style.zIndex=o+9999,i.link=e,h.append(i)})),i.shadowRoot.appendChild(h),y.activeInput=0;const e=h.querySelector("[mode=input]>mask");e.classList.add("activeInput"),t.passFocus(!0),e.link.focus()}else 1===r.length&&(t.passFocus(!0),r[0].focus(),e.enter(r[0]))},o.getSelector=function(){return v},o.create=function(e,t,n){s&&(c="1234567890"),v=e,w=t,y=n||{};var i=(new Date).getTime(),r=L(e,n);return r>(ue.conf.hintExplicit?0:1)?(o.statusLine+=" - "+((new Date).getTime()-i)+"ms / "+r,o.enter()):k(),r>0},o.mouseoutLastElement=function(){p&&(xe(p,["mouseout"],{}),p=null)};var R="",I="";return o.style=function(e,t){/^div\b/.test(e)||(e=`div{${e}}`),"text"===t?R=e.replace(/\bdiv\b/g,"[mode='text'] div"):I=e.replace(/\bdiv\b/g,"div")},o.feedkeys=function(e){setTimeout((function(){d=e.toUpperCase(),k()}),1)},o};const Ct=function(){var e={},t=document.createElement("textarea");function n(e){Ie((function(n){document.documentElement.appendChild(t),e(n),t.remove()}))}return t.contentEditable=!0,t.enableAutoFocus=!0,t.id="sk_clipboard",e.read=function(e){if(he().startsWith("Safari"))le("readClipboard",null,(function(t){e(t)}));else if("Firefox"!==he()||"object"!=typeof navigator.clipboard||"function"!=typeof navigator.clipboard.readText){n((function(){t.value="",Je(t,""),t.focus(),document.execCommand("paste")}));var o=t.value;""===o&&(o=t.innerHTML.replace(/<br>/gi,"\n")),e({data:o})}else navigator.clipboard.readText().then((t=>{setTimeout((function(){e({data:t})}),0)}))},e.write=function(e){const o=()=>{ke("Copied: "+e)};"Chrome"===he()?(n((function(){t.value=e,t.select(),document.execCommand("copy"),t.value=""})),o()):(le("writeClipboard",{text:e}),o())},e};const Tt=function(e,t){var n=document.createElement("div");n.style.display="block",n.style.opacity=1,n.style.colorScheme="light";var o=chrome.runtime.getURL("pages/frontend.html"),i=document.createElement("iframe");function r(e){var t=e.data&&e.data.surfingkeys_uihost_data;void 0!==t&&(t.toFrontend?(i.contentWindow.postMessage({surfingkeys_frontend_data:t},o),t.toFrontend&&e.source&&-1!==["showStatus","showEditor","openOmnibar","openFinder","chooseTab"].indexOf(t.action)&&(l&&l.window===e.source||(l&&l.window.postMessage({surfingkeys_content_data:{action:"deactivated",reason:`${t.action}@${e.timeStamp}`}},l.origin),(l={window:e.source,origin:t.origin}).window.postMessage({surfingkeys_content_data:{action:"activated",reason:`${t.action}@${e.timeStamp}`}},l.origin)))):t.action&&c.hasOwnProperty(t.action)?c[t.action](t):t.toContent&&l&&l.window.postMessage({surfingkeys_content_data:t},l.origin),e.stopImmediatePropagation())}i.setAttribute("allowtransparency",!0),i.setAttribute("frameborder",0),i.setAttribute("scrolling","no"),i.setAttribute("class","sk_ui"),i.setAttribute("src",o),i.setAttribute("title","Surfingkeys"),i.style.position="fixed",i.style.left=0,i.style.bottom=0,i.style.width="100%",i.style.height=0,i.style.zIndex=2147483647,n.attachShadow({mode:"open"}),n.shadowRoot.appendChild(i),i.addEventListener("load",(function(){this.contentWindow.postMessage({surfingkeys_frontend_data:{action:"initFrontend",ack:!0,winSize:[window.innerWidth,window.innerHeight],origin:ye()}},o),window.addEventListener("message",r,!0)}),{once:!0});var a,s="none",c={},l=null;c.initFrontendAck=function(e){t(n)},c.setFrontFrame=function(t){i.style.height=t.frameHeight,t.pointerEvents&&(i.style.pointerEvents=t.pointerEvents),"none"===t.pointerEvents?(n.blur(),i.blur(),s!==t.pointerEvents&&l&&(e.getBackFocusFromFrontend?e.getBackFocusFromFrontend():l.window.postMessage({surfingkeys_content_data:{action:"getBackFocus"}},l.origin)),document.body&&(document.body.style.animationFillMode="",document.body.style.overflowY=a)):(e.focusFrontend&&e.focusFrontend(i),document.body&&(document.body.style.animationFillMode="none",void 0===a&&(a=document.body.style.overflowY),document.body.style.overflowY="visible")),s=t.pointerEvents},n.detach=function(){window.removeEventListener("message",r,!0),n.remove()},document.documentElement.appendChild(n)};const _t=function(e,t,n,o,i){var r,a={},s=[];function c(){r=new Promise((function(e,t){Tt(i,(t=>{e(t),function(){for(var e of s)a.command(e)}()}))}))}var l={};function u(e){s.push(e),r&&r.then((function(){a.command(e)}))}a.command=function(e,t){if(e.toFrontend=!0,e.origin=ye(),e.id=we(),t&&(e.ack=!0,l[e.id]=t),window!==top)ue.postTopMessage(e);else{if(!r){if("hideKeystroke"===e.action||null===document.body)return;c()}r.then((function(){ue.postTopMessage(e)}))}};var d={};a.addSearchAlias=function(e,t,n,o,i,r){o&&i&&(d[o]=i),u({action:"addSearchAlias",alias:e,prompt:t,url:n,suggestionURL:o,options:r})},a.removeSearchAlias=function(e){u({action:"removeSearchAlias",alias:e})};var f={},p={};function m(){var e=document.getSelection(),t=e.toString().trim();t&&!/[\W_]/.test(t)&&t.length&&"Range"===e.type&&a.performInlineQueryOnSelection(t)}a.performInlineQueryOnSelection=function(e){var t=document.getSelection().getRangeAt(0).getClientRects()[0];a.performInlineQuery(e,t,(function(e,t){t&&ce("front",["showBubble",{top:e.top,left:e.left,height:e.height,width:e.width},t,!1])}))},f.updateInlineQuery=function(e){e.word?a.performInlineQueryOnSelection(e.word):m()},f.getSearchSuggestions=function(e){var t=null;if(d.hasOwnProperty(e.url)){const n=d[e.url];t="function"==typeof n?n(e.response,{url:e.requestUrl,query:e.query}):new Promise(((t,n)=>{const o=we();p[o]=e=>{t(e)},ce("user",["getSearchSuggestions",e.url,e.response,{url:e.requestUrl,query:e.query},o])}))}return t},a.executeCommand=function(e){a.command({action:"executeCommand",cmdline:e})};var h,g,y=Ze("div","Hi, I'm here now!",{id:"sk_frame"});function w(e){document.documentElement.append(y);var t=e.rect;y.style.top=t.top+"px",y.style.left=t.left+"px",y.style.width=t.width+"px",y.style.height=t.height+"px",y.style.display="",setTimeout((function(){y.remove()}),e.duration)}function v(){let n=[t.mappings,o.mappings,e.mappings];const i=t.getLurkMode();return i&&n.unshift(i.mappings),n.map(Qe).reduce((function(e,t){return e.concat(t)}))}function b(){a.command({action:"hidePopup"})}function k(e){if("DIV"===g.nodeName)if("CodeMirror-code"===g.className){window.getSelection().selectAllChildren(g);let t=new DataTransfer;t.items.add(e,"text/plain"),g.dispatchEvent(new ClipboardEvent("paste",{clipboardData:t}))}else e=e.replace(/\n+$/,""),"function"==typeof g.setEditorText?g.setEditorText(e):g.innerText=e;else if("function"==typeof g.setValueWithEventDispatched)g.setValueWithEventDispatched(e);else{g.value=e;var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),g.dispatchEvent(t)}}y.fromSurfingKeys=!0,a.showUsage=function(){a.command({action:"showUsage",metas:v()})},a.getUsage=function(e){a.command({action:"getUsage",metas:v()},(function(t){e(t.data)}))},a.showEditor=function(e,t,n,o){n=n||e.localName;var i,r=0;if("string"==typeof e)i=e,g=document.body;else if("select"===n){var s=e.value;i=Array.from(e.querySelectorAll("option")).map((function(e,t){return e.value===s&&(r=t),e.innerText.trim()+" >< "+e.value})).join("\n"),g=e}else if("DIV"===(g=e).nodeName)if("CodeMirror-code"===g.className){let e=g.querySelectorAll(".CodeMirror-line");i=(i=Array.from(e).map((e=>e.innerText)).join("\n")).replace(/\u200B/g,"")}else i=g.innerText;else i=g.value;h=t||k;const c={action:"showEditor",type:n||"textarea",initial_line:r,content:i};(o||ue.conf.useNeovim)&&(c.file_name=`${new URL(window.location.origin).host}/${g.nodeName.toLowerCase()}`),a.command(c)},a.chooseTab=function(){""!==t.repeats?le("focusTabByIndex"):a.command({action:"chooseTab"})},a.groupTab=function(){a.command({action:"groupTab"})},a.openOmnibar=function(e){e.action="openOmnibar",a.command(e)};var E,S=!1;a.performInlineQuery=function(e,t,n){if(void 0!==document.dictEnabled)window.location.href.startsWith("chrome://dictorium-query/")?window===top?window.location.href=`chrome://dictorium-query/${e}`:window.postMessage({dictorium_data:{type:"DictoriumReload",word:e}}):window.postMessage({dictorium_data:{type:"OpenDictoriumQuery",word:e,sentence:"",pos:t,source:window.location.href}}),b();else if(S){ue.conf.autoSpeakOnInlineQuery&&i.readText(e),le("updateInputHistory",{OmniQuery:e=e.toLocaleLowerCase()});const o=we();p[o]=e=>{n(t,e)},ce("user",["performInlineQuery",e,o])}else ge()?(E=function(e){n(t,e)},document.getElementById("proxyFrame").contentWindow.postMessage({surfingkeys_content_data:{action:"performInlineQuery",pos:t,query:e}},"*")):(Ye("https://github.com/brookhong/Surfingkeys/wiki/Register-inline-query"),b())},a.registerInlineQuery=function(){S=!0},a.openOmniquery=function(e){a.openOmnibar({type:"OmniQuery",extra:e.query,style:e.style})};var x,C={accumulated:"",candidates:{},key:""};function T(){x&&(clearTimeout(x),x=void 0)}a.showStatus=function(e,t){const n="Firefox"===he()?1e3:0;setTimeout((()=>{a.command({action:"showStatus",contents:e,duration:t})}),n)},a.toggleStatus=function(e){a.command({action:"toggleStatus",visible:e})},p=Se("front",{showPopup:e=>{a.command({action:"showPopup",content:e})},applySettingsFromSnippets:t=>{u({action:"applyUserSettings",userSettings:t});const n=JSON.parse(JSON.stringify(t));for(var o in n)ue.conf.hasOwnProperty(o)&&(ue.conf[o]=n[o],delete n[o]);ue.conf.enableEmojiInsertion&&e.enableEmojiInsertion(),Object.keys(n).length>0&&window===top&&le("updateSettings",{scope:"snippets",settings:n}),ce("settingsFromSnippetsLoaded")},querySelectedWord:m,addMapkey:(e,t,n)=>{u({action:"addMapkey",mode:e,new_keystroke:t,old_keystroke:n})},addVimMap:(e,t,n)=>{u({action:"addVimMap",lhs:e,rhs:t,ctx:n})},addVimKeyMap:e=>{u({action:"addVimKeyMap",vimKeyMap:e})},highlightElement:w,hidePopup:b,openFinder:()=>{a.command({action:"openFinder"})},showBanner:(e,t)=>{a.command({action:"showBanner",content:e,linger_time:t})},showBubble:(e,t,n)=>{t.length>0&&(e.winWidth=window.innerWidth,e.winHeight=window.innerHeight,e.winX=0,e.winY=0,window.frameElement&&(e.winX=window.frameElement.offsetLeft,e.winY=window.frameElement.offsetTop),a.command({action:"showBubble",content:t,position:e,noPointerEvents:n}))},hideBubble:()=>{a.command({action:"hideBubble"})},hideKeystroke:()=>{C.accumulated="",C.candidates={},a.command({action:"hideKeystroke"})},showKeystroke:(e,t)=>{C.accumulated+=e,C.key=e,C.candidates={};var n=t.mappings.find(C.accumulated);n&&n.getMetas((function(e){return!0})).forEach((function(e){C.candidates[e.word]={annotation:e.annotation}})),a.command({action:"showKeystroke",keyHints:C})},openOmnibar:a.openOmnibar,showStatus:a.showStatus,toggleStatus:a.toggleStatus}),f.ace_editor_saved=function(n){void 0!==n.data&&h(n.data),ue.conf.focusOnSaved&&_e(g)&&(t.passFocus(!0),g.focus(),e.enter(g))},f.nextEdit=function(e){var t,o=n.getSelector()||"input, textarea, *[contenteditable=true], select";if(t=o,(o=ve(document.body,NodeFilter.SHOW_ELEMENT,(function(e){return e.offsetHeight&&e.offsetWidth&&e.matches(t)}))).length){var i=o.indexOf(g);i=(i+(e.backward?-1:1))%o.length,Oe(o=o[i]),ot(o,(()=>{a.showEditor(o)}))}},f.omnibar_query_entered=function(e){le("updateInputHistory",{OmniQuery:e.query}),a.performInlineQuery(e.query,{top:0,left:80,height:0,width:100},(function(t,n){if("Array"!==n.constructor.name&&(n=[n]),"Chrome"===he()){var i=o.findSentenceOf(e.query);i.length>0&&n.push(i)}a.command({action:"updateOmnibarResult",words:n})}))},f.getBackFocus=function(e){window.focus(),window===top&&r&&r.then((e=>{e.shadowRoot.contains(document.activeElement)&&document.activeElement.blur()}))},f.getPageText=function(e){return document.body.innerText},f.visualUpdate=function(e){T(),x=setTimeout((function(){o.visualUpdate(e.query),a.command({action:"visualUpdated"})}),500)},f.visualClear=function(e){T(),o.visualClear()},f.visualEnter=function(e){T(),o.visualEnter(e.query)},f.emptySelection=function(e){o.emptySelection()};var _,A=window===top;return f.deactivated=function(e){A=!1},f.activated=function(e){A=!0},ue.on("focusFrame",(function(e,t,n){e.frameId===window.frameId&&(window.focus(),document.body.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),w({duration:500,rect:{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}))})),window.addEventListener("message",(function(e){var t=e.data&&(e.data.surfingkeys_content_data||e.data.dictorium_data);if(void 0!==t){if("performInlineQuery"===t.action)a.performInlineQuery(t.query,t.pos,(function(t,n){e.source.postMessage({surfingkeys_content_data:{action:"performInlineQueryResult",pos:t,result:n}},e.origin)}));else if("performInlineQueryResult"===t.action)E(t.pos,t.result);else if(A){if(l[t.id])(0,l[t.id])(t)||delete l[t.id];else if(t.action&&f.hasOwnProperty(t.action)){var n=f[t.action](t);t.ack&&n&&(n.then||(n=Promise.resolve(n)),n.then((e=>ue.postTopMessage({data:e,toFrontend:!0,origin:t.origin,id:t.id}))))}}else("activated"===t.action||"DictoriumViewReady"===t.type)&&f.activated(t);e.data.dictorium_data||e.stopImmediatePropagation()}}),!0),a.attach=function(){_&&(clearTimeout(_),_=void 0),r||c(),mt.showStatus()},a.detach=function(){r&&r.then((e=>{_=setTimeout((function(){e.detach(),r=void 0}),3e3)}))},a};function At(e,t){chrome.storage.local.get(["logLevels"],(n=>{const o=n&&n.logLevels||["error"];-1!==["log","warn","error"].indexOf(e)&&-1!==o.indexOf(e)&&console[e](t)}))}const Ot=function(e,t,n,o,i,r,a){function s(e,t,n){var o={code:e};return n&&(o.repeatIgnore=n),t&&(t=Ge(t),o.feature_group=t.feature_group,o.annotation=t.annotation),o}function c(e){return!e||e.test(document.location.href)||e.test(window.origin)}function l(e,t,n,o,r){if(c((r=r||{}).domain)){t=se.encodeKeystroke(t);var a=e.mappings.remove(t);if(a)At("warn",a.meta?`${a.meta.word} for [${a.meta.annotation}] is overridden by [${n}].`:a.getMetas((function(){return!0})).map((function(e){return`${e.word} for [${e.annotation}] is overridden by [${n}].`})));else if(t.length>1)for(var l=t.substr(0,t.length-1);l.length>0;){if((a=e.mappings.find(l))&&a.meta)return void At("warn",`${a.meta.word} for [${a.meta.annotation}] precedes ${t}.`);l=l.substr(0,l.length-1)}var u=s(o,{annotation:n,feature_group:e===i?9:14},r.repeatIgnore);e.mappings.add(t,u)}}function u(e,t,o,i){l(n,e,t,o,i)}function d(e,t,n,o){l(i,e,t,n,o)}function f(e,n,o,i){l(t,e,n,o,i)}function p(e,t,o,i){if(c(o))if(":"===t[0]&&t.length>1){var a=t.substr(1),l=s((function(){r.executeCommand(a)}),i?Ge({annotation:i}):null,!1);n.mappings.add(se.encodeKeystroke(e),l)}else!$e(n,e,t,i)&&t in mt.specialKeys?(mt.specialKeys[t].push(e),ce("front",["addMapkey","Mode",e,t])):At("warn",`${t} not found in normal mode.`)}function m(e,t){if(c(t))if(n.mappings.find(se.encodeKeystroke(e)))n.mappings.remove(se.encodeKeystroke(e));else for(var o in mt.specialKeys){var i=mt.specialKeys[o].indexOf(e);-1!==i&&mt.specialKeys[o].splice(i,1)}}function h(e,o){c(o)&&[n,t].forEach((function(t){for(var n=new gt,o=0,i=(e=e||[]).length;o<i;o++){var r=se.encodeKeystroke(e[o]),a=t.mappings.find(r);a&&n.add(r,a.meta)}delete t.mappings,t.mappings=n,t.map_node=n}))}function g(e,n,o,i){c(o)&&$e(t,e,n,i)}function y(e,n){c(n)&&t.mappings.remove(se.encodeKeystroke(e))}function w(e,t,n,o){c(n)&&$e(i,e,t,o)}function v(e,t){c(t)&&i.mappings.remove(se.encodeKeystroke(e))}function b(e,t,o,i){c(o)&&n.addLurkMap(e,t)}function k(e,t,n,o,i,a,s,c){if(!/^[\u0000-\u007f]*$/.test(e))throw`Invalid alias ${e}, which must be ASCII characters.`;!ge()&&r.addSearchAlias&&r.addSearchAlias(e,t,n,i,a,c);if(!(c?.skipMaps??!1)){u((o||"s")+e,["#6Search selected with {0}",t],f),u("o"+e,["#8Open Omnibar for {0} Search",t],(()=>{r.openOmnibar({type:"SearchEngine",extra:e})})),d((o||"s")+e,"",f),u((o||"s")+(s||"o")+e,"",p),d((o||"s")+(s||"o")+e,"",p);var l=e.toUpperCase();if(l!==e){function m(){S(n,!1,!0,e)}function h(){S(n,!0,!0,e)}u((o||"s")+l,"",m),d((o||"s")+l,"",m),u((o||"s")+(s||"o")+l,"",h),d((o||"s")+(s||"o")+l,"",h)}}function f(){S(n)}function p(){S(n,!0)}}function E(e,t,n){ge()||r.removeSearchAlias(e),m((t||"s")+e),m("o"+e),v((t||"s")+e),m((t||"s")+(n||"o")+e),v((t||"s")+(n||"o")+e);var o=e.toUpperCase();o!==e&&(m((t||"s")+o),v((t||"s")+o),m((t||"s")+(n||"o")+o),v((t||"s")+(n||"o")+o))}function S(t,n,o,i){let a=window.getSelection().toString();e.read((function(e){a=a||e.data,n&&(a="site:"+window.location.hostname+" "+a),o?r.openOmnibar({type:"SearchEngine",extra:i,pref:a}):Ye(function(e,t){return e.indexOf("{0}")>0?e.format(t):e.indexOf("%s")>0?e.replace("%s",t):e+t}(t,encodeURIComponent(a)))}))}return Se("api",{addSearchAlias:k,imap:g,map:p,lmap:b,vmap:w,unmap:m,unmapAllExcept:h,iunmap:y,vunmap:v,removeSearchAlias:E,searchSelectedWith:S,"clipboard:write":e.write,"clipboard:read":()=>{e.read((e=>{ce("user",["onClipboardRead",e])}))},"hints:click":o.click,"hints:create":o.create,"hints:setCharacters":o.setCharacters,"hints:setNumeric":o.setNumeric,"hints:style":o.style,"front:registerInlineQuery":r.registerInlineQuery,"front:showEditor":(e,t,n)=>{r.showEditor(e,(e=>{ce("user",["onEditorWrite",e])}),t,n)},"front:openOmnibar":r.openOmnibar,"normal:feedkeys":n.feedkeys,"normal:jumpVIMark":n.jumpVIMark,"normal:passThrough":n.passThrough,"normal:scroll":n.scroll,"visual:style":i.style,mapkey:(e,t,n)=>{n.codeHasParameter?u(e,t,(t=>{ce("user",["callUserFunction",`normal:${e}`,t])}),n):u(e,t,(()=>{ce("user",["callUserFunction",`normal:${e}`])}),n)},imapkey:(e,t,n)=>{f(e,t,(()=>{ce("user",["callUserFunction",`insert:${e}`])}),n)},vmapkey:(e,t,n)=>{d(e,t,(()=>{ce("user",["callUserFunction",`visual:${e}`])}),n)},readText:a.readText}),{RUNTIME:le,aceVimMap:pe,addVimMapKey:me,addSearchAlias:k,cmap:function(e,t,n,o){c(n)&&ce("front",["addMapkey","Omnibar",e,t])},imap:g,imapkey:f,isElementPartiallyInViewport:Le,getBrowserName:he,getClickableElements:De,lmap:b,map:p,unmap:m,unmapAllExcept:h,iunmap:y,vunmap:v,mapkey:u,readText:a.readText,removeSearchAlias:E,searchSelectedWith:S,tabOpenLink:Ye,vmap:w,vmapkey:d,Clipboard:e,Normal:{feedkeys:n.feedkeys,jumpVIMark:n.jumpVIMark,passThrough:n.passThrough,scroll:n.scroll},Hints:{click:o.click,create:o.create,dispatchMouseClick:o.dispatchMouseClick,style:o.style,setNumeric:o.setNumeric,setCharacters:o.setCharacters},Visual:{style:i.style},Front:{openOmnibar:r.openOmnibar,registerInlineQuery:r.registerInlineQuery,showEditor:r.showEditor,showBanner:ke,showPopup:Ee}}};function Nt(e,t,n,o,i,r,a,s){const{addSearchAlias:c,cmap:l,map:u,mapkey:d,imapkey:f,readText:p,vmapkey:m,searchSelectedWith:h}=e;function g(e){var t=Ce();t.blur(),n.exit(),a.showEditor(t,null,null,e)}d("[[","#1Click on the previous link on current page",i.previousPage),d("]]","#1Click on the next link on current page",i.nextPage),d("T","#3Choose a tab",(function(){a.chooseTab()})),d(";G","#3Group this tab",(function(){a.groupTab()})),d("?","#0Show usage",(function(){a.showUsage()})),d("Q","#8Open omnibar for word translation",(function(){a.openOmniquery({query:je(),style:"opacity: 0.8;"})})),f("<Ctrl-'>","#15Toggle quotes in an input element",Te),f("<Ctrl-i>","#15Open vim editor for current input",(function(){g(!1)}));function y(){window.getSelection().toString()?h("https://translate.google.com/?hl=en#auto/en/",!1,!1,""):Ye("https://translate.google.com/translate?js=n&sl=auto&tl=zh-CN&u="+window.location.href)}function w(){var e=[];return document.querySelectorAll("table").forEach((function(t){var n=t.querySelector("tr");n&&e.push(...n.children)})),e}function v(e,t){var n=new FormData(e);if("json"===t){var o={};return n.forEach((function(e,t){if(o.hasOwnProperty(t)){if(e.length){var n=o[t];"Array"===n.constructor.name?n.push(e):(o[t]=[],n.length&&o[t].push(n),o[t].push(e))}}else o[t]=e})),o}return new URLSearchParams(n).toString()}function b(e){return(e.method||"get")+"::"+new URL(e.action).pathname}"Chrome"===he()&&(f("<Ctrl-Alt-i>","#15Open neovim for current input",(function(){g(!0)})),d(";s","Toggle PDF viewer from SurfingKeys",(function(){var e=window.location.href;if(0===e.indexOf(chrome.runtime.getURL("/pages/pdf_viewer.html"))){const t=window.location.search.indexOf("=")+1;e=window.location.search.substr(t),le("updateSettings",{settings:{noPdfViewer:1}},(t=>{window.location.replace(e)}))}else document.querySelector("EMBED")&&"application/pdf"===document.querySelector("EMBED").getAttribute("type")?le("updateSettings",{settings:{noPdfViewer:0}},(t=>{window.location.replace(e)})):le("getSettings",{key:"noPdfViewer"},(function(e){const t=e.settings.noPdfViewer?"PDF viewer enabled.":"PDF viewer disabled.";le("updateSettings",{settings:{noPdfViewer:!e.settings.noPdfViewer}},(e=>{ke(t)}))}))}))),d(";ql","#0Show last action",(function(){Ee(tt(ue.conf.lastKeys.map((function(e){return se.decodeKeystroke(e)})).join(" → ")))}),{repeatIgnore:!0}),d("gi","#1Go to the first edit box",(function(){i.createInputLayer()})),d("i","#1Go to edit box",(function(){i.create("input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor",i.dispatchMouseClick)})),d("I","#1Go to edit box with vim editor",(function(){i.create("input:not([type=submit]), textarea, *[contenteditable=true], *[role=textbox], select, div.ace_cursor",(function(e){a.showEditor(e)}))})),d("L","#1Enter regional Hints mode",(function(){i.create(function(e=.3,t=.3){const n=window.innerWidth,o=window.innerHeight,i=n*e,r=o*t;let a=new DOMRect(0,0,0,0);return Re(((s,c)=>{if(s===document.body)return;const l=s.getBoundingClientRect();if(Math.abs(l.x-a.x)<16&&Math.abs(l.y-a.y)<16&&Math.abs(l.width-a.width)<16&&Math.abs(l.height-a.height)<16)return;if(Math.abs(n-l.width)<4&&Math.abs(o-l.height)<4)return;if(l.width<i&&l.height<r)return;if(l.width/n*(l.height/o)<e*t/6)return;const u=getComputedStyle(s);u.opacity>.1&&"hidden"!==u.visibility&&"none"!==u.display&&(c.push(s),a=l)}))}(),(e=>{}),{regionalHints:!0})})),d("zv","#9Enter visual mode, and select whole element",(function(){r.toggle("z")})),d("yv","#7Yank text of an element",(function(){i.create(ue.conf.textAnchorPat,(function(e){t.write(0===e[1]?e[0].data.trim():e[2].trim())}))})),d("ymv","#7Yank text of multiple elements",(function(){var e=[];i.create(ue.conf.textAnchorPat,(function(n){e.push(0===n[1]?n[0].data.trim():n[2].trim()),t.write(e.join("\n"))}),{multipleHits:!0})})),d("V","#9Restore visual mode",(function(){r.restore()})),d("*","#9Find selected text in current page",(function(){r.star(),r.toggle()})),m("<Ctrl-u>","#9Backward 20 lines",(function(){r.feedkeys("20k")})),m("<Ctrl-d>","#9Forward 20 lines",(function(){r.feedkeys("20j")})),d("m","#10Add current URL to vim-like marks",o.addVIMark),d("'","#10Jump to vim-like mark",o.jumpVIMark),d("<Ctrl-'>","#10Jump to vim-like mark in new tab.",(function(e){o.jumpVIMark(e)})),d("w","#2Switch frames",(function(){ce("ensureFrontEnd"),window===top&&i.create("iframe",(function(e){e.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),o.highlightElement(e),e.contentWindow.focus()}))||o.rotateFrame()})),d("yg","#7Capture current page",(function(){a.toggleStatus(!1),setTimeout((function(){le("captureVisibleTab",null,(function(e){a.toggleStatus(!0),Ee("<img src='{0}' />".format(e.dataUrl))}))}),500)})),d("gu","#4Go up one path in the URL",(function(){var e=location.pathname;if(e.length>1){var t=(e=e.endsWith("/")?e.substr(0,e.length-1):e).lastIndexOf("/"),n=le.repeats;for(le.repeats=1;n-- >1;){var o=e.lastIndexOf("/",t-1);if(-1===o)break;t=o}e=e.substr(0,t)}window.location.href=location.origin+e})),d(";m","#1mouse out last element",(function(){i.mouseoutLastElement()})),d(";pp","#7Paste html on current page",(function(){t.read((function(e){document.documentElement.removeAttributes(),document.body.removeAttributes(),Je(document.head,"<title>"+new Date+" updated by Surfingkeys</title>"),Je(document.body,e.data)}))})),d(";t","Translate selected text with google",(()=>{chrome.surfingkeys?chrome.surfingkeys.translateCurrentPage():y()})),m("t","#9Translate selected text with google",y),d("O","#1Open detected links from text",(function(){i.create(ue.conf.clickablePat,(function(e){window.location.assign(e[2])}),{statusLine:"Open detected links from text"})})),d(".","#0Repeat last action",(function(){const e=ue.conf.lastKeys;o.feedkeys(e[0]);for(var t=e.slice(1),n=0;n<t.length;n++){var r=t[n].split("\t");if("Hints"===r[0]){function a(){var e=r[1];return function(){i.feedkeys(e)}}setTimeout(a(),120+100*n)}}}),{repeatIgnore:!0}),d("f","#1Open a link, press SHIFT to flip overlapped hints, hold SPACE to hide hints",(function(){i.create("",i.dispatchMouseClick)}),{repeatIgnore:!0}),d("v","#9Toggle visual mode",(function(){r.toggle()}),{repeatIgnore:!0}),d("n","#9Next found text",(function(){r.next(!1)}),{repeatIgnore:!0}),d("N","#9Previous found text",(function(){r.next(!0)}),{repeatIgnore:!0}),d(";fs","#1Display hints to focus scrollable elements",(function(){i.create(o.refreshScrollableElements(),i.dispatchMouseClick)})),m("q","#9Translate word under cursor",(function(){var e=je();s.readText(e);var t=r.getCursorPixelPos();a.performInlineQuery(e,{top:t.top,left:t.left,height:t.height,width:t.width},(function(e,t){ce("front",["showBubble",e,t,!0])}))})),d("cq","#7Query word with Hints",(function(){i.create(ue.conf.textAnchorPat,(function(e){var t=e[2].trim().replace(/[^A-z].*$/,""),n=He(e[0],e[1],e[2].length);a.performInlineQuery(t,{top:n.top,left:n.left,height:n.height,width:n.width},(function(e,t){ce("front",["showBubble",e,t,!1])}))}))})),u("g0",":feedkeys 99E",0,"#3Go to the first tab"),u("g$",":feedkeys 99R",0,"#3Go to the last tab"),d("zr","#3zoom reset",(function(){le("setZoom",{zoomFactor:0})})),d("zi","#3zoom in",(function(){le("setZoom",{zoomFactor:.1})})),d("zo","#3zoom out",(function(){le("setZoom",{zoomFactor:-.1})})),u("ZQ",":quit"),d("ZZ","#5Save session and quit",(function(){le("createSession",{name:"LAST",quitAfterSaved:!0})})),d("ZR","#5Restore last session",(function(){le("openSession",{name:"LAST"})})),u("u","e"),d("af","#1Open a link in active new tab",(function(){i.create("",i.dispatchMouseClick,{tabbed:!0,active:!0})})),d("gf","#1Open a link in non-active new tab",(function(){i.create("",i.dispatchMouseClick,{tabbed:!0,active:!1})})),d("cf","#1Open multiple links in a new tab",(function(){i.create("",i.dispatchMouseClick,{multipleHits:!0})})),u("C","gf"),d("<Ctrl-h>","#1Mouse over elements.",(function(){i.create("",((e,t)=>{if(chrome.surfingkeys){const t=e.getClientRects()[0];chrome.surfingkeys.sendMouseEvent(2,Math.round(t.x+t.width/2),Math.round(t.y+t.height/2),0)}else i.dispatchMouseClick(e,t)}),{mouseEvents:["mouseover"]})})),d("<Ctrl-j>","#1Mouse out elements.",(function(){i.create("",i.dispatchMouseClick,{mouseEvents:["mouseout"]})})),d("ya","#7Copy a link URL to the clipboard",(function(){i.create("*[href]",(function(e){t.write(e.href)}))})),d("yma","#7Copy multiple link URLs to the clipboard",(function(){var e=[];i.create("*[href]",(function(n){e.push(n.href),t.write(e.join("\n"))}),{multipleHits:!0})})),d("yc","#7Copy a column of a table",(function(){i.create(w(),(function(e){var n=Array.from(e.closest("table").querySelectorAll("tr")).map((function(t){return t.children.length>e.cellIndex?t.children[e.cellIndex].innerText:""}));t.write(n.join("\n"))}))})),d("ymc","#7Copy multiple columns of a table",(function(){var e=null;i.create(w(),(function(n){var o=Array.from(n.closest("table").querySelectorAll("tr")).map((function(e){return e.children.length>n.cellIndex?e.children[n.cellIndex].innerText:""}));e?o.forEach((function(t,n){e[n]+="\t"+t})):e=o,t.write(e.join("\n"))}),{multipleHits:!0})})),d("yq","#7Copy pre text",(function(){i.create("pre",(function(e){t.write(e.innerText)}))})),u("<Ctrl-i>","I"),l("<ArrowDown>","<Ctrl-n>"),l("<ArrowUp>","<Ctrl-p>"),d("q","#1Click on an Image or a button",(function(){i.create("img, button",i.dispatchMouseClick)})),d("<Alt-p>","#3pin/unpin current tab",(function(){le("togglePinTab")})),d("<Alt-m>","#3mute/unmute current tab",(function(){le("muteTab")})),d("B","#4Go one tab history back",(function(){le("historyTab",{backward:!0})}),{repeatIgnore:!0}),d("F","#4Go one tab history forward",(function(){le("historyTab",{backward:!1})}),{repeatIgnore:!0}),d("<Ctrl-6>","#4Go to last used tab",(function(){le("goToLastTab")})),d("gT","#4Go to first activated tab",(function(){le("historyTab",{index:0})}),{repeatIgnore:!0}),d("gt","#4Go to last activated tab",(function(){le("historyTab",{index:-1})}),{repeatIgnore:!0}),d("gp","#4Go to the playing tab",(function(){le("getTabs",{queryInfo:{audible:!0}},(e=>{if(e.tabs?.at(0)){const t=e.tabs[0];le("focusTab",{windowId:t.windowId,tabId:t.id})}}))}),{repeatIgnore:!0}),d("S","#4Go back in history",(function(){history.go(-1)}),{repeatIgnore:!0}),d("D","#4Go forward in history",(function(){history.go(1)}),{repeatIgnore:!0}),d("r","#4Reload the page",(function(){le("reloadTab",{nocache:!1})})),d("oi","#8Open incognito window",(function(){le("openIncognito",{url:window.location.href})})),d("H","#8Open opened URL in current tab",(function(){a.openOmnibar({type:"TabURLs"})})),d("om","#8Open URL from vim-like marks",(function(){a.openOmnibar({type:"VIMarks"})})),d(":","#8Open commands",(function(){a.openOmnibar({type:"Commands"})})),d("A","#8Open llm chat",(function(){a.openOmnibar({type:"LLMChat"})})),m("A","#8Open llm chat",(function(){const e=window.getSelection().toString();a.openOmnibar({type:"LLMChat",extra:{system:e}})})),d("yi","#7Yank text of an input",(function(){i.create("input, textarea, select",(function(e){t.write(e.value)}))})),d("x","#3Close current tab",(function(){le("closeTab")})),d(";w","#2Focus top window",(function(){top.focus()})),d("cc","#7Open selected link or link from clipboard",(function(){window.getSelection().toString()?Ye(window.getSelection().toString()):t.read((function(e){Ye(e.data)}))})),d(";cq","#7Clear all URLs in queue to be opened",(function(){le("clearQueueURLs")})),d("ys","#7Copy current page's source",(function(){var e=document.documentElement.cloneNode(!0);t.write(e.outerHTML)})),d("yj","#7Copy current settings",(function(){le("getSettings",{key:"RAW"},(function(e){t.write(JSON.stringify(e.settings,null,4))}))})),d(";pj","#7Restore settings data from clipboard",(function(){t.read((function(e){le("updateSettings",{settings:JSON.parse(e.data.trim())})}))})),d("yt","#3Duplicate current tab",(function(){le("duplicateTab")})),d("yT","#3Duplicate current tab in background",(function(){le("duplicateTab",{active:!1})})),d("yy","#7Copy current page's URL",(function(){var e=window.location.href;if(0===e.indexOf(chrome.runtime.getURL("/pages/pdf_viewer.html"))){const t=window.location.search.indexOf("=")+1;e=window.location.search.substr(t)}t.write(e)})),d("yY","#7Copy all tabs's url",(function(){le("getTabs",null,(function(e){t.write(e.tabs.map((e=>e.url)).join("\n"))}))})),d("yh","#7Copy current page's host",(function(){var e=new URL(window.location.href);t.write(e.host)})),d("yl","#7Copy current page's title",(function(){t.write(document.title)})),d("yQ","#7Copy all query history of OmniQuery.",(function(){le("getSettings",{key:"OmniQueryHistory"},(function(e){t.write(e.settings.OmniQueryHistory.join("\n"))}))})),d("yf","#7Copy form data in JSON on current page",(function(){var e={};document.querySelectorAll("form").forEach((function(t){e[b(t)]=v(t,"json")})),t.write(JSON.stringify(e,null,4))})),d(";pf","#7Fill form with data from yf",(function(){i.create("form",(function(e,n){var o=b(e);t.read((function(t){var n=JSON.parse(t.data.trim());if(n.hasOwnProperty(o)){var i=n[o];e.querySelectorAll("input, textarea").forEach((function(t){if(i.hasOwnProperty(t.name)&&"hidden"!==t.type)if("radio"===t.type){var n=e.querySelector(`input[name='${t.name}'][value='${i[t.name]}']`);n&&(n.checked=!0)}else if(Array.isArray(i[t.name])){e.querySelectorAll(`input[name='${t.name}']`).forEach((function(e){e.checked=!1})),i[t.name].forEach((function(n){var o=e.querySelector(`input[name='${t.name}'][value='${n}']`);o&&(o.checked=!0)}))}else"string"==typeof i[t.name]&&(t.value=i[t.name])}))}else ke("No form data found for your selection from clipboard.")}))}))})),d("yp","#7Copy form data for POST on current page",(function(){var e=[];document.querySelectorAll("form").forEach((function(t){var n={};n[(t.method||"get")+"::"+t.action]=v(t),e.push(n)})),t.write(JSON.stringify(e,null,4))})),d("g?","#4Reload current page without query string(all parts after question mark)",(function(){window.location.href=window.location.href.replace(/\?[^\?]*$/,"")})),d("g#","#4Reload current page without hash fragment",(function(){window.location.href=window.location.href.replace(/\#[^\#]*$/,"")})),d("gU","#4Go to root of current URL hierarchy",(function(){window.location.href=window.location.origin})),d("gxt","#3Close tab on left",(function(){le("closeTabLeft")})),d("gxT","#3Close tab on right",(function(){le("closeTabRight")})),d("gx0","#3Close all tabs on left",(function(){le("closeTabsToLeft")})),d("gx$","#3Close all tabs on right",(function(){le("closeTabsToRight")})),d("gxx","#3Close all tabs except current one",(function(){le("tabOnly")})),d("gxp","#3Close playing tab",(function(){le("closeAudibleTab")})),d(";e","#11Edit Settings",(function(){Ye("/pages/options.html")})),d(";u","#4Edit current URL with vim editor, and open in new tab",(function(){a.showEditor(window.location.href,(function(e){Ye(e)}),"url")})),d(";U","#4Edit current URL with vim editor, and reload",(function(){a.showEditor(window.location.href,(function(e){window.location.href=e}),"url")})),c("g","google","https://www.google.com/search?q=","s","https://www.google.com/complete/search?client=chrome-omni&gs_ri=chrome-ext&oit=1&cp=1&pgcl=7&q=",(function(e){return JSON.parse(e.text)[1]})),c("d","duckduckgo","https://duckduckgo.com/?q=","s","https://duckduckgo.com/ac/?q=",(function(e){return JSON.parse(e.text).map((function(e){return e.phrase}))})),c("b","baidu","https://www.baidu.com/s?wd=","s","https://suggestion.baidu.com/su?cb=&wd=",(function(e){var t=e.text.match(/,s:\[("[^\]]+")]}/);return t?t[1].replace(/"/g,"").split(","):[]})),c("e","wikipedia","https://en.wikipedia.org/wiki/","s","https://en.wikipedia.org/w/api.php?action=opensearch&format=json&formatversion=2&namespace=0&limit=40&search=",(function(e){return JSON.parse(e.text)[1]})),c("w","bing","https://www.bing.com/search?setmkt=en-us&setlang=en-us&q=","s","https://api.bing.com/osjson.aspx?query=",(function(e){return JSON.parse(e.text)[1]})),c("s","stackoverflow","https://stackoverflow.com/search?q="),c("h","github","https://github.com/search?q=","s","https://api.github.com/search/repositories?order=desc&q=",(function(e){var t=JSON.parse(e.text).items;return t?t.map((function(e){return{title:e.description,url:e.html_url}})):[]})),c("y","youtube","https://www.youtube.com/results?search_query=","s","https://clients1.google.com/complete/search?client=youtube&ds=yt&callback=cb&q=",(function(e){return JSON.parse(e.text.substr(9,e.text.length-10))[1].map((function(e){return e[0]}))}));const k=he();"Firefox"===k?d("on","#3Open newtab",(function(){Ye("about:blank")})):"Chrome"===k&&(d("cp","#13Toggle proxy for current site",(function(){var e=window.location.host.replace(/:\d+/,"");e&&e.length&&le("updateProxy",{host:e,operation:"toggle"})})),d(";cp","#13Copy proxy info",(function(){le("getSettings",{key:["proxyMode","proxy","autoproxy_hosts"]},(function(e){t.write(JSON.stringify(e.settings,null,4))}))})),d(";ap","#13Apply proxy info from clipboard",(function(){t.read((function(e){var t=JSON.parse(e.data);le("updateProxy",{operation:"set",host:t.autoproxy_hosts,proxy:t.proxy,mode:t.proxyMode})}))})),u(";pa",":setProxyMode always",0,"#13set proxy mode `always`"),u(";pb",":setProxyMode byhost",0,"#13set proxy mode `byhost`"),u(";pd",":setProxyMode direct",0,"#13set proxy mode `direct`"),u(";ps",":setProxyMode system",0,"#13set proxy mode `system`"),u(";pc",":setProxyMode clear",0,"#13set proxy mode `clear`"),d("gr","#14Read selected text or text from clipboard",(function(){t.read((function(e){p(window.getSelection().toString()||e.data,{verbose:!0})}))})),m("gr","#9Read selected text",(function(){p(window.getSelection().toString(),{verbose:!0})})),d("on","#3Open newtab",(function(){Ye("chrome://newtab/")})),d("ga","#12Open Chrome About",(function(){Ye("chrome://help/")})),d("gb","#12Open Chrome Bookmarks",(function(){Ye("chrome://bookmarks/")})),d("gc","#12Open Chrome Cache",(function(){Ye("chrome://cache/")})),d("gd","#12Open Chrome Downloads",(function(){Ye("chrome://downloads/")})),d("gh","#12Open Chrome History",(function(){Ye("chrome://history/")})),d("gk","#12Open Chrome Cookies",(function(){Ye("chrome://settings/cookies")})),d("ge","#12Open Chrome Extensions",(function(){Ye("chrome://extensions/")})),d("gn","#12Open Chrome net-internals",(function(){Ye("chrome://net-internals/#proxy")})),d(";i","#12Open Chrome Inspect",(function(){Ye("chrome://inspect/#devices")})),d(";v","#11Open neovim",(function(){Ye("/pages/neovim.html")}))),d("X","#3Restore closed tab",(function(){le("openLast")})),he().startsWith("Safari")||(d("t","#8Open a URL",(function(){a.openOmnibar({type:"URLs"})})),d("go","#8Open a URL in current tab",(function(){a.openOmnibar({type:"URLs",tabbed:!1})})),d("ox","#8Open recently closed URL",(function(){a.openOmnibar({type:"RecentlyClosed"})})),d("b","#8Open a bookmark",(function(){a.openOmnibar({type:"Bookmarks"})})),d("ab","#8Bookmark current page to selected folder",(function(){var e={url:window.location.href,title:document.title};a.openOmnibar({type:"AddBookmark",extra:e})})),d("oh","#8Open URL from history",(function(){a.openOmnibar({type:"History"})})),d("W","#3Move current tab to another window",(function(){a.openOmnibar({type:"Windows"})})),d(";gt","#3Gather filtered tabs into current window",(function(){a.openOmnibar({type:"Tabs",extra:{action:"gather"}})})),d(";gw","#3Gather all tabs into current window",(function(){le("gatherWindows")})),d("<<","#3Move current tab to left",(function(){le("moveTab",{step:-1})})),d(">>","#3Move current tab to right",(function(){le("moveTab",{step:1})})),d("yd","#7Copy current downloading URL",(function(){le("getDownloads",{query:{state:"in_progress"}},(function(e){var n=e.downloads.map((function(e){return e.url}));t.write(n.join(","))}))})),d("gs","#12View page source",(function(){le("viewSource",{tab:{tabbed:!0}})})),d(";pm","#11Preview markdown",(function(){Ye("/pages/markdown.html")})),d(";di","#1Download image",(function(){i.create("img",(function(e){le("download",{url:e.src})}))})),d(";j","#12Close Downloads Shelf",(function(){le("closeDownloadsShelf",{clearHistory:!0})})),d(";dh","#14Delete history older than 30 days",(function(){le("deleteHistoryOlderThan",{days:30})})),d(";yh","#14Yank histories",(function(){le("getHistory",{},(function(e){t.write(e.history.map((e=>e.url)).join("\n"))}))})),d(";ph","#14Put histories from clipboard",(function(){t.read((function(e){le("addHistories",{history:e.data.split("\n")})}))})),d(";db","#14Remove bookmark for current page",(function(){le("removeBookmark")})))}function Lt(e){const t=ue.conf[e];!t||!t.source||t instanceof RegExp||(ue.conf[e]=new RegExp(t.source,t.flags))}function Rt(e){Lt("prevLinkRegex"),Lt("nextLinkRegex"),Lt("clickablePat"),le("getState",{blocklistPattern:ue.conf.blocklistPattern?ue.conf.blocklistPattern:void 0,lurkingPattern:ue.conf.lurkingPattern?ue.conf.lurkingPattern:void 0},(function(t){let n=t.state;if("disabled"===n?(e.disable(),ce("front",["showStatus",[void 0,void 0,void 0,""]])):"lurking"===n?n=e.startLurk():("application/pdf"!==document.contentType||t.noPdfViewer?e.enable():Ut.usePdfViewer(),mt.showStatus()),window===top){le("setSurfingkeysIcon",{status:n});var o="";"enabled"===n&&ue.conf.showProxyInStatusBar&&t.proxyMode&&(o=t.proxyMode,-1!==["byhost","always"].indexOf(t.proxyMode)&&(o="{0}: {1}".format(t.proxyMode,t.proxy))),ce("front",["showStatus",[void 0,void 0,void 0,o]])}}))}const It=new Promise((function(e,t){document.addEventListener("surfingkeys:settingsFromSnippetsLoaded",(()=>{e(ue.conf)}),{once:!0})}));function Mt(e,t,n){for(var o in n)ue.conf.hasOwnProperty(o)&&(ue.conf[o]=n[o]);if("findHistory"in n&&(ue.conf.lastQuery=n.findHistory.length?n.findHistory[0]:""),n.showAdvanced){if(!n.isMV3&&n.snippets&&!document.location.href.startsWith(chrome.runtime.getURL("/"))){var i={},r="";try{new Function("settings","api",n.snippets)(i,e)}catch(e){r=e.toString()}""!==(a={settings:i,error:r}).error&&(window===top?Ee("[SurfingKeys] Error found in settings: "+a.error):console.log("[SurfingKeys] Error found in settings({0}): {1}".format(window.location.href,a.error))),function(e){for(var t in e)return!1;return!0}(a.settings)||ce("front",["applySettingsFromSnippets",a.settings])}}else if(n.basicMappings&&function(e,t,n){const o=new Set(Object.keys(n)),i={};for(const r in n){const a=n[r];if(o.has(a)){const e=t.mappings.find(a);e&&(i[a]=e.meta)}""===a?t.mappings.remove(r):i.hasOwnProperty(r)?t.mappings.add(a,i[r]):e.map(a,r)}}(e,t,n.basicMappings),n.disabledSearchAliases)for(const t in n.disabledSearchAliases)e.removeSearchAlias(t);var a;Rt(t),document.addEventListener("surfingkeys:settingsFromSnippetsLoaded",(()=>{Rt(t)}),{once:!0})}function Pt(){const e=Ct(),t=bt(),n=yt(t);n.enter(),wt(n);const o=xt(t,n,e),i=kt(e,o),r=_t(t,n,o,i,Ut),a=Ot(e,t,n,o,i,r,Ut);return Nt(a,e,t,n,o,i,r,Ut),"function"==typeof Ut.plugin&&Ut.plugin({front:r}),ce("defaultSettingsLoaded",{normal:n,api:a}),le("getSettings",null,(function(e){var t=e.settings;Mt(a,n,t);ce("userSettingsLoaded",{settings:t,disabledSearchAliases:t.disabledSearchAliases,getUsage:r.getUsage,frontCommand:r.command})})),{normal:n,front:r,api:a}}function Ft(e){if(window.frameId=we(),ue.on("settingsUpdated",(t=>{var n=t.settings;Mt(e.api,e.normal,n)})),ue.conf.stealFocusOnLoad&&!ge()&&document.body&&document.body.childElementCount>1){var t=Ce();t&&t.blur()}}let Ut;window.getFrameId=function(){return!window.frameId&&window.innerWidth>16&&window.innerHeight>16&&document.body&&document.body.childElementCount>0&&-1===ue.conf.ignoredFrameHosts.indexOf(window.origin)&&(!window.frameElement||parseInt("0"+getComputedStyle(window.frameElement).zIndex)>=0&&window.frameElement.offsetWidth>16&&window.frameElement.offsetWidth>16)&&(Ft(Pt()),setTimeout((()=>{ce("user",["runUserScript"])}),100)),window.frameId},mt.init(window===top?void 0:()=>{window.addEventListener("focus",(()=>{getFrameId()}),{once:!0})}),Ut={usePdfViewer:function(){window.location.replace(chrome.runtime.getURL("/pages/pdf_viewer.html")+"?file="+document.URL)},readText:function(e,t){var n=(t=t||{enqueue:!0,voiceName:ue.conf.defaultVoice}).verbose,o=/[\s\u00a0]/g,i=(n=t.verbose,t.onEnd);delete t.verbose,delete t.onEnd,le("read",{content:e,options:t},(function(t){if(n)if("start"===t.ttsEvent.type)Ee(e);else if("word"===t.ttsEvent.type){o.lastIndex=t.ttsEvent.charIndex;var r=o.exec(e);Ee(r?e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex,r.index-t.ttsEvent.charIndex+1)+"</font>"+e.substr(r.index):e.substr(0,t.ttsEvent.charIndex)+"<font style='font-weight: bold; text-decoration: underline'>"+e.substr(t.ttsEvent.charIndex)+"</font>")}else"end"===t.ttsEvent.type&&ce("front",["hidePopup"]);return!i||"end"!==t.ttsEvent.type&&"interrupted"!==t.ttsEvent.type||i(),"end"!==t.ttsEvent.type}))}}||{usePdfViewer:()=>{},readText:()=>{}},window===top?new Promise(((e,t)=>{window.location.href===chrome.runtime.getURL("/pages/options.html")?import("./pages/options.js").then((t=>{t.default(le,se,mt,Ze,he,tt,Ve,Ae,Je,ke),e(Pt())})):e(Pt())})).then((e=>{Ft(e),ue.on("titleChanged",(function(){mt.checkEventListener((()=>{e.front.detach(),Ft(e=Pt()),e.front.attach()}))})),ue.on("tabActivated",(function(){e.front.attach()})),ue.on("tabDeactivated",(function(){e.front.detach()})),ue.on("setScrollPos",(function(e,t,n){setTimeout((()=>{document.scrollingElement.scrollLeft=e.scrollLeft,document.scrollingElement.scrollTop=e.scrollTop}),1e3)})),ue.on("showBanner",(function(e,t,n){ke(e.message,3e3)})),document.addEventListener("surfingkeys:ensureFrontEnd",(function(t){e.front.attach()})),le("tabURLAccessed",{title:document.title,url:window.location.href},(function(e){if(e.index>0){var t=function(){o=!0,It.then((function(e){document.title=n+e.tabIndicesSeparator+i}))},n=e.index,o=!1,i=document.title;new MutationObserver((function(e){o?o=!1:(i=document.title,t())})).observe(document.querySelector("title"),{childList:!0}),t(),ue.on("tabIndexChange",(function(e,o,i){e.index!==n&&(n=e.index,t())}))}}))})):document.addEventListener("surfingkeys:iframeBoot",(()=>{Ft(Pt())}),{once:!0})})();