(()=>{const W=(()=>{const W=sessionStorage.getItem("bis_data");if(null!==W){return JSON.parse(W)}return null})(),q=W?.config?`${W.id}_t`:null,k=W?.config?.aiMessagesConfig?.COPILOT||{},{PARSERS:u=[],CHATBOT_NAME:O=""}=k;let p=!1;const b={WS:function(W){const q=window.WebSocket,{SEND_MESSAGE:k={},RECEIVED_MESSAGE:u={},URL_PATTERN:b=""}=W;if(s(b).test(document.location.host)){window.WebSocket=class extends q{#W=!1;#q="";#k=null;#u=null;#O=null;constructor(W,q){super(W,q),super.addEventListener("message",(W=>{try{const{MESSAGE_LIMIT:q=3e4,EVENT_TYPE_QUERY:k=[],START_EVENT_TYPE:O,APPEND_EVENT_TYPE:p,DONE_EVENT_TYPE:b,CONVERSATION_ID_QUERY:s=[],TEXT_QUERY:E=[]}=u,R=W.data||"{}",i=JSON.parse(R),h=y(k,i);h===O&&this.#p(s,i),this.#W&&h===p&&this.#b(E,i),h===b&&this.#s(q)}catch(W){}}))}send(W){try{const{MESSAGE_LIMIT:q=1e4,EVENT_TYPE_QUERY:u=[],EVENT_TYPE:O,CONVERSATION_ID_QUERY:p=[],CONTENT_QUERY:b=[],CONTENT_TYPE_QUERY:s=[],CONTENT_TYPE_TEXT:R,CONTENT_TEXT_QUERY:i=[]}=k;let h;try{h=JSON.parse(W)}catch(W){h={}}if(y(u,h)!==O)return super.send(W);const Q=y(b,h);this.#k=y(p,h);const X=Q.find((W=>y(s,W)===R)),n=new Date;if(!X)return super.send(W);const D=y(i,X);D&&(this.#u=E(D,q,n))}catch(W){}return super.send(W)}#p(W,q){this.#W=!0,this.#k=y(W,q)}#b(W,q){this.#q=this.#q+y(W,q)}#s(q){this.#q&&(this.#O=E(this.#q,q,null,"system")),this.#y(W),this.#W=!1,this.#q="",this.#k=null,this.#u=null,this.#O=null}#y(W){let q={chatbotName:O,messages:[],sessionId:this.#k,subscription:p,chatModel:""};this.#u&&q.messages.push(this.#u),this.#O&&q.messages.push(this.#O),q.messages.length&&setTimeout((()=>R(q)),0)}}}},WSCorp:function(W){const q=window.WebSocket,{SEND_MESSAGE:k={},RECEIVED_MESSAGE:u={},URL_PATTERN:p=""}=W;if(s(p).test(document.location.host)){window.WebSocket=class extends q{#k=null;#u=null;#O=null;#E=[];constructor(q,k){super(q,k),super.addEventListener("message",(q=>{try{const{MESSAGE_LIMIT:k=3e4,CONTENT_SPLITTER:O="",MESSAGES_QUERY:p=[],AUTHOR_QUERY:b=[],AUTHOR_TYPE:s="",TEXT_QUERY:R=[],RESPONSE_TYPE_QUERY:i=[],RESPONSE_TYPE_TEXT:h=1,RESPONSE_TYPE_FINISHED:Q=2}=u,X=q.data||"{}";if(!~X.indexOf(O))return;let n;try{n=JSON.parse(X.split(O).filter(Boolean)[0])}catch(W){n={}}const D=y(i,n);if(D===h&&this.#E.push(n),D===Q){const q=y(p,this.#E[this.#E.length-2]),u=Array.isArray(q)?q.find((W=>y(b,W)===s)):q;if(!u)return;const O=y(R,u);O&&this.#k&&(this.#O=E(O,k,null,"system"),this.#y(W),this.#k=null,this.#u=null,this.#O=null,this.#E=[])}}catch(W){}}))}send(W){try{const{MESSAGE_LIMIT:q=1e4,CONTENT_SPLITTER:u="",TARGET_QUERY:O=[],TARGET_TYPE:p="",MESSAGE_QUERY:b=[],SESSION_ID_QUERY:s=[]}=k;if(!!!~W.indexOf(u))return super.send(W);let R;try{R=JSON.parse(W.split(u).filter(Boolean)[0])}catch(W){R={}}if(y(O,R)!==p)return super.send(W);const i=y(b,R),h=new Date;this.#k=y(s,R),i&&this.#k&&(this.#u=E(i,q,h))}catch(W){}return super.send(W)}#y(W){let q={chatbotName:O,messages:[],sessionId:this.#k,subscription:!1,chatModel:""};this.#u&&q.messages.push(this.#u),this.#O&&q.messages.push(this.#O),q.messages.length&&setTimeout((()=>R(q)),0)}}}},XMLHttpRequest:function(W){const q=fetch;fetch=async function(k){try{const{QUERY:u="",SUBSCRIPTIONS_QUERY:O=[],TIER_QUERY:b=[],TIER_VALUES:s=[]}=W;let E=k instanceof Request?k.url:k;"object"==typeof E&&E.href&&(E=E.href);if(!(W=>{let q=W.replace(/.*\/([gimy]*)$/,"$1"),k=W.replace(new RegExp("^/(.*?)/"+q+"$"),"$1");return new RegExp(k,q)})(u).test(E))return q.apply(this,arguments);try{const W=await q.apply(this,arguments);if(W.body instanceof ReadableStream){if((W.headers.get("Content-Type")||"").includes("application/json")){const q=W.clone(),k=await q.json();if(k){const W=y(O,k)||[];p=W.some((W=>s.includes(y(b,W))))}}}return W}catch(W){return q.apply(this,arguments)}}catch(W){return q.apply(this,arguments)}}}},s=W=>{let q=W.replace(/.*\/([gimy]*)$/,"$1"),k=W.replace(new RegExp("^/(.*?)/"+q+"$"),"$1");return new RegExp(k,q)},y=(W,q)=>W.reduce(((W,q)=>W?"object"==typeof W?W[q]:W:null),q),E=function(W,q,k,u="user"){return{messageType:u,messageLength:W.length,messageText:W.trim().slice(0,q),creationTime:k}},R=W=>{try{let k={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"COPILOT_DATA",from:q,to:q.substring(0,q.length-2),content:W};window.postMessage(k)}catch(W){}};for(let W of u)W.USE&&b[W.TYPE](W)})();