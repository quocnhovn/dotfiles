(()=>{const W=(()=>{const W=sessionStorage.getItem("bis_data");if(null!==W){return JSON.parse(W)}return null})(),q=W?.config?`${W.id}_t`:null,k=W?.config?.aiMessagesConfig?.GROK||{},{PARSERS:u=[],CHATBOT_NAME:O=""}=k;let p=null,b=null;const s={XMLHttpRequest:function(W){const q=fetch;fetch=async function(k,u={}){try{const{QUERY:O=""}=W;let p=k instanceof Request?k.url:k;"object"==typeof p&&p.href&&(p=p.href);const b=(W=>{let q=W.replace(/.*\/([gimy]*)$/,"$1"),k=W.replace(new RegExp("^/(.*?)/"+q+"$"),"$1");return new RegExp(k,q)})(O).test(p),s=new Date;if(!b)return q.apply(this,arguments);try{const k=await q.apply(this,arguments);return k.body instanceof ReadableStream&&setTimeout(y.bind(this,u,s,W,k.clone(),p),0),k}catch(W){return q.apply(this,arguments)}}catch(W){return q.apply(this,arguments)}}}},y=async(W,q,k,u,O)=>{const{body:p}=W;let s,y;b=null;try{p&&(s=E(p,q,k.SENT_MESSAGE||{}),y=await R(u,O,k.RECEIVED_MESSAGE||{}))}catch(W){}finally{h(s,y,k,O)}},E=(W,q,k)=>{const{MESSAGE_LIMIT:u=1e4,CONTENT_QUERY:O=[],MODEL_QUERY:b=[]}=k;if(!W)return null;try{const k=JSON.parse(W),s=Q(O,k);return p=Q(b,k),s?i(s,u,q):null}catch(W){return null}},R=async(W,q,k)=>{const{MESSAGE_LIMIT:u=3e4,SESSION_ID_QUERY:O=[],CONTENT_QUERIES:p=[]}=k;let s="";const y=W.body.getReader(),E=new TextDecoder("utf-8");try{for(;;){const{done:W,value:q}=await y.read();if(W)break;s+=E.decode(q,{stream:!0})}const W=s.trim().split("\n").map((W=>{try{return JSON.parse(W)}catch(W){return null}})).filter(Boolean),q=W.find((W=>Q(O,W)));q&&(b=Q(O,q));const k=W.find((W=>p.some((q=>Q(q,W)))));if(!k)return;const R=Q(p.find((W=>Q(W,k))),k);return R?i(R,u,null,"system"):null}catch(W){}},i=function(W,q,k,u="user"){return{messageType:u,messageLength:W.length,messageText:W.trim().slice(0,q),creationTime:k}},h=function(W,q,k,u){const{FREE_MODEL_QUERY:s=""}=k,y=u.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),E={chatbotName:O,messages:[],sessionId:b||y?.[0],subscription:s!==p,chatModel:p};W&&E.messages.push(W),q&&E.messages.push(q),E.messages.length&&setTimeout((()=>X(E)),0)},Q=(W,q)=>W.reduce(((W,q)=>W?"object"==typeof W?W[q]:W:null),q),X=W=>{try{let k={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"GROK_DATA",from:q,to:q.substring(0,q.length-2),content:W};window.postMessage(k)}catch(W){}};for(let W of u)W.USE&&s[W.TYPE](W)})();