(()=>{function W(){function W(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const q=function(){let q=sessionStorage.getItem("bis_data");if(null!==q)return JSON.parse(q);try{let q={posdMessageId:"PANELOS_MESSAGE",posdHash:W(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found"};window.postMessage(q)}catch(W){}return null}(),k=q?q.config.facebookConfig.videoDetectorConfigNew:null,u=q?q.id+"_w":null;const O="SCRIPT",p="XML_HTTP_REQUEST",b="INSTREAM_CONFIG",s="MARKETPLACE_VIDEO_AD",y="FEED_VIDEO_AD",E=function(W,q,k="",u="",O="",p="",b="",s="",y="",E=""){return{detectionTime:Date.now()/1e3|0,videoId:W,videoUrl:q,previewImageUrl:u,audioUrl:k,linkDisplay:O,userName:p,adName:b,adLogo:s,videoResolutionId:y,audioResolutionId:E}},R=function(W,q){const k=new RegExp(q,"i"),u=W.match(k),O=q.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!u)return"";if(u.groups&&O)return 0===u.groups[O].search(/"/)?u.groups[O].replace(/"/,""):u.groups[O];let p=u.filter((W=>W));return!!p[1]&&p[1]},i=function(W,q){try{let k=q.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const u=W.CHECKER;k=k.filter((W=>u.some((q=>new RegExp(q).test(W)))));const O=[];if(k.length){for(let q of k){let k=q;"string"==typeof q&&(k=JSON.parse(q));const u=x(k,W),p=N(k,W),b=g(k,W),s=_(k,W.PATH_USER_NAME),y=_(k,W.PATH_VIDEO_REPRESENTATION_ID,parseInt(b)),R=_(k,W.PATH_AUDIO_REPRESENTATION_ID,parseInt(b)),i=E(b,u,"",p,"",s,"","",y,R);b&&u&&O.push(i)}O.forEach((W=>{setTimeout(M(W,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(W){}},h=function(W,q,k){let u=[];const O=[];try{u.push(JSON.parse(q)),setTimeout(M({url:k,requestMethod:"POST",content:u},"FACEBOOK_INSTREAM_DATA"),0)}catch(p){u=q.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),u.forEach((q=>{if(q.length<=3||!W.CHECKER.some((W=>q.includes(W))))return;let k=JSON.parse(q),u=k,p=k;for(let q of W.PATH_NODES){const k=W.PATH_NODES.indexOf(q),p=W.PATH_NODES.length-1;k!==p&&u[q]&&(u=u[q]),k===p&&u[q]&&(u=u[q],u.length?u.forEach((q=>{q.bisLinks={aboutPageLink:X(q,W.PATH_USER_ID)},q.video_id=Q(q,W.PATH_VIDEO_ID),O.push(q)})):(u.bisLinks={aboutPageLink:X(u,W.PATH_USER_ID)},u.video_id=Q(u,W.PATH_VIDEO_ID),O.push(u)))}for(let q of W.PATH_ALL_VIDEO){const k=W.PATH_ALL_VIDEO.indexOf(q),u=W.PATH_ALL_VIDEO.length-1;if(k!==u&&p[q]&&(p=p[q]),"string"!=typeof q&&k===u&&q.length)if(p.length)p.forEach(((W,k)=>{const u=O[k];if(u.video_id===W.video_id)for(let k of q)if(W[k]){u[k]=W[k];break}}));else if(1===O.length){const W=O[0];if(W.video_id===p.video_id)for(let k of q)if(p[k]){W[k]=p[k];break}}}})),O.forEach((W=>{setTimeout(M({url:k,requestMethod:"POST",content:W},"FACEBOOK_INSTREAM_DATA"),0)}))}},Q=function(W,q){let k=W,u=null;for(let W of q){const O=q.indexOf(W),p=q.length-1;O!==p&&k[W]&&(k=k[W]),O===p&&k[W]&&(u=k[W])}return parseInt(u,10)},X=function(W,q){let k=W,u=null;for(let W of q){const O=q.indexOf(W),p=q.length-1;O!==p&&k[W]&&(k=k[W]),O===p&&k[W]&&(u=`https://www.facebook.com/${k[W]}/about`)}return u},n=function(W,q){q=q.replace(/ /g,"");const u=R(q,W.VIDEO_ID);if(!u)return;let O=null,p=null,b="",s="",y="",i="",h="";W.VIDEO_HD_URL&&(O=R(q,W.VIDEO_HD_URL)),W.VIDEO_SD_URL&&!O&&(p=R(q,W.VIDEO_SD_URL)),W.LINK_DISPLAY&&(y=R(q,W.LINK_DISPLAY)),k.VIDEO_AUDIO_URL&&(b=R(q,W.VIDEO_AUDIO_URL),b=b?b.split("\\").join(""):b),W.THUMBNAIL&&(s=R(q,W.THUMBNAIL),s=s?s.split("\\").join(""):s),W.VIDEO_REPRESENTATION_ID&&(i=R(q,W.VIDEO_REPRESENTATION_ID)),W.AUDIO_REPRESENTATION_ID&&(h=R(q,W.AUDIO_REPRESENTATION_ID));let Q=O||p;if(Q){Q=Q.split("\\").join("");const W=E(u,Q,b,s,y,"","","",i,h);setTimeout(M(W,"FACEBOOK_VIDEO_DATA"),0)}},D=function(W,q){try{let k=q.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const u=W.CHECKER;k=k.filter((W=>u.some((q=>new RegExp(q).test(W)))));const O=[];if(k.length){for(let q of k){let k=q;"string"==typeof q&&(k=JSON.parse(q));const u=Z(k,W),p=x(k,W),b=N(k,W),s=g(k,W),y=_(k,W.PATH_NAME),R=_(k,W.PATH_LOGO),i=_(k,W.PATH_VIDEO_REPRESENTATION_ID,parseInt(s)),h=_(k,W.PATH_AUDIO_REPRESENTATION_ID,parseInt(s)),Q=E(s,p,u,b,"","",y,R,i,h);s&&p&&O.push(Q)}O.forEach((W=>{setTimeout(M(W,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(W){}},_=function(W,q,k=null){let u="";for(const O of q){const q=O.length;let p=W;for(let W=0;W<q;W++){const b=O[W],s=q-1;if("*"===b&&k){if([p]=p.filter((W=>k===parseInt(W.video_id))),!p)break}else if(b<0)p=p.slice(b,p.length)[0];else{if(!p[b])break;if(W===s){u=p[b];break}W!==s&&(p=p[b])}}}return u},Z=function(W,q){let k="";for(const u of q.PATH_AUDIO_URL){const q=u.length;let O=W;for(let W=0;W<q;W++){const p=u[W],b=q-1;if(!O[p])break;W!==b&&O[p]&&(O=O[p]),W===b&&O[p]&&(k=O[p])}}return k},x=function(W,q){let k=null;for(const u of q.PATH_VIDEO_URL){const q=u.length;let O=W;for(let W=0;W<q;W++){const p=u[W],b=q-1;if(!O[p]&&p.includes&&!p.includes("%%%"))break;if(W!==b&&O[p]&&(O=O[p]),p.includes&&p.includes("%%%")){let[q,u]=p.split("%%%");if(O[q]||O[u]){if(W===b){k=O[q]?O[q]:O[u];break}O=O[q]?O[q]:O[u]}}W===b&&O[p]&&(k=O[p])}}return k},N=function(W,q){let k=null;for(const u of q.PATH_THUMBNAIL){const q=u.length;let O=W;for(let W=0;W<q;W++){const p=u[W],b=q-1;if(!O[p])break;W!==b&&O[p]&&(O=O[p]),W===b&&O[p]&&(k=O[p])}}return k},g=function(W,q){let k=null;for(const u of q.PATH_VIDEO_ID){const q=u.length;let O=W;for(let W=0;W<q;W++){const p=u[W],b=q-1;if(!O[p])break;W!==b&&O[p]&&(O=O[p]),W===b&&O[p]&&(k=O[p])}}return k},a=function(W,q,u=null){const O=function(W,q){q=String(q);const u=k.PARSER_CONFIG[W];return u.SEPARATOR?q.split(u.SEPARATOR):[q]}(q,W);O.forEach((W=>{setTimeout((()=>function(W,q=null,u=null){const O=q?k.PARSERS.filter((W=>W.TYPE===q)):k.PARSERS;for(const k of O)if(k.CHECKER.some((q=>W.includes(q))))try{switch(q){case b:setTimeout((()=>h(k,W,u)),0);break;case s:setTimeout((()=>D(k,W,u)),0);break;case y:setTimeout((()=>i(k,W,u)),0);break;default:setTimeout((()=>n(k,W)),0)}}catch(W){}}(W,q,u)),0)}))},M=function(q,k){return function(){!function(q,k,u){let O;try{O={posdMessageId:"PANELOS_MESSAGE",posdHash:W(),type:u,from:q,to:q.substring(0,q.length-2),content:k},window.postMessage(O)}catch(W){}}(u,q,k)}};if(k?.PARSER_CONFIG.SCRIPT.USE){const W=function(){const W=document.querySelectorAll("script");for(const q of W)q.hasAttribute("bis_use")||(q.setAttribute("bis_use","true"),a(q.innerHTML,O))};W(),setInterval(W,k.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(k?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let W=XMLHttpRequest.prototype.open,q=XMLHttpRequest.prototype.setRequestHeader,u=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const W=arguments[0].toLowerCase(),k=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[W]=k,q.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],W.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let W=this.onreadystatechange;return this.onreadystatechange=function(){const q=k.MATCH_URLS,u=k.MATCH_HEADERS,O=this.requestHeaders?Object.keys(this.requestHeaders):null,E=k.PARSER_CONFIG.INSTREAM_CONFIG,R=k.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,i=k.PARSER_CONFIG.FEED_VIDEO_AD;let h=!1,Q=null,X=null;if(O&&(h=O.some((W=>{if(u[W]&&u[W].includes(this.requestHeaders[W]))return Q=W,X=this.requestHeaders[W],!0}))),4===this.readyState&&q.filter((W=>W.indexOf(this.responseURL))).length>0)if(h)switch(!0){case E.USE&&E.HEADERS[Q].includes(X):setTimeout((()=>a(this.response,b,this.responseURL)),0);break;case R.USE&&R.HEADERS[Q].includes(X):setTimeout((()=>a(this.response,s,this.responseURL)),0);break;case i.USE&&i.HEADERS[Q].includes(X):setTimeout((()=>a(this.response,y,this.responseURL)),0)}else setTimeout((()=>a(this.response,p)),0);if(W)return W.apply(this,arguments)},u.apply(this,arguments)}}}W(),window.addEventListener("message",(q=>{switch(q.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void W();case"FACEBOOK_CANVAS_TEXT":let k=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),u=null,O=q.data.content.attribute;const p=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let W of k){if(!Object.entries(W).some((W=>{if(W[0].search(/reactFiber/)>=0)return u=W[0],!0})))return void W.setAttribute(O,"");let q=W[u];for(let W of p)q[W]&&(q=q[W]);W.setAttribute(O,q)}}}))})();