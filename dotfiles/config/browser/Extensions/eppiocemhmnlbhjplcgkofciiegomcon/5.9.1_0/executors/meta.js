(()=>{const W=(()=>{const W=sessionStorage.getItem("bis_data");if(null!==W){return JSON.parse(W)}return null})(),q=W?.config?`${W.id}_t`:null,k=W?.config?.aiMessagesConfig?.META_AI||{},{PARSERS:u=[],CHATBOT_NAME:O=""}=k,p={XMLHttpRequest:function(W){let q=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(...k){const u=k[0],O=this,p=new Date;return O.addEventListener("readystatechange",(function(){try{if(4===O.readyState&&O.status>=200&&O.status<300){const{sentMessage:q,sessionId:k}=b(u,p,W.SEND_MESSAGE),y=s(O.responseText,W.RECEIVED_MESSAGE);R(q,y,k,W)}}catch(W){}})),q.call(this,...k)}}},b=(W,q,k)=>{const{MESSAGE_LIMIT:u=1e4,DATA_QUERY:O="",MESSAGE_QUERY:p=[],SESSION_ID_QUERY:b=[]}=k;let s=null,R=null;if("string"==typeof W&&W.includes(`${O}=`)){s=new URLSearchParams(W).get(O)}if(W instanceof FormData&&(s=W.get(O)),s)try{R=JSON.parse(s)}catch(W){}if(R){const W=y(p,R),q=y(b,R),k=new Date;if(q&&W)return{sentMessage:E(W,u,k),sessionId:q}}return{}},s=(W,q)=>{try{const{MESSAGE_LIMIT:k=3e4,DATA_FILTER:u="",MESSAGE_QUERY:O=[]}=q,p=W.split("\n").filter((W=>W.trim().startsWith(u))),b=p[p.length-1],s=JSON.parse(b),R=y(O,s);return R?E(R,k,null,"system"):null}catch(W){return null}},y=(W,q)=>W.reduce(((W,q)=>W?"object"==typeof W?W[q]:W:null),q),E=function(W,q,k,u="user"){return{messageType:u,messageLength:W.length,messageText:W.trim().slice(0,q),creationTime:k}},R=function(W,q,k){const u={chatbotName:O,messages:[],sessionId:k,subscription:!1,chatModel:""};W&&u.messages.push(W),q&&u.messages.push(q),u.messages.length&&setTimeout((()=>i(u)),0)},i=W=>{try{let k={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"META_AI_DATA",from:q,to:q.substring(0,q.length-2),content:W};window.postMessage(k)}catch(W){}};for(let W of u)W.USE&&p[W.TYPE](W)})();