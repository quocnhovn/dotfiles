(()=>{const W=(()=>{const W=sessionStorage.getItem("bis_data");if(null!==W){return JSON.parse(W)}return null})(),q=W?.config?`${W.id}_t`:null,k=W?.config?.aiMessagesConfig?.CLAUDE||{},{PARSERS:u=[],CHATBOT_NAME:O="",QUERY_GET_CHAT_MODEL:p="",CHAT_MODEL_PREFIX:b=""}=k;let s=!1;const y={XMLHttpRequest:function(W){const q=fetch,k=W=>{let q=W.replace(/.*\/([gimy]*)$/,"$1"),k=W.replace(new RegExp("^/(.*?)/"+q+"$"),"$1");return new RegExp(k,q)};fetch=async function(u,O={}){try{const{QUERY:p="",RETRY_QUERY:b="",SUBSCRIPTION_QUERY:s=""}=W;let y=u instanceof Request?u.url:u;"object"==typeof y&&y.href&&(y=y.href);const i=k(p).test(y),h=k(b).test(y),Q=k(s).test(y),X=new Date;if(Q)try{const k=await q.apply(this,arguments);return k.body instanceof ReadableStream&&setTimeout(E.bind(this,k.clone(),W),0),k}catch(W){return q.apply(this,arguments)}if(!i&&!h)return q.apply(this,arguments);try{const k=await q.apply(this,arguments);return k.body instanceof ReadableStream&&setTimeout(R.bind(this,O,X,W,k.clone(),y,h),0),k}catch(W){return q.apply(this,arguments)}}catch(W){return q.apply(this,arguments)}}}},E=async(W,q)=>{try{const k=await W.json(),u=D(q.SUBSCRIPTION_DATA_QUERY||[],k);s=!!Array.isArray(u)&&!!u.includes(q.SUBSCRIPTION_ID)}catch(W){s=!1}},R=async(W,q,k,u,O,p)=>{const b=u.headers.get("Content-Type")||"",{body:s}=W;let y,E;try{s&&b.includes("text/event-stream")&&(p||(y=i(s,q,k.SEND_MESSAGE||{})),E=await h(u,O,k.RECEIVED_MESSAGE||{}))}catch(W){}finally{X(y,E,k,O)}},i=(W,q,k)=>{const{MESSAGE_LIMIT:u=1e4,CONTENT_QUERY:O=[]}=k;if(!W)return null;try{const k=JSON.parse(W),p=D(O,k);return p?Q(p,u,q):null}catch(W){return null}},h=async(W,q,k)=>{const{MESSAGE_LIMIT:u=3e4,LINE_START_QUERY:O="",CONTENT_TYPE:p,TEXT_PART_QUERY:b=[]}=k,s=W.body.getReader(),y=new TextDecoder("utf-8");let E="",R="";try{for(;;){const{done:W,value:q}=await s.read();if(W)break;E+=y.decode(q,{stream:!0});const k=E.split("\n");E=k.pop();for(let W of k)if(W.startsWith(O))try{const q=JSON.parse(W.slice(O.length));q.type===p&&"string"==typeof D(b,q)&&(R+=D(b,q))}catch(W){}}return R?Q(R,u,null,"system"):null}catch(W){}},Q=function(W,q,k,u="user"){return{messageType:u,messageLength:W.length,messageText:W.trim().slice(0,q),creationTime:k}},X=function(W,q,k,u){const p=u.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi),b=p?.[1],y={chatbotName:O,messages:[],sessionId:b,subscription:s,chatModel:n()};W&&y.messages.push(W),q&&y.messages.push(q),y.messages.length&&setTimeout((()=>_(y)),0)},n=()=>{const W=document.querySelector(p)?.textContent.trim();return W?b+W:""},D=(W,q)=>W.reduce(((W,q)=>W?"object"==typeof W?W[q]:W:null),q),_=W=>{try{let k={posdMessageId:"PANELOS_MESSAGE",posdHash:(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22),type:"CLAUDE_DATA",from:q,to:q.substring(0,q.length-2),content:W};window.postMessage(k)}catch(W){}};for(let W of u)W.USE&&y[W.TYPE](W)})();