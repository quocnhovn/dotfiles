adguard.ui=function(l){const c=l.i18n.getMessage("name"),i={context_block_site_ads:function(){T()},context_block_site_element:function(){T(!0)},context_security_report:function(){l.tabs.getActive(e=>{b(e.url)})},context_complaint_website:function(){l.tabs.getActive(e=>{f(e.url)})},context_site_filtering_on:function(){l.tabs.getActive(h)},context_enable_protection:function(){x(!1)},context_disable_protection:function(){x(!0)},context_open_settings:function(){t()},context_general_settings:function(){t("general-settings")},context_antibanner:function(){t("antibanner")},context_safebrowsing:function(){t("safebrowsing")},context_whitelist:function(){t("whitelist")},context_userfilter:function(){t("userfilter")},context_miscellaneous_settings:function(){t("miscellaneous-settings")},statistics:function(){t("statistics")},context_open_log:function(){m()},context_update_antibanner_filters:function(){E()}},e=function(){let e="chrome";return l.utils.browser.isOperaBrowser()?e="opera":l.utils.browser.isFirefoxBrowser()?e="firefox":l.utils.browser.isEdgeChromiumBrowser()&&(e="edge"),`https://adguard.com/forward.html?action=${e+"_store"}&from=options_screen&app=browser_extension`}();function o(t,e){let n,o,i="#fc5535";if(t.tabId!==l.BACKGROUND_TAB_ID)try{if(e)n=e.icon,o=e.badge;else{let e;var s;const a=l.frames.getFrameInfo(t);s=a.applicationFilteringDisabled||a.documentWhiteListed,e=!s&&l.settings.showPageStatistic()?a.totalBlockedTab.toString():"0",n=l.prefs.ICONS.ICON_GREEN,o=l.utils.workaround.getBlockedCountText(e);var r=l.notifications.getCurrentNotification();r&&(o=r.badgeText||o,i=r.badgeBgColor||i,r.icons&&(n=r.icons.ICON_GREEN))}l.browserAction.setBrowserAction(t,n,o,i,c)}catch(e){l.console.error("Error while updating icon for tab {0}: {1}",t.tabId,new Error(e))}}const s=l.utils.concurrent.debounce(e=>{o(e)},250);const r=l.utils.concurrent.debounce(e=>{e=e,(e=l.frames.getFrameInfo(e))&&l.runtimeImpl.sendMessage({type:"updateTotalBlocked",tabInfo:e})},250);function a(e,t){const n={contexts:["all"],title:l.i18n.getMessage(e)};t&&(t.id&&(n.id=t.id),t.parentId&&(n.parentId=t.parentId),t.disabled&&(n.enabled=!1),t.messageArgs&&(n.title=l.i18n.getMessage(e,t.messageArgs)),t.contexts&&(n.contexts=t.contexts),"checkable"in t&&(n.checkable=t.checkable),"checked"in t&&(n.checked=t.checked));let o;o=t&&t.action?i[t.action]:i[e],"function"==typeof o&&(n.onclick=o),l.contextMenus.create(n)}function n(e){var t;function n(){l.contextMenus.create({type:"separator"})}l.contextMenus&&(l.contextMenus.removeAll(),l.settings.showContextMenu()&&(l.prefs.mobile?(t=e,(t=l.frames.getFrameInfo(t)).applicationFilteringDisabled?(a("popup_site_protection_disabled_android",{action:"context_enable_protection",checked:!0,checkable:!0}),a("popup_open_log_android",{action:"context_open_log"}),a("popup_open_settings",{action:"context_open_settings"})):(t.urlFilteringDisabled?(a("context_site_filtering_disabled"),a("popup_open_log_android",{action:"context_open_log"})):(a("popup_site_protection_disabled_android",{action:"context_disable_protection",checked:!1,checkable:!0}),t.documentWhiteListed&&!t.userWhiteListed?a("popup_in_white_list_android"):t.canAddRemoveRule&&(t.documentWhiteListed?a("popup_site_filtering_state",{action:"context_site_filtering_on",checkable:!0,checked:!1}):a("popup_site_filtering_state",{action:"context_site_filtering_off",checkable:!0,checked:!0})),t.documentWhiteListed||a("popup_block_site_ads_android",{action:"context_block_site_ads"}),a("popup_open_log_android",{action:"context_open_log"}),a("popup_security_report_android",{action:"context_security_report"})),a("popup_open_settings",{action:"context_open_settings"}),a("context_update_antibanner_filters"))):(e=e,(e=l.frames.getFrameInfo(e)).applicationFilteringDisabled?(a("context_site_protection_disabled"),n(),a("context_open_log"),a("context_open_settings"),a("context_enable_protection")):e.urlFilteringDisabled?(a("context_site_filtering_disabled"),n(),a("context_open_log"),a("context_open_settings"),a("context_update_antibanner_filters")):(e.documentWhiteListed&&!e.userWhiteListed?a("context_site_exception"):e.canAddRemoveRule&&(e.documentWhiteListed?a("context_site_filtering_on"):a("context_site_filtering_off")),n(),e.documentWhiteListed||(a("context_block_site_ads"),a("context_block_site_element",{contexts:["image","video","audio"]})),a("context_security_report"),a("context_complaint_website"),n(),a("context_update_antibanner_filters"),n(),a("context_open_settings"),a("context_open_log"),a("context_disable_protection"))),"function"==typeof l.contextMenus.render&&l.contextMenus.render()))}function _(e){return l.getURL("pages/"+e)}const p=e=>{e=e.url;const t=new URL(e);e=l.app.getUrlScheme();return-1<t.protocol.indexOf(e)};function d(t,n){l.tabs.getActive(e=>{l.tabs.sendMessage(e.tabId,{type:"show-alert-popup",isAdguardTab:p(e),title:t,text:n})})}function u(o,i){var s=l.notifications.getCurrentNotification();if(s||l.utils.browser.getMajorVersionNumber(o)!=l.utils.browser.getMajorVersionNumber(i)||l.utils.browser.getMinorVersionNumber(o)!=l.utils.browser.getMinorVersionNumber(i)){let e=l.i18n.getMessage("options_popup_version_update_offer"),t="https://adguard.com/forward.html?action=learn_about_adguard&from=version_popup&app=browser_extension",n=l.i18n.getMessage("options_popup_version_update_offer_button_text");s&&(e=s.text.updateTitle,n=s.text.updateBtn,t=s.url+"&from=version_popup");const r={type:"show-version-updated-popup",title:l.i18n.getMessage("options_popup_version_update_title",o),description:(o=o,i=i,l.utils.browser.getMajorVersionNumber(o)>l.utils.browser.getMajorVersionNumber(i)||l.utils.browser.getMinorVersionNumber(o)>l.utils.browser.getMinorVersionNumber(i)?l.i18n.getMessage("options_popup_version_update_description_major"):l.i18n.getMessage("options_popup_version_update_description_minor")),changelogHref:"https://adguard.com/forward.html?action=github_version_popup&from=version_popup&app=browser_extension",changelogText:l.i18n.getMessage("options_popup_version_update_changelog_text"),showPromoNotification:!!s,offer:e,offerButtonHref:t,offerButtonText:n,disableNotificationText:l.i18n.getMessage("options_popup_version_update_disable_notification")};l.tabs.getActive(e=>{r.isAdguardTab=p(e),l.tabs.sendMessage(e.tabId,r)})}}function g(e,t){t&&l.frames.reloadFrameData(e),o(e),n(e)}var t=function(e,t={}){e&&(t.anchor=e);t={activateSameTab:!0,hashParameters:t};A(_("options.html"),t)},b=function(e){e=l.utils.url.toPunyCode(l.utils.url.getDomainName(e));e&&A(`https://adguard.com/site.html?domain=${encodeURIComponent(e)}&utm_source=extension&aid=16593`)};const f=function(e){let t,n;["Chrome","Firefox","Opera","Safari","IE","Edge"].includes(l.prefs.browser)?t=l.prefs.browser:(t="Other",n=l.prefs.browser);const o=l.filters.getEnabledFiltersFromEnabledGroups().map(e=>e.filterId);A(`https://reports.adguard.com/new_issue.html?product_type=Ext&product_version=${encodeURIComponent(l.app.getVersion())}&browser=${encodeURIComponent(t)}${n?"&browser_detail="+encodeURIComponent(n):""}&url=${encodeURIComponent(e)}&filters=`+encodeURIComponent(o.join("."))+(()=>{const e=[{queryKey:"ext_hide_referrer",settingKey:l.settings.HIDE_REFERRER},{queryKey:"hide_search_queries",settingKey:l.settings.HIDE_SEARCH_QUERIES},{queryKey:"DNT",settingKey:l.settings.SEND_DO_NOT_TRACK},{queryKey:"x_client",settingKey:l.settings.BLOCK_CHROME_CLIENT_DATA},{queryKey:"webrtc",settingKey:l.settings.BLOCK_WEBRTC},{queryKey:"third_party_cookies",settingKey:l.settings.SELF_DESTRUCT_THIRD_PARTY_COOKIES,settingValueKey:l.settings.SELF_DESTRUCT_THIRD_PARTY_COOKIES_TIME},{queryKey:"first_party_cookies",settingKey:l.settings.SELF_DESTRUCT_FIRST_PARTY_COOKIES,settingValueKey:l.settings.SELF_DESTRUCT_FIRST_PARTY_COOKIES_TIME}];var t=!l.settings.getProperty(l.settings.DISABLE_STEALTH_MODE);return t?`&stealth.enabled=${t}&`+e.map(e=>{var{queryKey:t,settingKey:n,settingValueKey:e}=e,n=l.settings.getProperty(n);let o;return n?(o=e?l.settings.getProperty(e):n,`stealth.${t}=`+encodeURIComponent(o)):""}).filter(e=>0<e.length).join("&"):"&stealth.enabled="+t})())};var m=function(e){const t={activateSameTab:!0,type:"popup"};e?A(_("log.html")+(e?"#"+e:""),t):l.tabs.getActive(e=>{e=e.tabId;A(_("log.html")+(e?"#"+e:""),t)})},h=function(e){var t=l.frames.getFrameInfo(e);l.userrules.unWhiteListFrame(t),g(e,!0),l.tabs.reload(e.tabId)},x=function(e){l.settings.changeFilteringDisabled(e),l.tabs.getActive(e=>{g(e,!0),l.tabs.reload(e.tabId)})};function I(e){const t={addRuleCallbackName:"addUserRule",selectElement:e};l.tabs.getActive(e=>{l.tabs.sendMessage(e.tabId,{type:"initAssistant",options:t})})}const E=(e,t=!0)=>{const n=l.listeners.UPDATE_FILTERS_SHOW_POPUP;var o=t?e=>{l.listeners.notifyListeners(n,!0,e),l.listeners.notifyListeners(l.listeners.FILTERS_UPDATE_CHECK_READY)}:e=>{e&&0<e.length&&(e=e.map(e=>"Filter ID: "+e.filterId).join(", "),l.console.info("Filters were auto updated: "+e))},t=t?()=>{l.listeners.notifyListeners(n,!1),l.listeners.notifyListeners(l.listeners.FILTERS_UPDATE_CHECK_READY)}:()=>{};e?l.filters.checkFiltersUpdates(o,t,e):l.filters.checkFiltersUpdates(o,t)},T=e=>{l.tabs.executeScriptFile?l.tabs.executeScriptFile(null,{file:"/lib/content-script/assistant/js/assistant.js"},()=>{I(e)}):I(e)};var A=function(o,e={},i){const{activateSameTab:s,inBackground:r,inNewWindow:a,type:c,hashParameters:t}=e;o=((e,t)=>{if(!t)return e;if(-1<e.indexOf("#"))return l.console.warn(`Hash parameters can't be applied to the url with hash: '${e}'`),e;let n;var o=t["anchor"];o&&delete t[o];var i=Object.keys(t).map(e=>e+"="+t[e]).join("&");return i.length<=0?(n=o&&0<o.length?"#"+o:"",e+n):(n=o&&0<o.length?`replacement=${o}&`+i:i,n=encodeURIComponent(n),e+"#"+n)})(o,t),o=l.utils.strings.contains(o,"://")?o:l.getURL(o),l.tabs.getAll(t=>{if(s)for(let e=0;e<t.length;e+=1){var n=t[e];if(l.utils.url.urlEquals(n.url,o))return(n=n).url!==o&&l.tabs.reload(n.tabId,o),r||l.tabs.activate(n.tabId),void(i&&i(n))}l.tabs.create({url:o,type:c||"normal",active:!r,inNewWindow:a},i)})};return l.listeners.addListener((e,t,n,o)=>{if(e===l.listeners.ADS_BLOCKED&&n){let e=l.pageStats.ADBLOCK_PROTOTYPE_NAME;t.filterId&&t.filterId===l.uos.getAppeptableAdsFilterId()&&(e=l.pageStats.PRIVATE_PROTOTYPE_NAME),t.filterId==l.pageStats.NSFW_PROTOTYPE_NAME&&(e=l.pageStats.NSFW_PROTOTYPE_NAME),l.pageStats.updateStats(e,o,new Date),null!==l.frames.updateBlockedAdsCount(n,o,e)&&(s(n),l.tabs.getActive(e=>{n.tabId===e.tabId&&r(e)}))}}),l.settings.onUpdated.addListener(e=>{e===l.settings.DISABLE_SHOW_CONTEXT_MENU&&l.tabs.getActive(e=>{n(e)})}),l.listeners.addListener(e=>{e===l.listeners.APPLICATION_INITIALIZED&&l.tabs.getActive(g)}),l.listeners.addListener((e,t)=>{e===l.listeners.APPLICATION_UPDATED&&l.settings.isShowAppUpdatedNotification()&&u(t.currentVersion,t.prevVersion)}),l.listeners.addListener((e,t)=>{switch(e){case l.listeners.FILTER_ENABLE_DISABLE:t.enabled&&E([t],!1);break;case l.listeners.FILTER_GROUP_ENABLE_DISABLE:var n;t.enabled&&t.filters&&(n=t.filters.filter(e=>e.enabled),E(n,!1))}}),l.listeners.addListener((e,t,n)=>{e===l.listeners.UPDATE_FILTERS_SHOW_POPUP&&d((n=function(e,t){let n="",o="";return e?0===t.length?(n="",o=l.i18n.getMessage("options_popup_update_not_found")):(n="",o=t.sort((e,t)=>e.groupId===t.groupId?e.displayNumber-t.displayNumber:e.groupId===t.groupId).map(e=>`"${e.name}"`).join(", "),1<t.length?o+=" "+l.i18n.getMessage("options_popup_update_filters"):o+=" "+l.i18n.getMessage("options_popup_update_filter")):(n=l.i18n.getMessage("options_popup_update_title_error"),o=l.i18n.getMessage("options_popup_update_error")),{title:n,text:o}}(t,n)).title,n.text)}),l.unload.when(function(){l.tabs.forEach(e=>{0<=e.url.indexOf(l.getURL(""))&&l.tabs.remove(e.tabId)})}),{init:()=>{l.listeners.addListener((e,t,n)=>{if(e===l.listeners.UPDATE_TAB_BUTTON_STATE&&t){let e;n&&(e={icon:l.prefs.ICONS.ICON_GREEN,badge:""}),o(t,e)}}),l.tabs.onUpdated.addListener(e=>{const t=e["tabId"];o(e),l.tabs.getActive(e=>{e.tabId===t&&n(e)})}),l.tabs.onActivated.addListener(e=>{g(e,!0)})},openExportRulesTab:function(e){A(_("export.html#"+e))},openSettingsTab:t,openSiteReportTab:b,openFilteringLog:m,openThankYouPage:function(){const e=l.utils.browser.getExtensionParams();e.push("_locale="+encodeURIComponent(l.app.getLocale()));const o="https://welcome.adguard.com/v2/thankyou.html?"+e.join("&"),i=_("filter-download.html");l.tabs.getAll(t=>{for(let e=0;e<t.length;e++){var n=t[e];if(n.url===i)return l.utils.browser.isYaBrowser()||l.tabs.activate(n.tabId),void l.tabs.reload(n.tabId,o)}A(o)})},openExtensionStore:function(){A(e)},openFiltersDownloadPage:function(){A(_("filter-download.html"),{inBackground:l.utils.browser.isYaBrowser()})},openAbuseTab:f,updateTabIconAndContextMenu:g,whiteListTab:function(e){var t=l.frames.getFrameInfo(e);l.whitelist.whiteListUrl(t.url),g(e,!0),l.tabs.reload(e.tabId)},unWhiteListTab:h,changeApplicationFilteringDisabled:x,checkFiltersUpdates:E,openAssistant:T,openTab:A,showAlertMessagePopup:d}}(adguard);