const DisablePageShow=function(){window.stop();var e=chrome.extension.getURL("./pages/images/banner.png"),t=chrome.extension.getURL("./pages/images/banner@2x.png");document.documentElement.innerHTML=`<!DOCTYPE html>
    <head>
    <title>禁止访问</title>
    <style>
    html,body{
        width:100% !important; 
        height:100% !important;
        font-size:14px !important; 
        background:#fff !important;
    }
    </style>
    </head>
    <body>
    <div style="display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;">
        <div style="display:flex;flex-direction: column;justify-content:center;align-items:center;min-width:1024px;">
            <div><img src="${e}" srcset="${t} 2x" width=650/></div>
            <div>
                <h1>网站已被限制访问，无法打开</h1>
            </div>
        </div>
    </div></body></html>
    `,document.getElementsByTagName("head")[0].innerHTML="",document.title="禁止访问",document.documentElement.scrollTop=0,document.documentElement.style.overflow="hidden"};moment.updateLocale("zh-cn",{longDateFormat:{LLL:"YYYY年M月D日 HH:mm"}}),moment.suppressDeprecationWarnings=!0;const CHART_STORE={},DATERANGE={day:Symbol("day"),week:Symbol("week"),month:Symbol("month")};Object.defineProperty(CHART_STORE,"_range_type",{writable:!0,value:DATERANGE.day}),Object.defineProperty(CHART_STORE,"_x_type",{writable:!0,value:{nsfw:!0,adblock:!0,private:!0}}),Object.defineProperty(CHART_STORE,"_columns",{writable:!0}),Object.defineProperty(CHART_STORE,"_date_range",{writable:!0,value:{startDate:moment().add(-6,"days").format("YYYY-M-D"),endDate:moment().format("YYYY-M-D")}}),Object.defineProperty(CHART_STORE,"range_type",{enumerable:!0,set(e){Object.values(DATERANGE).includes(e)&&(this._range_type=e),_renderStatsGraphs()},get(){return this._range_type}}),Object.defineProperty(CHART_STORE,"date_range",{enumerable:!0,set(e){this._date_range=e,_renderStatsGraphs()},get(){return this._date_range}}),Object.defineProperty(CHART_STORE,"stats",{enumerable:!0,set(e){this._columns=e,_renderStatsGraphs()},get(){let n=[],s=["x"],i=Object.create(null);for(const o in this._x_type)if(!0===this._x_type[o]){i=Object.create(null);let{startDate:e,endDate:t}=this._date_range;for(;0<=_getMoment(t).diff(_getMoment(e));){var r=this._columns[o]&&this._columns[o][e]||0;i[e]=r,e=_getMoment(e).add(1,"days").format("YYYY-M-D")}switch(this._range_type){case DATERANGE.day:i=_getStatesByDateRange(i,function(e){return(e=_getMoment(e)).format("YYYY-M-D")});break;case DATERANGE.week:i=_getStatesByDateRange(i,function(e){return(e=_getMoment(e)).format("gggg-ww")});break;case DATERANGE.month:i=_getStatesByDateRange(i,function(e){return(e=_getMoment(e)).format("YYYY-M")})}n.push([o,...Object.values(i)])}var a=Object.keys(i);for(let e=0,t=a.length;e<t;e++)switch(this._range_type){case DATERANGE.day:s.push(a[e]);break;case DATERANGE.week:s.push(moment(a[e],"gggg-ww").format("YYYY-M-D"));break;case DATERANGE.month:s.push(moment(a[e],"YYYY-M").format("YYYY-M-D"))}return n.push(s),n}});const _getStatesByDateRange=(n,s)=>{var i=Object.keys(n);if(i.length<=0)return{};let r={};for(let e=0,t=i.length;e<t;e++){var a=n[o=i[e]]||0,o=s(o);r[o]=r[o]?r[o]+a:a}return r},_getMoment=e=>e instanceof moment?e:moment(e);contentPage.sendMessage({type:"getStatisticsData"},e=>{e=e.stats;CHART_STORE.stats=e});const _renderStatsGraphs=()=>{document||_renderStatsGraphs.timeoutID||(_renderStatsGraphs.timeoutID=setTimeout(_renderStatsGraphs,1e3)),_renderStatsGraphs.timeoutID=null,c3.generate({bindto:"#charts",size:{height:250,width:830},padding:{right:15},data:{x:"x",columns:CHART_STORE.stats,colors:{nsfw:"#0483ff",adblock:"#e94087",private:"#00AC8D"},names:{nsfw:"内容拦截",private:"隐私拦截",adblock:"广告拦截"}},grid:{y:{show:!0}},axis:{x:{type:"timeseries",tick:{multiline:!0,format:function(e){return`${e.getFullYear()}-${e.getMonth()+1}-`+e.getDate()}}},y:{min:0,tick:{format:function(e){return e<0?"":e}}}}})},Utils={debounce(n,s){let i;return function(){const e=this,t=arguments;clearTimeout(i),i=setTimeout(function(){i=null,n.apply(e,t)},s)}},escapeRegExp:function(){const t=/[|\\{}()[\]^$+*?.]/g;return function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(t,"\\$&")}}(),importFromFileIntoEditor:function(i){return function(e){const s=e.target,t=new FileReader;t.onload=function(e){const t=(i.getValue()+`
`+e.target.result).split("\n");e=t.map(e=>e.trim()),e=new Set(e);const n=Array.from(e).join("\n");i.setValue(n.trim()),s.value=""},t.onerror=function(e){throw new Error(i18n.getMessage("options_popup_import_rules_unknown_error")+" "+e.message)};e=s.files[0];if(e){if("text/plain"!==e.type)throw new Error(i18n.getMessage("options_popup_import_rules_wrong_file_extension"));t.readAsText(e,"utf-8")}}},getExtension:function(e){if(e){e=e.split(".");if(!(e.length<2))return e[e.length-1]}},handleImportSettings(e){e=e.currentTarget.files[0];if(e){if("json"!==this.getExtension(e.name))throw new Error(i18n.getMessage("options_popup_import_settings_wrong_file_extension"));const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){e=e.target.result,contentPage.sendMessage({type:"applySettingsJson",json:e})},t.onerror=function(){throw new Error(i18n.getMessage("options_popup_import_error_file_description"))}}},hoursToMs(e){return 60*e*60*1e3},showPopup(e,t){contentPage.sendMessage({type:"showAlertMessagePopup",title:e,text:t})},escapeDoubleQuotes(e){return e.replace(/"/g,"&quot;")}};var RANGETYPEBTN;const TopMenu=function(){"use strict";const s="#general-settings",i="#antibanner",r="#whitelist",a="#blacklist",o="#statistics";let l,c;function t(){let t=document.location.hash||s,n;try{n=document.querySelector(t)}catch(e){t=s,n=document.querySelector(s)}if(0!==t.indexOf(i)||n){n||(t=s,n=document.querySelector(t));const e=[].slice.call(document.querySelectorAll(`[data-tab="${i}"]`));if(l){0===l.indexOf(i)?e.forEach(e=>{e.classList.remove("active")}):document.querySelector(`[data-tab="${l}"]`).classList.remove("active");try{document.querySelector(l).style.display="none"}catch(e){return}}0===t.indexOf(i)?e.forEach(e=>{e.classList.add("active")}):document.querySelector(`[data-tab="${t}"]`).classList.add("active"),n.style.display="block",t===r&&("function"==typeof c&&c(t),contentPage.sendMessage({type:"getWhiteListBtnStatus"},e=>{if("true"!=e.status){let e=document.querySelector(".numsBox");e.children[0].classList.add("select")}})),t===a&&contentPage.sendMessage({type:"getBlackListBtnStatus"},e=>{if("true"!=e.status){let e=document.querySelector(".numsBlackBox");e.children[0].classList.add("select")}}),t===o&&$('input[name="daterange"]').daterangepicker({autoUpdateInput:!1,maxDate:moment().format("YYYY-MM-DD"),locale:{cancelLabel:"取消",applyLabel:"确定"}}).on("apply.daterangepicker",function(e,t){var n=t.startDate.format("YYYY-MM-DD"),t=t.endDate.format("YYYY-MM-DD");$(this).val(n+" - "+t),CHART_STORE.date_range={startDate:n,endDate:t}}),t,s,window.scrollTo(0,0),l=t}}return{init:function(e){c=e.onHashUpdated,window.addEventListener("hashchange",t),[].slice.call(document.querySelectorAll("[data-tab]")).forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),document.location.hash=t.getAttribute("data-tab")})}),t()},toggleTab:t,_renderStatsGraphs:_renderStatsGraphs,_renderOptionsBtnChange:e=>{"whiteList"==e.type?contentPage.sendMessage({type:"changeWhiteListFilter"}):"blackList"==e.type&&contentPage.sendMessage({type:"changeBlackListFilter"})}}}(),Saver=function(e){this.indicatorElement=e.indicatorElement,this.editor=e.editor,this.saveEventType=e.saveEventType;const s={CLEAR:1,DIRTY:2,SAVING:4,SAVED:8},t={[s.CLEAR]:"",[s.DIRTY]:i18n.getMessage("options_editor_indicator_editing"),[s.SAVING]:i18n.getMessage("options_editor_indicator_saving"),[s.SAVED]:i18n.getMessage("options_editor_indicator_saved")};this.isSaving=function(){return(this.currentState&s.SAVING)===s.SAVING},this.isDirty=function(){return(this.currentState&s.DIRTY)===s.DIRTY},this.isSaved=function(){return(this.currentState&s.SAVED)===s.SAVED},this.updateIndicator=function(e){switch(this.indicatorElement.textContent=t[e],e){case s.DIRTY:case s.CLEAR:case s.SAVING:this.indicatorElement.classList.remove("filter-rules__label--saved");break;case s.SAVED:this.indicatorElement.classList.add("filter-rules__label--saved")}};let i;const r=(e,t=!1)=>{switch(e){case s.DIRTY:this.currentState&=~s.CLEAR;break;case s.CLEAR:this.currentState&=~s.DIRTY,this.currentState&=~s.SAVED;break;case s.SAVING:this.currentState&=~s.SAVED;break;case s.SAVED:if((this.currentState&s.SAVING)!==s.SAVING)return;this.currentState&=~s.SAVING}this.currentState|=e,t||this.manageState()};this.manageState=function(){i&&clearTimeout(i);const e=this;var t=this.isDirty(),n=this.isSaving();return t&&!n?(this.updateIndicator(s.DIRTY),void(i=setTimeout(()=>{e.saveRules(),r(s.CLEAR,!0),r(s.SAVING)},1e3))):t&&n?(this.updateIndicator(s.SAVING),void(i=setTimeout(()=>{r(s.CLEAR),e.saveRules()},1e3))):t||n?void(!t&&n&&this.updateIndicator(s.SAVING)):(this.updateIndicator(s.SAVED),this.isSaved()?void(i=setTimeout(()=>{r(s.CLEAR),e.updateIndicator(s.CLEAR)},1500)):void 0)},this.saveRules=function(){var e=this.editor.getValue();contentPage.sendMessage({type:this.saveEventType,content:e},()=>{})};let n;return{canUpdate:()=>!(this.isSaved()||this.isSaving()||this.isDirty()),setDirty:()=>{r(s.DIRTY)},setSaved:()=>{r(s.SAVED)},doSave:()=>{n||(this.indicatorElement.innerHTML=t[s.SAVING],this.saveRules(),n=setTimeout(()=>{this.indicatorElement.innerHTML="保&nbsp;存",Utils.showPopup("保存成功"),n=null},1e3))}}},handleEditorResize=(e,n)=>{const s=e.container.parentNode;var t,i,r;t=s,(r=localStorage.getItem(n))&&(i=JSON.parse(r)["size"],{width:r,height:i}=i||{},r&&i&&(t.style.width=r,t.style.height=i));const a=Utils.debounce(()=>{e.resize()},100),o=()=>{var e,t;e=s,t=e.style.width,e=e.style.height,t&&e&&localStorage.setItem(n,JSON.stringify({size:{width:t,height:e}})),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",o)};s.addEventListener("mousedown",e=>{e.target===e.currentTarget&&(document.addEventListener("mousemove",a),document.addEventListener("mouseup",o))})},WhiteListFilter=function(e){"use strict";var t="whiteListRules";const n=ace.edit(t);handleEditorResize(n,t),n.setShowPrintMargin(!1),n.container.style.lineHeight="24px",n.setHighlightActiveLine(!1),n.setHighlightGutterLine(!1),n.$blockScrolling=1/0;const s=ace.require("ace/mode/adguard").Mode;n.session.setMode(new s);t=document.querySelector(".btn-whiteList-save");const i=new Saver({editor:n,saveEventType:"saveWhiteListDomains",indicatorElement:t}),r=document.querySelector("#importWhiteListInput"),a=document.querySelector("#whiteListFiltersImport"),o=document.querySelector("#whiteListFiltersExport");t=document.querySelector("#changeDefaultWhiteListMode");const l=document.querySelector(".btn-whiteList-save");return l.addEventListener("click",e=>{i.doSave()}),a.addEventListener("click",e=>{e.preventDefault(),r.click()}),o.addEventListener("click",e=>{e.preventDefault();o.classList.contains("disabled")||contentPage.sendMessage({type:"openExportRulesTab",hash:"wl"})}),r.addEventListener("change",e=>{const t=Utils.importFromFileIntoEditor(n);try{t(e)}catch(e){Utils.showPopup(i18n.getMessage("options_popup_import_rules_error_title"),e.message)}}),CheckboxUtils.updateCheckbox([t],!e.defaultWhiteListMode),{updateWhiteListDomains:function(){i.canUpdate()&&contentPage.sendMessage({type:"getWhiteListDomains"},e=>{n.setValue(e.content?e.content.join("\r\n"):"",1)}),i.setSaved()}}},blackListFilter=function(){"use strict";var e="blackListRules";const t=ace.edit(e);handleEditorResize(t,e),t.setShowPrintMargin(!1),t.container.style.lineHeight="24px",t.setHighlightActiveLine(!1),t.setHighlightGutterLine(!1),t.$blockScrolling=1/0;const n=ace.require("ace/mode/adguard").Mode;t.session.setMode(new n);const s=document.querySelector(".btn-blackList-save"),i=new Saver({editor:t,saveEventType:"saveBlackListDomains",indicatorElement:s});s.addEventListener("click",e=>{i.doSave()}),contentPage.sendMessage({type:"getBlackListDomains"},e=>{t.setValue(e.content?e.content.join("\r\n"):"",1)})},UserFilter=function(){"use strict";var e="userRules";const n=ace.edit(e);n.setShowPrintMargin(!1),handleEditorResize(n,e),n.$blockScrolling=1/0;const t=ace.require("ace/mode/adguard").Mode;n.session.setMode(new t);e=document.querySelector("#userRulesSaveIndicator");const s=new Saver({editor:n,saveEventType:"saveUserRules",indicatorElement:e});let i=!1;let r;const a=n.getSession();let o=!1;a.addEventListener("change",()=>{o||!i?s.setDirty():o=!0});const l=document.querySelector("#importUserFilterInput"),c=document.querySelector("#userFiltersImport"),d=document.querySelector("#userFiltersExport");return a.addEventListener("change",()=>{0<a.getValue().length?d.classList.remove("disabled"):d.classList.add("disabled")}),c.addEventListener("click",e=>{e.preventDefault(),l.click()}),l.addEventListener("change",e=>{const t=Utils.importFromFileIntoEditor(n);try{t(e)}catch(e){Utils.showPopup(i18n.getMessage("options_popup_import_rules_error_title"),e.message)}}),d.addEventListener("click",e=>{e.preventDefault();d.classList.contains("disabled")||contentPage.sendMessage({type:"openExportRulesTab",hash:"uf"})}),{updateUserFilterRules:function e(){r&&clearTimeout(r),s.canUpdate()?contentPage.sendMessage({type:"getUserRules"},e=>{i=!!e.content,n.getValue()!==e.content&&n.setValue(e.content||"")}):r=setTimeout(()=>{e()},200),s.setSaved()}}},AntiBannerFilters=function(e){"use strict";const o={filters:[],categories:[],filtersById:{},categoriesById:{},lastUpdateTime:0,initLoadedFilters(e,t){this.filters=e,this.categories=t;const n=Object.create(null);for(let e=0;e<this.categories.length;e+=1){var s=this.categories[e];n[s.groupId]=s}this.categoriesById=n;let i=this.lastUpdateTime||0;const r=Object.create(null);for(let e=0;e<this.filters.length;e++){var a=this.filters[e];(r[a.filterId]=a).lastUpdateTime&&a.lastUpdateTime>i&&(i=a.lastUpdateTime)}this.filtersById=r,this.lastUpdateTime=i},isEnabled(e){e=this.filtersById[e];return e&&e.enabled},isCategoryEnabled(e){e=this.categoriesById[e];return e&&e.enabled},updateCategoryEnabled(e,t){const n=this.categoriesById[e.groupId];n?n.enabled=t:(this.categories.push(e),this.categoriesById[e.groupId]=e)},updateEnabled(e,t){const n=this.filtersById[e.filterId];n?n.enabled=t:(this.filters.push(e),this.filtersById[e.filterId]=e)}};function a(e){return document.querySelector("#category"+e)}function i(e){return[].slice.call(document.querySelectorAll("#filter"+e))}function r(e){var t,n=(t=e,o.filters.filter(e=>e.groupId===t)),s=function(e){const t=e.filter(e=>e.enabled).map(e=>e.name&&0<e.name.length?e.name:e.subscriptionUrl);let n;if(3<(e=t.length)){var s=t.slice(0,3).join(", ");n=i18n.getMessage("options_filters_enabled_and_more_divider",[s,(e-3).toString()])}else if(1<e){s=t.slice(e-1)[0];const i=t.slice(0,e-1);n=i18n.getMessage("options_filters_enabled_and_divider",[i.join(", "),s])}else 1===e&&(n=t[0]);return n=0<e?i18n.getMessage("options_filters_enabled")+" "+n:i18n.getMessage("options_filters_no_enabled"),n}(n),i=n.length;const r=a(e);n=function(e){const t=a(e);return t?t.querySelector("input"):null}(e);0<i&&(r.querySelector(".desc").textContent=s);e=o.isCategoryEnabled(e);CheckboxUtils.updateCheckbox([n],e)}function s(e){return`
            <div class="page-title">
                <a href="#antibanner">
                    <img src="images/arrow-left.svg" class="back">
                </a>
                ${e}
            </div>`}function l(e){var t=e["filters"];const n=0===e.groupId;if(n&&0===t.length)return htmlToElement(`
            <div id="antibanner${e.groupId}" class="settings-content tab-pane filters-list">
                ${s(e.groupName)}
                <div class="settings-body">
                    <div class="empty-filters">
                        <div class="empty-filters__logo"></div>
                        <div class="empty-filters__desc">
                            ${i18n.getMessage("options_empty_custom_filter")}
                        </div>
                        <button class="button button--green empty-filters__btn">
                            ${i18n.getMessage("options_add_custom_filter")}
                        </button>
                    </div>
                </div>
            </div>`);return htmlToElement(`<div id="antibanner${e.groupId}" class="settings-content tab-pane filters-list ${n?"filters-list--custom":""}">
                ${s(e.groupName)}
                <div class="settings-body">
                    ${E}
                    <ul class="opts-list opts-list--filters">
                    </ul>
                </div>
                ${n?`<div class="settings-actions">
                            <a
                                href="#"
                                class="add-custom-filter-button button button--green button--link"
                            >
                                ${i18n.getMessage("options_add_custom_filter")}
                            </a>
                        </div>`:""}
            </div>`)}function c(e){let t=document.querySelector("#antibanner"+e.groupId);t&&t.parentNode.removeChild(t);let n=document.querySelector("#category"+e.groupId);n&&n.parentNode.removeChild(n),n=htmlToElement(`
                <li id="category${e.groupId}" class="active">
                    <a href="#antibanner${e.groupId}" class="block-type">
                        <div class="block-type__ico block-type__ico--${e.groupId}"></div>
                        <div id="aria-category${e.groupId}" class="block-type__desc">
                            <div class="block-type__desc-title">${e.groupName}</div>
                            <div class="desc desc--filters"></div>
                        </div>
                    </a>
                    <div class="opt-state">
                        <div class="preloader"></div>
                        <div class="toggler-wr" role="checkbox" tabindex="0">
                        <input aria-labelledby="aria-category${e.groupId}" aria-hidden="false"
                         type="checkbox" name="groupId" value="${e.groupId}">
                        </div>
                    </div>
                </li>`),document.querySelector("#groupsList").appendChild(n),r(e.groupId),t=l(e),document.querySelector("#antibanner").parentNode.appendChild(t)}document.addEventListener("change",e=>{"filterId"===e.target.getAttribute("name")?function(){var e=+this.value;this.checked?contentPage.sendMessage({type:"addAndEnableFilter",filterId:e}):contentPage.sendMessage({type:"disableAntiBannerFilter",filterId:e})}.bind(e.target)():"groupId"===e.target.getAttribute("name")&&function(){var e=+this.value;this.checked?contentPage.sendMessage({type:"enableFiltersGroup",groupId:e}):contentPage.sendMessage({type:"disableFiltersGroup",groupId:e})}.bind(e.target)()}),document.querySelector("#updateAntiBannerFilters").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".settings-actions__update-button").classList.add("settings-actions__update-button--spinning"),contentPage.sendMessage({type:"checkAntiBannerFiltersUpdate"},()=>{D(Date.now())})}),window.addEventListener("hashchange",function(e){const t=document.querySelector(".mask-box");t.style.display="none";const n=/#antibanner(\d+)/g,s=n.exec(e.oldURL)||n.exec(e.newURL);if(s){var i=parseInt(s[1],10);if(i){const r=document.querySelector(`#antibanner${i} input[name="searchFiltersList"]`);if(r){const a=document.querySelector(`#antibanner${i} #filterStatusSelection`);r.value="",a.value=d.ALL;e={searchInputEl:r,displayOptionEl:a};f(i,o.filters,e)}}}}),k(e.rulesInfo);const d={ALL:"all",ENABLED:"enabled",DISABLED:"disabled"},u=(e,t)=>!!(t===d.ALL||e&&t===d.ENABLED||!e&&t===d.DISABLED),p=(e,t)=>{if(0===t.length)return!0;if("\\*"===t)return!0;const n=new RegExp(t,"gi");return n.test(e)},g=e=>{let t;try{t=Utils.escapeRegExp(e.trim())}catch(e){}return t},m=e=>[].slice.call(e.options).filter(e=>e.selected)[0].value;function h(e){if(e.preventDefault(),confirm(i18n.getMessage("options_delete_filter_confirm"))){e=e.currentTarget.getAttribute("filterId");contentPage.sendMessage({type:"removeAntiBannerFilter",filterId:e});const t=i(e);t.forEach(e=>{e.parentNode.removeChild(e)})}}const _=(t,e,n)=>{for(;t.firstChild;)t.removeChild(t.firstChild);const{searchInputEl:s,displayOptionEl:i}=n;n=(()=>{const t=g(s.value),n=m(i);return e=>void 0===t||void 0===n||p(e.name,t)&&u(e.enabled,n)})();const r=e.filter(n).sort((e,t)=>{let n=0;try{e.enabled!==t.enabled?n=e.enabled?-1:1:e.groupId!==t.groupId?n=e.groupId-t.groupId:e.displayNumber!==t.displayNumber?n=e.displayNumber-t.displayNumber:e.name&&t.name&&(n=e.name.toLowerCase()>t.name.toLowerCase()?1:-1)}catch(e){}return n});r.forEach(e=>{e=function(e,t,n){var s=A(e.lastUpdateTime||e.timeUpdated);let i="";e.tagsDetails.forEach(e=>{var t=e.description?`data-tooltip="${Utils.escapeDoubleQuotes(e.description)}"`:"";i+=`<div class="opt-name__tag" ${t}>#${e.keyword}</div>`}),e.trusted&&(i+=`<div class="opt-name__tag"
                                data-tooltip="${i18n.getMessage("options_filters_filter_trusted_tag_desc")}">
                                #${i18n.getMessage("options_filters_filter_trusted_tag")}
                           </div>`);var n=n?`<a href="#" filterid="${e.filterId}" class="remove-custom-filter-button"></a>`:"";return`<li id="filter${e.filterId}">
                    <div class="opt-name">
                        <div class="title-wr">
                            <div class="title">
                                ${e.name&&0<e.name.length?e.name:e.subscriptionUrl}
                                <a class="icon-home" target="_blank" href="${e.homepage||e.subscriptionUrl}"></a>
                                ${n}
                            </div>
                        </div>  
                        <div class="desc">${e.description}</div>
                        <div class="opt-name__info">
                            <div class="opt-name__info-labels">
                                ${s=[(n=e.version,{text:n?i18n.getMessage("options_filters_filter_version")+" "+n:"",className:"filter-version-desc"}),(s=s,{text:s?i18n.getMessage("options_filters_filter_updated")+" "+s:"",className:"last-update-time"})],s.filter(e=>0<e.text.length).map(e=>`<div class="opt-name__info-item ${e.className}">
                                ${e.text}
                           </div>`).join("")}
                            </div>
                            <div class="opt-name__info-labels opt-name__info-labels--tags">
                                ${i}
                            </div>
                        </div>
                    </div>
                    <div class="opt-state">
                        <div class="preloader"></div>
                        <div class="toggler-wr" role="checkbox" tabindex="0">
                            <input
                                type="checkbox"
                                name="filterId"
                                value="${e.filterId}"
                                ${t?'checked="checked"':""}
                                aria-labelledby="filter${e.filterId}"
                                aria-hidden="false"
                                >
                        </div>
                    </div>
                </li>`}(e,o.isEnabled(e.filterId),0===e.groupId);t.appendChild(htmlToElement(e))}),CheckboxUtils.toggleCheckbox(t.querySelectorAll(".opt-state input[type=checkbox]")),[].slice.call(document.querySelectorAll(".remove-custom-filter-button")).forEach(e=>{e.addEventListener("click",h)})},f=(t,e,n)=>{const s=document.querySelector("#antibanner"+t+" ul.opts-list--filters");if(s){for(;s.firstChild;)s.removeChild(s.firstChild);e=e.filter(e=>e.groupId===t);_(s,e,n)}},v=e=>({searchInputEl:e.querySelector('input[name="searchFiltersList"]'),displayOptionEl:e.querySelector("#filterStatusSelection"),clearSearchEl:e.querySelector(".filters-search__cross")}),y=250;const E=`<div class="filters-search">
                            <div class="icon-search">
                                <img src="images/magnifying-green.svg" alt="">
                            </div>
                            <input
                                type="text"
                                placeholder="${i18n.getMessage("options_filters_list_search_placeholder")}"
                                name="searchFiltersList"
                            />
                            <select class="opt-select opt-select--input" id="filterStatusSelection">
                                <option value="${d.ALL}">
                                    ${i18n.getMessage("options_filters_list_search_display_option_all")}
                                </option>
                                <option value="${d.ENABLED}">
                                    ${i18n.getMessage("options_filters_list_search_display_option_enabled")}
                                </option>
                                <option value="${d.DISABLED}">
                                    ${i18n.getMessage("options_filters_list_search_display_option_disabled")}
                                </option>
                            </select>
                            <div class="filters-search__cross">
                                <img src="images/cross.svg" alt="">
                            </div>
                        </div>`,t=e=>{const t=document.querySelector("#groupsList");t.style.display=e?"block":"none"},n=e=>{const t=document.querySelector("#filtersList");t.style.display=e?"block":"none"},S=e=>{e=e.searchInputEl;0<g(e.value).length?(n(!0),t(!1)):(n(!1),t(!0))},b=(e,t)=>{var n=document.querySelector("#filtersList");n&&(_(n,e,t),S(t))};function L(e){e.preventDefault(),I()}let T=!1;function I(e={}){var{isFilterSubscription:t,title:n,url:e}=e;const s="option-popup__step--active",i=document.querySelector("#add-custom-filter-popup"),r=document.querySelector("#add-custom-filter-step-1"),a=document.querySelector("#add-custom-filter-step-2"),o=document.querySelector("#add-custom-filter-step-3"),l=document.querySelector("#add-custom-filter-step-4"),c=document.querySelector("#custom-filter-popup-close"),d=document.querySelector("#custom-filter-popup-added-subscribe"),u=document.querySelector("#custom-filter-popup-trusted"),p=document.querySelector("#custom-filter-popup-url");function g(){i.classList.remove("option-popup--active"),p.value="",u.checked=!1}const m=()=>{r.classList.remove(s),a.classList.remove(s),o.classList.remove(s),l.classList.remove(s),c.style.display="block",i.classList.contains("option-popup--active")||i.classList.add("option-popup--active")};function h(){m(),r.classList.add(s),p.focus()}function _(){m(),a.classList.add(s),c.style.display="none"}function f(e){m(),o.classList.add(s),function(e){const t=document.querySelector(".custom-filter-error-message");t.textContent=e||i18n.getMessage("options_popup_check_false_description")}(e)}function v(e){m(),l.classList.add(s),function(e){var t=(e,t,n)=>{t?(e.textContent=t,e.closest(".option-popup__table-row").style.display="flex",n&&e.setAttribute("href",n)):e.closest(".option-popup__table-row").style.display="none"};const n=document.querySelector("#custom-filter-popup-added-title");e.name?n.value=e.name:n.value=e.customUrl,t(document.querySelector("#custom-filter-popup-added-desc"),e.description),t(document.querySelector("#custom-filter-popup-added-version"),e.version),t(document.querySelector("#custom-filter-popup-added-rules-count"),e.rulesCount),t(document.querySelector("#custom-filter-popup-added-homepage"),e.homepage,e.homepage),t(document.querySelector("#custom-filter-popup-added-url"),e.customUrl,e.customUrl)}(e)}T||(document.querySelector(".custom-filter-popup-next").addEventListener("click",e=>{e.preventDefault();e=p.value&&p.value.trim();contentPage.sendMessage({type:"loadCustomFilterInfo",url:e},e=>{var{filter:t,error:e}=e;t?v(t):f(e)}),_()}),d.addEventListener("click",e=>{e.preventDefault();e=document.querySelector("#custom-filter-popup-added-url").href;const t=document.querySelector("#custom-filter-popup-added-title").value||"";contentPage.sendMessage({type:"subscribeToCustomFilter",url:e,title:t.trim(),trusted:u.checked},e=>{g()})}),document.querySelector(".custom-filter-popup-try-again").addEventListener("click",h),c.addEventListener("click",g),window.addEventListener("hashchange",e=>{"#antibanner0"!==new URL(e.newURL).hash&&g()}),T=!0),i.classList.add("option-popup--active"),t?(contentPage.sendMessage({type:"loadCustomFilterInfo",url:e,title:n},e=>{var{filter:t,error:e}=e;t?v(t):f(e)}),_()):h()}const A=e=>{if(e){const t=moment(e);return t.locale(environmentOptions.Prefs.locale),t.format("LLL").toLowerCase()}return""},D=e=>{e&&e>=o.lastUpdateTime&&(o.lastUpdateTime=e,document.querySelector("#lastUpdateTime").textContent=A(e))};function k(e){e=i18n.getMessage("options_antibanner_info",[String(e.rulesCount||0)]);document.querySelector("#filtersRulesInfo").textContent=e}function R(s){const e=i(s.filterId);e.forEach(e=>{e.querySelector(".preloader").classList.remove("active");var t=A(s.lastUpdateTime||s.timeUpdated);e.querySelector(".last-update-time").textContent=i18n.getMessage("options_filters_filter_updated")+" "+t;const n=e.querySelector(".filter-version-desc");n&&(n.textContent=i18n.getMessage("options_filters_filter_version")+" "+s.version)})}return{render:function(){var e=(e=>{var t=document.querySelector("#antibanner .filters-search");if(t)return t;t=htmlToElement(E);return e.insertAdjacentElement("afterbegin",t),t})(document.querySelector("#antibanner .settings-body"));const i=v(e);(e=>{const{searchInputEl:t,displayOptionEl:n,clearSearchEl:s}=e;t.addEventListener("input",Utils.debounce(()=>{b(o.filters,e)},y)),n.addEventListener("change",()=>{b(o.filters,e)}),s.addEventListener("click",()=>{t.value="",n.value=d.ALL,b(o.filters,e)})})(i),contentPage.sendMessage({type:"getFiltersMetadata"},e=>{o.initLoadedFilters(e.filters,e.categories),D(o.lastUpdateTime);const{categories:t,filters:n}=o;t.forEach(e=>{c(e);var t=function(e){const t=e["groupId"];if(e="#antibanner"+t,e=document.querySelector(e+" .filters-search")){const n=v(e),{searchInputEl:s,displayOptionEl:i,clearSearchEl:r}=n,a=o["filters"];return s&&s.addEventListener("input",Utils.debounce(()=>{f(t,a,n)},y)),i&&i.addEventListener("change",()=>{f(t,a,n)}),r&&r.addEventListener("click",()=>{s.value="",i.value=d.ALL,f(t,a,n)}),n}}(e);f(e.groupId,n,t)}),b(n,i),function(){const e=document.querySelector(".empty-filters__btn");e&&e.addEventListener("click",L),[].slice.call(document.querySelectorAll(".add-custom-filter-button")).forEach(e=>{e.addEventListener("click",L)})}(),CheckboxUtils.toggleCheckbox(document.querySelectorAll(".opt-state input[type=checkbox]"));const s=document.location["hash"];s&&0===s.indexOf("#antibanner")&&TopMenu.toggleTab()})},updateRulesCountInfo:k,onFilterStateChanged:function(e){var{filterId:t,enabled:n}=e;o.updateEnabled(e,n),r(e.groupId),R(e);var s=function(e){const t=i(e);return 0===t.length?null:t.map(e=>e.querySelector("input"))}(t);s&&CheckboxUtils.updateCheckbox(s,n),t===AntiBannerFiltersId.URL_TRACKING_FILTER_ID&&(t=document.querySelector("#strip_tracking_params"),CheckboxUtils.updateCheckbox([t],e.enabled))},onCategoryStateChanged:function(e){o.updateCategoryEnabled(e,e.enabled),r(e.groupId)},onFilterDownloadStarted:function(e){a(e.groupId).querySelector(".preloader").classList.add("active");const t=i(e.filterId);t.forEach(e=>{e.querySelector(".preloader").classList.add("active")})},onFilterDownloadFinished:function(e){a(e.groupId).querySelector(".preloader").classList.remove("active"),R(e),D(e.lastUpdateTime)},renderCustomFilterPopup:I,onFiltersUpdateCheckReady:function(){document.querySelector(".settings-actions__update-button").classList.remove("settings-actions__update-button--spinning")}}},Settings=function(){"use strict";function e(e,t,n){const s=(n=n||{})["negate"],i=n["hidden"],r=document.querySelector(e);return i||r.addEventListener("change",function(){contentPage.sendMessage({type:"changeUserSetting",key:t,value:s?!this.checked:this.checked})}),{render:function(){if(i)r.closest("li").style.display="none";else{let e=userSettings.values[t];s&&(e=!e),CheckboxUtils.updateCheckbox([r],e)}},getPropertyName:()=>t,updateCheckboxValue:e=>{let t=e;s&&(t=!t),CheckboxUtils.updateCheckbox([r],t)}}}const s=[];if(s.push(new e("#allowAcceptableAds",userSettings.names.DISABLE_ALLOW_ACCEPTABLE_ADS)),s.push(new e("#allowProtectBadContentCheckbox",userSettings.names.DISABLE_ALLOW_PROTECT_BAD_CONTENT)),s.push(new e("#enableHitsCount",userSettings.names.DISABLE_COLLECT_HITS,{negate:!0})),s.push(new e("#useOptimizedFilters",userSettings.names.USE_OPTIMIZED_FILTERS)),s.push(new e("#showPageStatisticCheckbox",userSettings.names.DISABLE_SHOW_PAGE_STATS,{negate:!0,hidden:environmentOptions.Prefs.mobile})),s.push(new e("#enableShowContextMenu",userSettings.names.DISABLE_SHOW_CONTEXT_MENU,{negate:!0,hidden:!1})),s.push(new e("#showInfoAboutAdguardFullVersion",userSettings.names.DISABLE_SHOW_ADGUARD_PROMO_INFO,{negate:!0})),s.push(new e("#showAppUpdatedNotification",userSettings.names.DISABLE_SHOW_APP_UPDATED_NOTIFICATION,{negate:!0})),s.push(new e("#disable_stealth_mode",userSettings.names.DISABLE_STEALTH_MODE,{negate:!0})),s.push(new e("#hide_referrer",userSettings.names.HIDE_REFERRER)),s.push(new e("#hide_search_queries",userSettings.names.HIDE_SEARCH_QUERIES)),s.push(new e("#send_not_track",userSettings.names.SEND_DO_NOT_TRACK)),environmentOptions.isChrome){const c=document.querySelector("#remove-client-data");c.closest("li").style.display="flex",s.push(new e("#remove-client-data",userSettings.names.BLOCK_CHROME_CLIENT_DATA))}if(environmentOptions.canBlockWebRTC){const d=document.querySelector("#disable_webrtc");d.closest("li").style.display="flex",s.push(new e("#disable_webrtc",userSettings.names.BLOCK_WEBRTC))}s.push(new e("#third_party_cookies",userSettings.names.SELF_DESTRUCT_THIRD_PARTY_COOKIES)),s.push(new e("#first_party_cookies",userSettings.names.SELF_DESTRUCT_FIRST_PARTY_COOKIES));var t;const n=document.querySelector("#strip_tracking_params");n.addEventListener("change",(t=AntiBannerFiltersId.URL_TRACKING_FILTER_ID,e=>{e=e.currentTarget.checked?"addAndEnableFilter":"disableAntiBannerFilter";contentPage.sendMessage({type:e,filterId:t})}));const i=document.querySelector("#disable_stealth_mode");i.addEventListener("change",e=>{l(!e.target.checked)});const r=document.querySelector("#filtersUpdatePeriodSelect");let a=null;r&&r.addEventListener("click",e=>{e.stopPropagation(),a=document.querySelector(".filterTimeBox"),a.style.display="block"==a.style.display?"none":"block"}),setTimeout(()=>{const e=document.querySelectorAll(".time-item"),n=document.querySelector(".selTitleP");e.forEach(e=>{e.addEventListener("click",e=>{var t;e.stopPropagation(),t=e.currentTarget.value,contentPage.sendMessage({type:"setFiltersUpdatePeriod",updatePeriod:t},()=>{}),[...a.children].forEach(e=>{e.classList.remove("select")}),-1==e.currentTarget.className.indexOf("select")&&e.currentTarget.classList.add("select"),n.innerText=e.currentTarget.textContent,a.style.display="block"==a.style.display?"none":"block"})})},0);Object.values({thirdParty:{selector:"#third_party_time",settingKey:"SELF_DESTRUCT_THIRD_PARTY_COOKIES_TIME"},firstParty:{selector:"#first_party_time",settingKey:"SELF_DESTRUCT_FIRST_PARTY_COOKIES_TIME"}}).forEach(({selector:e,settingKey:n})=>{var{names:t,values:s,defaultValues:i}=userSettings;const r=i[n=t[n]],a=document.querySelector(e);a&&(a.value=s[n],a.setAttribute("placeholder",r),a.addEventListener("keyup",Utils.debounce(()=>{var e,t;contentPage.sendMessage({type:"changeUserSetting",key:n,value:(e=a.value,t=r,""===e||(e=Number.parseFloat(e))<0?t:e)})},1e3)))});const o=[{name:i18n.getMessage("options_select_update_period_default"),value:-1},{name:i18n.getMessage("options_select_update_period_48h"),value:Utils.hoursToMs(48)},{name:i18n.getMessage("options_select_update_period_24h"),value:Utils.hoursToMs(24)},{name:i18n.getMessage("options_select_update_period_12h"),value:Utils.hoursToMs(12)},{name:i18n.getMessage("options_select_update_period_6h"),value:Utils.hoursToMs(6)},{name:i18n.getMessage("options_select_update_period_1h"),value:Utils.hoursToMs(1)}];function l(t){const e=Object.values({general:"#general-stealth-options",cookies:"#cookies-stealth-options",miscellaneous:"#miscellaneous-stealth-options"}).map(e=>document.querySelector(e));e.forEach(e=>{t?e.classList.add("opts-list--disabled"):e.classList.remove("opts-list--disabled")})}return{render:function(){for(let e=0;e<s.length;e++)s[e].render();CheckboxUtils.updateCheckbox([n],AntiBannerFiltersId.URL_TRACKING_FILTER_ID in enabledFilters),function(e){const t=document.querySelector("#filtersUpdatePeriodSelect");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);0===e?t.parentNode.classList.remove("active"):t.parentNode.classList.add("active");const i=userSettings.values[userSettings.names.FILTERS_UPDATE_PERIOD];let n="默认";var s=o.map(e=>{var{name:t,value:e}=e;return i==e&&(n=t),`<li class="time-item${i==e?" select":""}" value="${e}"><span data-val="${e}">${t}</span></li>`}).join("\n"),s=`<p class="selTitleP">${n}</p><ul class="filterTimeBox">${s}</ul>`;t.insertAdjacentHTML("afterbegin",s),t.value=e}}(userSettings.values[userSettings.names.FILTERS_UPDATE_PERIOD]),l(userSettings.values[userSettings.names.DISABLE_STEALTH_MODE])},updateCheckboxValue:(e,t)=>{var n;n=e,s.filter(e=>e.getPropertyName()===n).forEach(e=>{e.updateCheckboxValue(t)})}}},PageController=function(){};PageController.prototype={SUBSCRIPTIONS_LIMIT:9,init(){this._bindEvents(),this._render(),CheckboxUtils.toggleCheckbox(document.querySelectorAll(".opt-state input[type=checkbox]")),TopMenu.init({onHashUpdated(e){}})},onSettingsImported(e){if(e){Utils.showPopup(i18n.getMessage("options_popup_import_success_title"));const t=this;contentPage.sendMessage({type:"initializeFrameScript"},e=>{userSettings=e.userSettings,enabledFilters=e.enabledFilters,requestFilterInfo=e.requestFilterInfo,t._render()})}else Utils.showPopup(i18n.getMessage("options_popup_import_error_title"),i18n.getMessage("options_popup_import_error_description"))},_bindEvents(){this.tooManySubscriptionsEl=document.querySelector("#tooManySubscriptions"),document.querySelector("#resetStats").addEventListener("click",this.onResetStatsClicked.bind(this)),document.querySelector("#openLog").addEventListener("click",e=>{e.preventDefault(),contentPage.sendMessage({type:"openFilteringLog"})})},_render(){var e=userSettings.values[userSettings.names.DEFAULT_WHITE_LIST_MODE],t=document.getElementsByClassName("current-year");Array.prototype.forEach.call(t,e=>{e.innerText=(new Date).getFullYear().toString()}),environmentOptions.Prefs.mobile&&(document.querySelector("#resetStats").style.display="none"),this.checkSubscriptionsCount(),this.settings=new Settings,this.settings.render(),this.whiteListFilter=new WhiteListFilter({defaultWhiteListMode:e}),this.whiteListFilter.updateWhiteListDomains(),this.blackListFilter=new blackListFilter,this.antiBannerFilters=new AntiBannerFilters({rulesInfo:requestFilterInfo}),this.antiBannerFilters.render();const n=document.querySelector("#about-version-placeholder");n&&(n.textContent=i18n.getMessage("options_about_version")+" "+environmentOptions.appVersion);const s=document.querySelector('[i18n="options_send_signals_not_track_desc"]');s&&(e=s.getAttribute("i18n"),e=i18n.getMessage(e,['<a href="https://adguard.com/forward.html?action=global_privacy_control&from=options_screen&app=browser_extension" target="_blank" class="opt-state__link">"Global Privacy Control"</a>','<a href="https://adguard.com/forward.html?action=do_not_track&from=options_screen&app=browser_extension" target="_blank" class="opt-state__link">"Do Not Track"</a>']),s.innerHTML=e),/arm|x86|aarch/.test(navigator.platform)||(document.querySelector("#platform_only_x86_arm").style.display="none"),chrome.storage.local.get("adguard-settings",e=>{e=e["adguard-settings"].appName;document.querySelector("#option-page-title").innerHTML=e||adguard.uoschannel.name})},onResetStatsClicked(e){e.preventDefault(),contentPage.sendMessage({type:"resetBlockedAdsCount"},()=>{Utils.showPopup(i18n.getMessage("options_reset_stats_done"))})},importSettingsFile(e){e.preventDefault();const t=document.querySelector("#importSettingsFileInput");t.click()},checkSubscriptionsCount(){},addFilterSubscription(e){var{url:t,title:e}=e;this.antiBannerFilters.renderCustomFilterPopup({isFilterSubscription:!0,url:t,title:e})}};let userSettings,enabledFilters,environmentOptions,AntiBannerFiltersId,EventNotifierTypes,requestFilterInfo;const parseHash=e=>e.slice(1).split("&").map(e=>{var[t,e]=e.split("=");return[t,e]}).reduce((e,[t,n])=>(t&&n&&(e[t]=n),e),{}),handleUrlHash=()=>{var e=document.location["hash"],t=parseHash(decodeURIComponent(e)),{action:n,replacement:e}=t;if(n)return document.location.hash=e?"#"+e:"",t},handleHashOptions=(e,t)=>{var n;t&&t.action&&"add_filter_subscription"===t.action&&({title:n,url:t}=t,t&&e.addFilterSubscription({title:n,url:t}))},initPage=function(e){userSettings=e.userSettings,enabledFilters=e.enabledFilters,environmentOptions=e.environmentOptions,requestFilterInfo=e.requestFilterInfo,AntiBannerFiltersId=e.constants.AntiBannerFiltersId,EventNotifierTypes=e.constants.EventNotifierTypes;function t(){var e=handleUrlHash();const i=new PageController;i.init(),handleHashOptions(i,e),window.addEventListener("hashchange",()=>{handleHashOptions(i,handleUrlHash())}),e=[EventNotifierTypes.FILTER_ENABLE_DISABLE,EventNotifierTypes.FILTER_GROUP_ENABLE_DISABLE,EventNotifierTypes.FILTER_ADD_REMOVE,EventNotifierTypes.START_DOWNLOAD_FILTER,EventNotifierTypes.SUCCESS_DOWNLOAD_FILTER,EventNotifierTypes.ERROR_DOWNLOAD_FILTER,EventNotifierTypes.UPDATE_USER_FILTER_RULES,EventNotifierTypes.UPDATE_WHITELIST_FILTER_RULES,EventNotifierTypes.REQUEST_FILTER_UPDATED,EventNotifierTypes.SETTINGS_UPDATED,EventNotifierTypes.SETTING_UPDATED,EventNotifierTypes.FILTERS_UPDATE_CHECK_READY],createEventListener(e,(e,t)=>{switch(e){case EventNotifierTypes.FILTER_ENABLE_DISABLE:i.checkSubscriptionsCount(),i.antiBannerFilters.onFilterStateChanged(t);break;case EventNotifierTypes.FILTER_GROUP_ENABLE_DISABLE:i.antiBannerFilters.onCategoryStateChanged(t);break;case EventNotifierTypes.FILTER_ADD_REMOVE:t&&t.customUrl&&i.antiBannerFilters.render();break;case EventNotifierTypes.START_DOWNLOAD_FILTER:i.antiBannerFilters.onFilterDownloadStarted(t);break;case EventNotifierTypes.SUCCESS_DOWNLOAD_FILTER:case EventNotifierTypes.ERROR_DOWNLOAD_FILTER:i.antiBannerFilters.onFilterDownloadFinished(t);break;case EventNotifierTypes.UPDATE_USER_FILTER_RULES:i.antiBannerFilters.updateRulesCountInfo(t);break;case EventNotifierTypes.UPDATE_WHITELIST_FILTER_RULES:i.whiteListFilter.updateWhiteListDomains();break;case EventNotifierTypes.REQUEST_FILTER_UPDATED:i.antiBannerFilters.updateRulesCountInfo(t);break;case EventNotifierTypes.SETTING_UPDATED:var{propertyName:n,propertyValue:s}=t;"boolean"==typeof s&&i.settings.updateCheckboxValue(n,s);break;case EventNotifierTypes.SETTINGS_UPDATED:i.onSettingsImported(t);break;case EventNotifierTypes.FILTERS_UPDATE_CHECK_READY:i.antiBannerFilters.onFiltersUpdateCheckReady()}})}(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)},browser=window.browser||chrome,backgroundPagePromise=new Promise((t,n)=>{browser.runtime.getBackgroundPage(e=>browser.runtime.lastError?n(browser.runtime.lastError):e?t(e):n(new Error("Runtime was unable to get background page")))}),waitStorageInit=e=>{e.localStorage.isInitialized()?contentPage.sendMessage({type:"initializeFrameScript"},initPage):setTimeout(()=>{waitStorageInit(e)},500)};function getUpdatePopuHtml(){let s,i,e=!!window.GLOBAL_VERSION_INFO;if(window.GLOBAL_VERSION_INFO){let{verName:e,updateDesc:t,pkgUrl:n}=window.GLOBAL_VERSION_INFO;e=e.replace(/<[^>]*>/g,""),t=t.replace(/<[^>]*>/g,""),t=t.replace("##n##","<br/>"),s=`
            <p class="mask-content-p1">检测到最新版本${e}</p>
            <p class="font-4x padding-t-20">本次更新：</p>
            <pre class="font-4x">${t}</pre>`,i=`
            <div class="flex-end">
                <p class="mask-close-btn">取消</p>
                <a class="mask-sub-btn" href='${n}'>马上更新</a>
            </div>`}else s='<p class="mask-content-p1">您使用的版本已是最新的</p>',i=`
            <div class="flex-center">
                <p class="mask-sub-btn">我知道了（5秒）</p>
            </div>`;return{_HTML:s,_BTNHTML:i,isUpdate:e}}backgroundPagePromise.then(e=>{waitStorageInit(e.adguard)}).catch(e=>{}),window.onload=()=>{const e=document.querySelectorAll(".btn-box");let t=document.querySelector("body");t.addEventListener("click",e=>{let t=document.querySelector(".filterTimeBox");t&&(t.style.display="none")}),e.forEach(e=>{e.addEventListener("click",function(e){e.target.firstElementChild?-1!=e.target.firstElementChild.className.indexOf("select")?e.target.firstElementChild.classList.remove("select"):e.target.firstElementChild.classList.add("select"):-1!=e.target.className.indexOf("select")?e.target.classList.remove("select"):e.target.classList.add("select"),TopMenu._renderOptionsBtnChange(e.target.dataset)})}),$(".statistics_item").click(e=>{$(".statistics_item").removeClass("is-active"),$(e.target).addClass("is-active"),CHART_STORE.range_type=DATERANGE[$(e.target).attr("data-type")]});const n=document.querySelector(".update-box"),r=document.querySelector(".mask-box"),a=document.querySelector(".mask-content"),o=document.querySelector(".mask-btn-box"),s=document.querySelector("#updateTitle"),l=()=>{r.style.display="none",clearInterval(c)};let c;s.style.display=GLOBAL_VERSION_INFO?"block":"none",n.addEventListener("click",()=>{var{_HTML:e,_BTNHTML:t,isUpdate:n}=getUpdatePopuHtml();r.style.display="block",a.innerHTML=e,o.innerHTML=t;const s=document.querySelector(".mask-sub-btn"),i=document.querySelector(".close-btn");if(!n){let e=5;clearInterval(c),s.innerText="我知道了（5秒）",c=setInterval(()=>{e--,s.innerText=`我知道了（${e}秒）`,0==e&&(r.style.display="none",clearInterval(c))},1e3)}s.addEventListener("click",l),i.addEventListener("click",l),n&&document.querySelector(".mask-close-btn").addEventListener("click",l)}),browser.runtime.sendMessage({type:"query_version_update"});const i=document.querySelector("#about-btn");i&&i.parentNode.addEventListener("click",()=>{i.className&&(i.className="",browser.storage.local.get("adguard-settings",e=>{e["adguard-settings"].visited_verName=window.GLOBAL_VERSION_INFO.verName,browser.storage.local.set(e)}))}),document.getElementById("curVersionName").innerText=chrome.app.getDetails().version;const d=document.querySelectorAll(".doubt-icon"),u=document.querySelectorAll(".doubt-title");d.forEach((e,t)=>{e.addEventListener("mouseover",e=>{u[t].style.display="block"}),e.addEventListener("mouseout",e=>{u[t].style.display="none"})})},window.GLOBAL_VERSION_INFO=null,browser.runtime.onMessage.addListener(e=>{switch(e.type){case"version_update":window.GLOBAL_VERSION_INFO=e.info,document.getElementById("updateTitle").style.display="block",browser.storage.local.get("adguard-settings",e=>{e["adguard-settings"].visited_verName!==GLOBAL_VERSION_INFO.verName&&(document.getElementById("about-btn").className="has-new-version")});break;case"greenInternetEnableChange":1==adguard.uoschannel.id&&(1==e.enable?DisablePageShow():"禁止访问"==document.title&&window.location.reload())}}),contentPage.sendMessage({type:"getGreenInternetEnable"},e=>{1==e&&1==adguard.uoschannel.id&&DisablePageShow()});