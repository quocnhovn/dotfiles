!function(S){"use strict";const A="uos.serverResponseSuccess",n="uos.eventServerResponseError";function a(e){const t=s();for(var n in e&&e.hasOwnProperty&&(e.hasOwnProperty("enablePrivacyProtect")&&(t[S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS]=!!e.enablePrivacyProtect),e.hasOwnProperty("showProtectTotal")&&(t[S.settings.DISABLE_SHOW_PAGE_STATS]=!e.showProtectTotal),e.hasOwnProperty("name")&&(S.uoschannel.name=e.name),e.hasOwnProperty("pornEnable")&&(t[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]=!!e.pornEnable),e.hasOwnProperty("enable")&&(t[S.settings.DISABLE_FILTERING]=1!=e.enable)),t)n==S.settings.DISABLE_FILTERING?S.settings.changeFilteringDisabled(t[n]):S.settings.setProperty(n,t[n]);S.localStorage.setItem("appName",S.uoschannel.name),t[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]&&!t[S.settings.DISABLE_FILTERING]&&y.dispatchEvent(new CustomEvent("nsfw_need_init"))}const y=new EventTarget,s=function(){switch(S.uoschannel.id){case 1:return{[S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS]:!0,[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]:!0,[S.settings.DISABLE_SHOW_PAGE_STATS]:!1,[S.settings.DISABLE_FILTERING]:!1};case 2:return{[S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS]:!0,[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]:!1,[S.settings.DISABLE_SHOW_PAGE_STATS]:!1,[S.settings.DISABLE_FILTERING]:!1};case 3:case 4:return{[S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS]:!0,[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]:!1,[S.settings.DISABLE_SHOW_PAGE_STATS]:!1,[S.settings.DISABLE_FILTERING]:!0};case 5:return{[S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS]:!0,[S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT]:!0,[S.settings.DISABLE_SHOW_PAGE_STATS]:!1,[S.settings.DISABLE_FILTERING]:!1}}};chrome.runtime.onInstalled.addListener(function(e){const r=e=>{var{name:t,showProtectTotal:n,enable:s,enablePrivacyProtect:i,enableAdverseContentProtect:e}=e.detail;a({name:t,showProtectTotal:n,enablePrivacyProtect:i,enable:s,pornEnable:e}),y.removeEventListener(A,r)},t=e=>{a(),y.removeEventListener(A,t)};y.addEventListener(A,r),y.addEventListener(n,t)}),S.uos={event:y,greenInternetEnable:0,webProEnable:1,setPornRuleCfg(e){S.uos.pornRuleCfg=Object.assign(S.uos.pornRuleCfg||{},e),S.uos.originalPornRuleCfg=e},inPornWhiteList(e){const t=JSON.parse(S.localStorage.getItem("pornWhiteList")||"[]")||[];let n=!1;try{n=new URL(sender_url).host}catch(e){}e=S.whitelist.findWhiteListRule(e);return t.includes(n)||!!e&&e.whiteListRule&&!S.whitelist.optionsUserBlackListlData("get").includes(n)},getPornRuleCfg(e){var t=S.uos.inPornWhiteList(e),n=!0===S.settings.isFilteringDisabled()?0:1,{imgCriteriaPer:s,imgRuleHigh:i,imgRuleWidth:r,videoCountTimes:o,pornImgShowMode:a,videoCriteriaPer:l,pornVideoShowMode:c,sysType:u,videoDetectInterval:d,sexyImgCriteriaPer:g,sexyVideoCriteriaPer:p}=S.uos.pornRuleCfg||{},f=/arm|x86|aarch/.test(navigator.platform)?1:0,m=S.uos.userInfo&&2==S.uos.userInfo.userType||S.settings.getProperty(S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT)?1:0,e=S.uos.userInfo&&2==S.uos.userInfo.userType?S.uos.webProEnable:1,t={enable:f&m&n&e,videoCountTimes:h(o,2),imgRuleHigh:h(i,200),imgRuleWidth:h(r,200),pornImgShowMode:h(a,1),pornVideoShowMode:h(c,1),imgCriteriaPer:h(s,40),videoCriteriaPer:h(l,40),sexyImgCriteriaPer:h(g,40),sexyVideoCriteriaPer:h(p,40),sysType:_(u,"1,2"),videoDetectInterval:h(d,5),inWhiteList:t};return S.uos.pornRuleCfg=t},getAppeptableAdsFilterId(){return c},getTrackInfoApi(){return o.track_protect_info},init(){const e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&200===e.status&&u(e.responseText)},e.addEventListener("error",function(e){y.dispatchEvent(new CustomEvent(n)),S.console.info("uos rule info init",e)}),e.open("get",o.rule_cfg_info+(`?version=1.1&sid=${Math.random()}.`+(new Date).getTime())),e.setRequestHeader("sys_type",S.uoschannel.id),e.send(),S.console.info("uos rule info init"),setTimeout(()=>{null!==S.whitelist.getWhiteListBtnStatus()&&void 0!==S.whitelist.getWhiteListBtnStatus()||S.whitelist.changeWhiteListFilter(),null!==S.whitelist.getBlackListBtnStatus()&&void 0!==S.whitelist.getBlackListBtnStatus()||S.whitelist.changeBlackListFilter()},300)},userReport(n){browser.tabs.query({currentWindow:!0,active:!0},function(e){if(e&&0<e.length){e=e[0].url;const t=new XMLHttpRequest;t.onreadystatechange=function(){"function"==typeof n&&t.readyState==XMLHttpRequest.DONE&&200===t.status&&n(JSON.parse(t.responseText))},t.open("post",o.report),t.setRequestHeader("sys_type",S.uoschannel.id),t.setRequestHeader("content-type","application/json"),t.send(JSON.stringify({webSite:e}))}})},statusReport(e){}};let v={};var e,t,i,r=S.uoschannel.HOST;const o={report:r+"/ad-guard-report/report",rule_cfg_info:r+"/ad-guard-cfg/rule_cfg_info",ad_filter_data:r+"/ad-guard-report/ad_filter_data",track_protect_info:r+"/ad-guard-cfg/track_protect_info/"},l="filter_10.txt";let c=!1;function b(e,t){var n,s;const i={"Y+":t.getFullYear().toString(),"m+":(t.getMonth()+1).toString(),"d+":t.getDate().toString(),"H+":t.getHours().toString(),"M+":t.getMinutes().toString(),"S+":t.getSeconds().toString()};for(s in i)(n=new RegExp("("+s+")").exec(e))&&(e=e.replace(n[1],1==n[1].length?i[s]:i[s].padStart(n[1].length,"0")));return e}function O(i){if(i&&/[\d|\.]/.test(i)){var r=i.split("."),o=chrome.app.getDetails().version.split("."),a=Math.max(r.length,o.length);let e=Math.pow(10,a),t=0,n=0,s=0;for(;a>t;)r[t]&&(n+=(parseInt(r[t])||0)*e),o[t]&&(s+=(parseInt(o[t])||0)*e),t++,e/=10;return n>s}}function w(){const s=S.uos.filterRuleFileInfos||[];let i=S.localStorage.getItem("uosRuleFileInfos")||[],e=[];s.map(t=>{for(let e=0;e<i.length;e++)if(i[e].md5==t.md5)return!0;e.push(t)});let t=[];i.map((n,e)=>{n.fileName===l&&(c=n.filterId,S.settings.getProperty(S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS)||S.filters.disableFilters([n.filterId]));for(let e=0,t=s.length;e<t;e++)if(n.md5==s[e].md5)return;t.push(e)}),t.map(e=>{e=i.splice(e,1).filterId;S.filters.removeFilter(e),S.filters.uninstallFilters([e]),S.rulesStorage.remove(e,()=>{})});const n=S.filters.getEnabledFilters();n.map(e=>{var t=e["filterId"];for(let e=0;e<i.length;e++)if(i[e].filterId==t)return!0;S.filters.removeFilter(t),S.filters.uninstallFilters([t]),S.rulesStorage.remove(t,()=>{})}),S.settings.isFilteringDisabled()||e.map(n=>{var e=n["url"];S.filters.loadCustomFilter(e,{},t=>{S.filters.addAndEnableFilters([t.filterId],e=>{n.fileName===l&&(c=t.filterId,S.settings.getProperty(S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS)||S.filters.disableFilters([t.filterId])),i.push({...n,filterId:t.filterId})},{})},e=>{S.console.warn(e)})}),S.localStorage.setItem("uosRuleFileInfos",i)}const u=function(e){let t;try{t=JSON.parse(e)}catch(e){return void S.console.error(e)}if(200===t.code&&t.datas){const{filterRuleFileInfos:r,latestVerInfo:o,whiteListFile:a,pornRuleCfg:l,pornWhiteListFile:c,pornFilterRuleFileInfos:u}=t.datas;if(y.dispatchEvent(new CustomEvent(A,{detail:t.datas})),l&&S.uos.setPornRuleCfg(l),r&&(S.uos.filterRuleFileInfos=r,w()),a){const d="whiteListFileMd5";let{md5:n,url:e}=a;var s=S.localStorage.getItem(d);if(n&&e&&n!=s){let t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE&&200===t.status){let e=t.responseText.split(/\s/);e=e.filter(e=>!/^\W*$/.test(e)),S.whitelist.optionsSysWhiteListlData("set",e),S.whitelist.filterWhiteListChange(),S.localStorage.setItem(d,n)}},t.open("get",e),t.setRequestHeader("sys_type",S.uoschannel.id),t.setRequestHeader("content-type","text/html"),t.send()}}if(c){const g="pornWhiteListFileMd5",{md5:p,url:f}=c;s=S.localStorage.getItem(g);p&&f&&p!=s&&fetch(f+"?sid="+(new Date).getTime()).then(e=>{e.text().then(e=>{let t=e.split(/\s/);t=t.map(t=>{try{return new URL(t).hostname}catch(e){if(!/^\W*$/.test(t))return t}}).filter(e=>!!e),S.localStorage.setItem(g,p),S.localStorage.setItem("pornWhiteList",JSON.stringify(t))}).catch(e=>{})}).catch(e=>{})}if(u){var n,i="pornFilterRuleFiles";const m=S.localStorage.getItem(i)||{},h={};for(n in u.map(e=>{const{md5:t,url:n,sysType:s}=e;h[t]={url:n,sysType:s.split(",").map(e=>parseInt(e))}}),m)Object.prototype.hasOwnProperty.call(h,n)||delete m[n];const _=function(e,t){if(t.includes(S.uoschannel.id)){const n=e.split(/\s/);n.map(e=>{S.dfa.add(e)})}};S.dfa.clear();const L=Object.assign(h,m);for(n in L){const{url:T,sysType:E,text:I}=L[n];I?_(I,E):fetch(T).then(e=>{e.text().then(e=>{_(e,E),L[n].text=e})})}S.localStorage.setItem(i,L)}o&&(v=o,v.publishTime=b("YYYY-mm-dd",new Date(v.publishTime)),i=o["verName"],O(i)&&S.runtimeImpl.sendMessage({type:"version_update",info:o}))}else S.console.error("server error, uos rule info not found")};S.runtimeImpl.onMessage.addListener(e=>{switch(e.type){case"query_version_update":var t=v["verName"];O(t)&&S.runtimeImpl.sendMessage({type:"version_update",info:v});break;case"changeApplicationFilteringDisabled":!S.settings.isFilteringDisabled()&&S.settings.getProperty(S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT)&&y.dispatchEvent(new CustomEvent("nsfw_need_init")),w();break;case"changeUserSetting":e.key===S.settings.DISABLE_ALLOW_ACCEPTABLE_ADS&&d(e.value)}});const d=function(e){c&&(e?S.filters.addAndEnableFilters([c]):S.filters.disableFilters([c]))},h=function(e,t){return e=parseInt(e),isNaN(e)||null==e||null==e?t:e},_=function(e,t){return null!=e?e:t};let g=S.localStorage.getItem("blockcache")||{};function p(){var e=Object.values(g);const t=Object.keys(g);if(0<e.length){const n=new XMLHttpRequest;n.open("post",o.ad_filter_data),n.setRequestHeader("content-type","application/json"),n.setRequestHeader("sys_type",S.uoschannel.id),n.send(JSON.stringify(e)),n.onreadystatechange=function(){200===n.status&&t.map(e=>{try{delete g[e]}catch(e){}f()})}}setTimeout(p,6e4)}function f(){S.localStorage.setItem("blockcache",g)}S.listeners.addListener((e,t,n)=>{if("event.ads.blocked"===e){e=b("YYYY-mm-dd HH:MM:SS",new Date);const s={webSite:t.referrerUrl,crtTime:e,counts:1,dataType:1};if(t.filterId===c&&(s.dataType=2),t.filterId==S.pageStats.NSFW_PROTOTYPE_NAME){switch(t.filterType){case"img":s.dataType=3;break;case"video":s.dataType=4;break;case"text":s.dataType=5,s.counts=t.count}s.webSite=n?n.tabUrl:""}e=s.webSite+`_${e}_`+s.dataType;g[e]?g[e].counts+=1:g[e]=s,f()}}),setTimeout(p,6e4),S.uos.init();let m=null,L=(new Date).getTime();function T(){clearTimeout(m);let e=S.settings.getFiltersUpdatePeriod();e=e<0?18e5:e,L+e<=(new Date).getTime()&&(S.uos.init(),L=(new Date).getTime(),S.console.info("uos rule info update")),m=setTimeout(T,6e4)}T();let E=S.localStorage.getItem("page-statistic");function I(e,t){for(var n in e)for(var s in e[n])for(var i in e[n][s])t[`${n}-${s}-`+i]=e[n][s][i]}"string"==typeof E&&(E=JSON.parse(E)),E&&E.data&&({dataObjAll:e,privacyObjAll:t}=E.data,i={},r={},e&&I(e,i),t&&I(t,r),S.localStorage.setItem("page-statistic",JSON.stringify({adblock:i,private:r})),S.initialize()),function(e){if([1,2].includes(e)){const o=1==S.uoschannel.id?4:0;let s;function i(t){return new Promise(function(n,e){s=chrome.runtime.connectNative("uos.children.guard.native"),s.onDisconnect.addListener(function(){return++i.reconnect_count<=t?i(t):void e(chrome.runtime.lastError)}),s.postMessage({method:o,update_time:(new Date).getTime()+""}),s.onMessage.addListener(function e(t){s.onMessage.removeListener(e),n(t)})})}function n(){try{clearTimeout(n.timeoutID)}catch(e){}var e=JSON.parse(S.localStorage.getItem("page-statistic")||"{}");const t={method:1,adBlockTotal:0,pornBlockTotal:0,privacyBlockTotal:0,allBlockTotal:0};e.adblock&&Object.values(e.adblock).map(e=>{t.adBlockTotal+=e}),e.private&&Object.values(e.private).map(e=>{t.privacyBlockTotal+=e}),e.nsfw&&Object.values(e.nsfw).map(e=>{t.pornBlockTotal+=e}),t.allBlockTotal=t.adBlockTotal+t.pornBlockTotal+t.privacyBlockTotal,s.postMessage(t),n.timeoutID=setTimeout(()=>{n()},18e4)}function r(e){clearTimeout(r.timeoutID);const{update_time:t,data:n}=e;n&&Object.prototype.hasOwnProperty.call(n,"webProEnable")&&(S.uos.webProEnable=n.webProEnable,S.settings.setProperty(S.settings.DISABLE_ALLOW_PROTECT_BAD_CONTENT,1==n.webProEnable)),n&&Object.prototype.hasOwnProperty.call(n,"userInfo")&&(S.uos.userInfo=n.userInfo),S.nsfwQueue.model||y.dispatchEvent(new CustomEvent("nsfw_need_init")),n&&Object.prototype.hasOwnProperty.call(n,"enable")&&1==S.uoschannel.id&&n.enable!=S.uos.greenInternetEnable&&(a(),S.uos.greenInternetEnable=n.enable,S.runtimeImpl.sendMessage({type:"greenInternetEnableChange",enable:n.enable}),1!=n.enable&&S.ui.changeApplicationFilteringDisabled(!0)),r.timeoutID=setTimeout(()=>{s.postMessage({method:o,update_time:t})},3e3)}i.reconnect_count=0,S.runtimeImpl.onMessage.addListener((e,t,n)=>{"getUserInfo"==e.type&&n(S.uos.userInfo),"getGreenInternetEnable"==e.type&&n(S.uos.greenInternetEnable)}),i(5).then(e=>{s.onMessage.hasListener(r)||s.onMessage.addListener(r),r(e),4!=o&&n()}).catch(e=>{})}}(S.uoschannel.id)}(adguard);