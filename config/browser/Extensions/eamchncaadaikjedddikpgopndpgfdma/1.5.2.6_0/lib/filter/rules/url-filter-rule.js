!function(T,p){"use strict";const l="\\";function E(e){try{if(/^[\x00-\x7F]+$/.test(e))return e;var t=function(n,o){try{let t;var r,s,p=["http://www.","https://www.","http://","https://","||","//"],l=["/","^"];let e=o?-1:0;for(t=0;t<p.length;t++){var E=p[t];if(T.utils.strings.startWith(n,E)){e=E.length;break}}o&&(r="domain=",-1<(s=n.indexOf(r))&&-1<n.indexOf("$")&&(e=s+r.length),-1===e&&(e=0));let i=-1;for(t=0;t<l.length;t++){var O=l[t],u=n.indexOf(O,e);if(0<=u){i=u;break}}return-1===i?n.substring(e):n.substring(e,i)}catch(t){return T.console.error("Error parsing domain from {0}, cause {1}",n,t),null}}(e,!0);return t?T.utils.strings.replaceAll(e,t,T.utils.url.toPunyCode(t)):""}catch(t){return T.console.error("Error getAsciiDomainRule from {0}, cause {1}",e,t),""}}function n(i){let n=i,t=null,o=null,r=0;T.utils.strings.startWith(n,p.FilterRule.MASK_WHITE_LIST)&&(r=p.FilterRule.MASK_WHITE_LIST.length,n=n.substring(r),t=!0);let e=!0;if(T.utils.strings.startWith(n,p.UrlFilterRule.MASK_REGEX_RULE)&&T.utils.strings.endsWith(n,p.UrlFilterRule.MASK_REGEX_RULE)&&!T.utils.strings.contains(n,p.UrlFilterRule.REPLACE_OPTION+"=")&&(e=!1),e){let e=!1;for(let t=i.length-2;t>=r;t--){var s;if(i.charAt(t)===u.OPTIONS_DELIMITER){if(!(0<t&&i.charAt(t-1)===l)){n=i.substring(r,t),o=i.substring(t+1),e&&(s=p.SimpleRegex.escapeRegExp(l+u.OPTIONS_DELIMITER),s=new RegExp(s,"g"),o=o.replace(s,u.OPTIONS_DELIMITER));break}e=!0}}}return n=E(n),{urlRuleText:n,options:o,whiteListRule:t}}function o(t){if(!t)return{optionText:""};var e=T.utils.strings.splitByDelimiterWithEscapeCharacter(t,"/",l,!0);if(e.length<2||3<e.length)throw"Cannot parse "+t;let i=e[2]||"";i.indexOf("g")<0&&(i+="g");const n=new RegExp(e[0],i),o=e[1];return{apply:t=>t.replace(n,o),optionText:t}}function r(r){return{apply:t=>{var e,i=t.indexOf("?");if(i<0)return t;if(!r)return t.substring(0,i);let n=!1,o=r;return r.startsWith("~")&&(n=!0,o=o.substring(1)),[e,i,t=!1]=[t,o,n],i.startsWith("/")?T.utils.url.cleanUrlParamByRegExp(e,T.utils.strings.patternFromString(i),t):T.utils.url.cleanUrlParam(e,[i],t)},optionText:r}}function s(t){return{getRedirectUrl:()=>T.rules.RedirectFilterService.buildRedirectUrl(t),redirectTitle:t}}function O(t){this.option=t||"",this.regex=null,this.cookieName=null,this.sameSite=null,this.maxAge=null;const e=this.option.split(/;/),i=e[0];if(T.utils.strings.startWith(i,"/")&&T.utils.strings.endsWith(i,"/")?(t=i.substring(1,i.length-1),this.regex=new RegExp(t)):this.cookieName=i,1<e.length)for(let t=1;t<e.length;t+=1){var n=e[t].split("="),o=n[0],n=n[1];if(o===u.cookieOptions.MAX_AGE)this.maxAge=parseInt(n);else{if(o!==u.cookieOptions.SAME_SITE)throw"Unknown $cookie option: "+o;this.sameSite=n}}this.matches=function(t){return!!t&&(this.regex?this.regex.test(t):!this.cookieName||this.cookieName===t)},this.isEmpty=function(){return!this.regex&&!this.cookieName}}function i(t,e){return null!==t&&(t&e)===e}var u=function(t,e){p.FilterRule.call(this,t,e),this.shortcut=null,this.permittedContentType=u.contentTypes.ALL,this.restrictedContentType=0,this.enabledOptions=null,this.disabledOptions=null;t=n(t);t.whiteListRule&&(this.whiteListRule=!0),t.options&&this._loadOptions(t.options);const i=t["urlRuleText"];if(this.isRegexRule=T.utils.strings.startWith(i,u.MASK_REGEX_RULE)&&T.utils.strings.endsWith(i,u.MASK_REGEX_RULE)||""===i||i===u.MASK_ANY_SYMBOL,this.isRegexRule){this.urlRegExpSource=i.substring(u.MASK_REGEX_RULE.length,i.length-u.MASK_REGEX_RULE.length);t=this.getUrlRegExp();if(!t)throw Error("Illegal regexp rule");if(!this.isCookieRule()&&!this.isRemoveparamRule()&&u.ANY_URL_REGEX===t&&!this.hasPermittedDomains())throw Error("Too wide basic rule: "+i);this.shortcut=function(t){if(!(t=t.match(/\/(.*)\/(\$.*)?/))||t.length<2)return null;let e=t[1];if(t="...",-1!==e.indexOf("?"))return null;e=t+e,e=e.replace(/[^\\]\(.*[^\\]\)/,t),e=e.replace(/[^\\]\[.*[^\\]\]/,t),e=e.replace(/[^\\]\{.*[^\\]\}/,t),e=e.replace(/[^\\]\\[a-zA-Z]/,t);var i=e.split(/[\\^$*+?.()|[\]{}]/);let n="",o=i.length;for(;o--;){var r=i[o];r.length>n.length&&(n=r)}return n?n.toLowerCase():null}(i)}else this.shortcut=function(t){let e="";var i=t.split(/[*^|]/);for(let t=0;t<i.length;t++){var n=i[t];n.length>e.length&&(e=n)}return e?e.toLowerCase():null}(i);this.isCspRule()&&function(t){if(!t.whiteListRule&&!t.cspDirective)throw new Error("Invalid $CSP rule: CSP directive must not be empty");if(t.cspDirective){const e=t.cspDirective.toLowerCase();if(0<=e.indexOf("report-"))throw new Error("Forbidden CSP directive: "+e)}}(this),this.isRemoveparamRule()&&function(t){var e=u.options["REMOVEPARAM_COMPATIBLE"];if(t.permittedContentType!==u.contentTypes.ALL||0<t.restrictedContentType||(t.enabledOptions|e)!==e)throw new Error("$removeparam rules are not compatible with some other modifiers")}(this)};u.prototype=Object.create(p.FilterRule.prototype),u.prototype.getUrlRegExpSource=function(){var t;return this.urlRegExpSource||(t=n(this.ruleText),this.urlRegExpSource=p.SimpleRegex.createRegexText(t.urlRuleText)),this.urlRegExpSource},u.prototype.addStealthActions=function(t){this.stealthActions=t},u.prototype.getReplace=function(){return this.replaceOption},u.prototype.getRemoveparam=function(){return this.removeparamOption},u.prototype.getRedirect=function(){return this.redirectOption},u.prototype.getCookieOption=function(){return this.cookieOption},u.prototype.getUrlRegExp=function(){if(this.wrongUrlRegExp)return null;if(!this.urlRegExp){var e=this.getUrlRegExpSource();try{e&&u.MASK_ANY_SYMBOL!==e?this.urlRegExp=new RegExp(e,this.isMatchCase()?"":"i"):this.urlRegExp=u.ANY_URL_REGEX,delete this.urlRegExpSource}catch(t){return T.console.error("Error create regexp from {0}",e),this.wrongUrlRegExp=!0,null}}return this.urlRegExp},u.prototype.isAnyUrl=function(){return null===this.shortcut&&this.getUrlRegExp()===u.ANY_URL_REGEX},u.prototype.isPermitted=function(t){if(!t){var e=this.hasPermittedDomains();if(this.whiteListRule&&!e)return!0;if(!this.isCheckThirdParty()&&!e)return!0}return p.FilterRule.prototype.isPermitted.call(this,t)},u.prototype.isFiltered=function(t,e,i){if(this.isOptionEnabled(u.options.THIRD_PARTY)&&!e)return!1;if(this.isOptionDisabled(u.options.THIRD_PARTY)&&e)return!1;if(!this.checkContentType(i))return!1;if(null!==this.shortcut&&-1===t.toLowerCase().indexOf(this.shortcut))return!1;const n=this.getUrlRegExp();return!!n&&n.test(t)},u.prototype.checkContentType=function(t){var e=u.contentTypes[t];if(!e)throw new Error("Unsupported content type "+t);return this.checkContentTypeMask(e)},u.prototype.checkContentTypeMask=function(t){if(this.permittedContentType===u.contentTypes.ALL&&0===this.restrictedContentType)return!0;var e=this.permittedContentType===u.contentTypes.ALL||0!=(this.permittedContentType&t),t=0===this.restrictedContentType||0==(this.restrictedContentType&t);return e&&t},u.prototype.isOptionEnabled=function(t){return i(this.enabledOptions,t)},u.prototype.isOptionDisabled=function(t){return i(this.disabledOptions,t)},u.prototype.isDocumentLevel=function(){return this.documentLevelRule},u.prototype.isCheckThirdParty=function(){return this.isOptionEnabled(u.options.THIRD_PARTY)||this.isOptionDisabled(u.options.THIRD_PARTY)},u.prototype.isThirdParty=function(){return!!this.isOptionEnabled(u.options.THIRD_PARTY)||(this.isOptionDisabled(u.options.THIRD_PARTY),!1)},u.prototype.isElemhide=function(){return this.isOptionEnabled(u.options.ELEMHIDE)},u.prototype.isJsInject=function(){return this.isOptionEnabled(u.options.JSINJECT)},u.prototype.isContent=function(){return this.isOptionEnabled(u.options.CONTENT)},u.prototype.isDocumentWhiteList=function(){return this.isOptionEnabled(u.options.DOCUMENT_WHITELIST)},u.prototype.isGenericBlock=function(){return this.isOptionEnabled(u.options.GENERICBLOCK)},u.prototype.isGenericHide=function(){return this.isOptionEnabled(u.options.GENERICHIDE)},u.prototype.isUrlBlock=function(){return this.isOptionEnabled(u.options.URLBLOCK)},u.prototype.isMatchCase=function(){return this.isOptionEnabled(u.options.MATCH_CASE)},u.prototype.isBlockPopups=function(){return this.isOptionEnabled(u.options.BLOCK_POPUPS)},u.prototype.isCspRule=function(){return this.isOptionEnabled(u.options.CSP_RULE)},u.prototype.isCookieRule=function(){return this.isOptionEnabled(u.options.COOKIE_RULE)},u.prototype.isRedirectRule=function(){return this.isOptionEnabled(u.options.REDIRECT)},u.prototype.isDocumentRule=function(){return this.isOptionEnabled(u.options.DOCUMENT)},u.prototype.isStealthRule=function(){return this.isOptionEnabled(u.options.STEALTH)},u.prototype.isBadFilter=function(){return null!=this.badFilter},u.prototype.isReplaceRule=function(){return this.isOptionEnabled(u.options.REPLACE)},u.prototype.isRemoveparamRule=function(){return this.isOptionEnabled(u.options.REMOVEPARAM)},u.prototype.isIgnored=function(){return this.isOptionEnabled(u.options.EXTENSION)};const e=t=>{const e=T.utils.strings.splitByDelimiterWithEscapeCharacter(t,p.FilterRule.COMA_DELIMITER,l,!1);return e.reduce((t,e)=>{var i=e.indexOf(p.FilterRule.EQUAL),n=0<=i?e.substr(0,i):e,e=0<=i?e.substr(i+1):"";return i=n,n={"FIRST-PARTY":p.FilterRule.NOT_MARK+u.THIRD_PARTY_OPTION,XHR:u.XMLHTTPREQUEST_OPTION,POPUNDER:u.POPUP_OPTION,"1P":p.FilterRule.NOT_MARK+u.THIRD_PARTY_OPTION,"3P":u.THIRD_PARTY_OPTION,CSS:u.STYLESHEET_OPTION,FRAME:u.SUBDOCUMENT_OPTION}[i.toUpperCase()]||i,t.push({optionName:n,optionValue:e}),t},[])};u.prototype._loadOptions=function(t){var n=e(t);for(let i=0;i<n.length;i+=1){let{optionName:t,optionValue:e}=n[i];switch(t){case u.DOMAIN_OPTION:e&&this.loadDomains(e);break;case u.THIRD_PARTY_OPTION:this._setUrlFilterRuleOption(u.options.THIRD_PARTY,!0);break;case p.FilterRule.NOT_MARK+u.THIRD_PARTY_OPTION:this._setUrlFilterRuleOption(u.options.THIRD_PARTY,!1);break;case u.MATCH_CASE_OPTION:this._setUrlFilterRuleOption(u.options.MATCH_CASE,!0);break;case u.IMPORTANT_OPTION:this.isImportant=!0;break;case p.FilterRule.NOT_MARK+u.IMPORTANT_OPTION:this.isImportant=!1;break;case u.ELEMHIDE_OPTION:this._setUrlFilterRuleOption(u.options.ELEMHIDE,!0);break;case u.GENERICHIDE_OPTION:this._setUrlFilterRuleOption(u.options.GENERICHIDE,!0);break;case u.JSINJECT_OPTION:this._setUrlFilterRuleOption(u.options.JSINJECT,!0);break;case u.CONTENT_OPTION:this._setUrlFilterRuleOption(u.options.CONTENT,!0);break;case u.URLBLOCK_OPTION:this._setUrlFilterRuleOption(u.options.URLBLOCK,!0);break;case u.GENERICBLOCK_OPTION:this._setUrlFilterRuleOption(u.options.GENERICBLOCK,!0);break;case u.DOCUMENT_OPTION:this._setUrlFilterRuleOption(u.options.DOCUMENT_WHITELIST,!0),this._setUrlFilterRuleOption(u.options.DOCUMENT,!0);break;case u.POPUP_OPTION:this._setUrlFilterRuleOption(u.options.BLOCK_POPUPS,!0);break;case u.EXTENSION_OPTION:this._setUrlFilterRuleOption(u.options.EXTENSION,!0);break;case u.CSP_OPTION:this._setUrlFilterRuleOption(u.options.CSP_RULE,!0),this.cspDirective=e;break;case u.COOKIE_OPTION:this._setUrlFilterRuleOption(u.options.COOKIE_RULE,!0),this.cookieOption=new O(e);break;case u.REDIRECT_OPTION:if(!T.rules.RedirectFilterService.hasRedirect(e))throw new Error("Unknown redirect source title: "+e);this._setUrlFilterRuleOption(u.options.REDIRECT,!0),this.redirectOption=new s(e);break;case u.REPLACE_OPTION:if(!(T.prefs.features&&T.prefs.features.responseContentFilteringSupported))throw new Error("Unknown option: REPLACE");this._setUrlFilterRuleOption(u.options.REPLACE,!0),this.replaceOption=new o(e);break;case u.REMOVEPARAM_OPTION:case u.QUERYPRUNE_OPTION:this._setUrlFilterRuleOption(u.options.REMOVEPARAM,!0),this.removeparamOption=new r(e);break;case u.BADFILTER_OPTION:this.badFilter=this.ruleText.replace(u.OPTIONS_DELIMITER+u.BADFILTER_OPTION+p.FilterRule.COMA_DELIMITER,u.OPTIONS_DELIMITER).replace(p.FilterRule.COMA_DELIMITER+u.BADFILTER_OPTION,"").replace(u.OPTIONS_DELIMITER+u.BADFILTER_OPTION,"");break;case u.STEALTH_OPTION:this._setUrlFilterRuleOption(u.options.STEALTH,!0);break;default:if(t=t.toUpperCase(),t in u.contentTypes)this._appendPermittedContentType(u.contentTypes[t]);else if(t[0]===p.FilterRule.NOT_MARK&&t.substring(1)in u.contentTypes)this._appendRestrictedContentType(u.contentTypes[t.substring(1)]);else if(!(t in u.ignoreOptions))throw"Unknown option: "+t}}(this.isOptionEnabled(u.options.JSINJECT)||this.isOptionEnabled(u.options.ELEMHIDE)||this.isOptionEnabled(u.options.CONTENT)||this.isOptionEnabled(u.options.URLBLOCK)||this.isOptionEnabled(u.options.BLOCK_POPUPS)||this.isOptionEnabled(u.options.GENERICBLOCK)||this.isOptionEnabled(u.options.GENERICHIDE))&&(this.permittedContentType=u.contentTypes.DOCUMENT,this.documentLevelRule=!0)},u.prototype._appendPermittedContentType=function(t){this.permittedContentType===u.contentTypes.ALL?this.permittedContentType=t:this.permittedContentType|=t},u.prototype._appendRestrictedContentType=function(t){0===this.restrictedContentType?this.restrictedContentType=t:this.restrictedContentType|=t},u.prototype._setUrlFilterRuleOption=function(t,e){if(e){if(!this.whiteListRule&&i(u.options.WHITELIST_OPTIONS,t))throw new Error(t+" cannot be applied to this type of rule");null===this.enabledOptions?this.enabledOptions=t:this.enabledOptions|=t}else null===this.disabledOptions?this.disabledOptions=t:this.disabledOptions|=t},u.OPTIONS_DELIMITER="$",u.DOMAIN_OPTION="domain",u.THIRD_PARTY_OPTION="third-party",u.MATCH_CASE_OPTION="match-case",u.DOCUMENT_OPTION="document",u.ELEMHIDE_OPTION="elemhide",u.GENERICHIDE_OPTION="generichide",u.URLBLOCK_OPTION="urlblock",u.GENERICBLOCK_OPTION="genericblock",u.JSINJECT_OPTION="jsinject",u.CONTENT_OPTION="content",u.POPUP_OPTION="popup",u.IMPORTANT_OPTION="important",u.MASK_REGEX_RULE="/",u.MASK_ANY_SYMBOL="*",u.ANY_URL_REGEX=/.*/,u.EMPTY_OPTION="empty",u.REPLACE_OPTION="replace",u.REMOVEPARAM_OPTION="removeparam",u.QUERYPRUNE_OPTION="queryprune",u.EXTENSION_OPTION="extension",u.CSP_OPTION="csp",u.COOKIE_OPTION="cookie",u.BADFILTER_OPTION="badfilter",u.STEALTH_OPTION="stealth",u.REDIRECT_OPTION="redirect",u.XMLHTTPREQUEST_OPTION="xmlhttprequest",u.STYLESHEET_OPTION="stylesheet",u.SUBDOCUMENT_OPTION="subdocument",u.PING_OPTION="ping",u.contentTypes={OTHER:1,SCRIPT:2,IMAGE:4,STYLESHEET:8,OBJECT:16,SUBDOCUMENT:32,XMLHTTPREQUEST:64,MEDIA:128,FONT:256,WEBSOCKET:512,WEBRTC:1024,DOCUMENT:2048,PING:4096},u.contentTypes.ALL=0;for(const t in u.contentTypes)u.contentTypes.hasOwnProperty(t)&&(u.contentTypes.ALL|=u.contentTypes[t]);u.cookieOptions={MAX_AGE:"maxAge",SAME_SITE:"sameSite"},u.options={ELEMHIDE:1,THIRD_PARTY:2,GENERICHIDE:4,GENERICBLOCK:8,JSINJECT:16,URLBLOCK:32,CONTENT:64,BLOCK_POPUPS:128,MATCH_CASE:256,CSP_RULE:512,COOKIE_RULE:1024,EXTENSION:2048,REPLACE:4096,REMOVEPARAM:8192,STEALTH:16384,REDIRECT:32768,DOCUMENT:65536},u.options.WHITELIST_OPTIONS=u.options.ELEMHIDE|u.options.JSINJECT|u.options.CONTENT|u.options.GENERICHIDE|u.options.GENERICBLOCK|u.options.STEALTH,u.options.DOCUMENT_WHITELIST=u.options.ELEMHIDE|u.options.URLBLOCK|u.options.JSINJECT|u.options.CONTENT,u.options.REMOVEPARAM_COMPATIBLE=u.options.REMOVEPARAM|u.options.THIRD_PARTY|u.options.MATCH_CASE,u.ignoreOptions={BACKGROUND:!0,"~BACKGROUND":!0,COLLAPSE:!0,"~COLLAPSE":!0,"~DOCUMENT":!0,EXTENSION:!0,"~EXTENSION":!0},p.UrlFilterRule=u}(adguard,adguard.rules);