adguard.safebrowsing=function(a,r){const u={get cache(){return a.lazyGet(u,"cache",()=>new a.utils.LruCache("sb-lru-cache"))}},i=new LRUMap(1e3),c="safebrowsing-suspended-from",f=24e5,g="whitelist",h=4;function p(e,t){if(!e||10240<e.length)return null;try{let r;const l=e.split("\n");for(let e=0;e<l.length;e+=1){var n=l[e].split(":"),s=n[2],o=n[0];u.cache.saveValue(s,o),r||t[s]&&(r=o)}return r}catch(e){a.console.error("Error parse safebrowsing response, cause {0}",e)}return null}function b(e){return e===g?null:e}function w(){a.localStorage.setItem(c,Date.now())}function d(e){return r.SHA256.hash(e+"/").toUpperCase()}function v(r){const t=Object.create(null);for(let e=0;e<r.length;e+=1){var n=r[e],s=d(n);t[s]=n}return t}function m(e){const r=[];if(a.utils.url.isIpv4(e)||a.utils.url.isIpv6(e))return r.push(e),r;var t=e.split(".");if(t.length<=2)r.push(e);else for(let e=0;e<=t.length-2;e+=1)r.push(a.utils.strings.join(t,".",e,t.length));return r}function s(e,r,t){var n="pages/blocking-pages/safebrowsing.html";return n+="?malware="+a.utils.strings.contains(t||"malware","malware"),n+="&host="+encodeURIComponent(a.utils.url.getHost(e)),n+="&url="+encodeURIComponent(e),n+="&ref="+encodeURIComponent(r),a.getURL(n)}function e(e,n){const s=a.utils.url.getHost(e);if(s){var r=m(s);if(r&&0!==r.length){var t=function(r){for(let e=0;e<r.length;e+=1){var t=u.cache.getValue(d(r[e]));if(t)return t}return null}(r);if(t)n(b(t));else{e=Date.now(),t=+a.localStorage.getItem(c);if(!(t&&e-t<f)){const o=v(r),l=Object.keys(o);let t=[];for(let e=0;e<l.length;e+=1)t.push(l[e].substring(0,h));t=t.filter(e=>!i.get(e)),0===t.length?(u.cache.saveValue(d(s),g),n(b(g))):a.backend.lookupSafebrowsing(t,e=>{if(500<=e.status)return a.console.error("Error response status {0} received from safebrowsing lookup server.",e.status),void w();a.localStorage.removeItem(c),t.forEach(e=>{i.set(e,!0)});let r=g;204!==e.status&&(r=p(e.responseText,o)||g),u.cache.saveValue(d(s),r),n(b(r))},()=>{a.console.error("Error response from safebrowsing lookup server for {0}",s),w()})}}}}}return{checkSafebrowsingFilter:function(r,t,n){a.settings.safebrowsingInfoEnabled()&&(a.console.debug("Checking safebrowsing filter for {0}",r),e(r,function(e){e?(a.console.debug("Following safebrowsing filter has been fired: {0}",e),n(s(r,t,e))):a.console.debug("No safebrowsing rule found")}))},lookupUrlWithCallback:e,addToSafebrowsingTrusted:function(e){e=a.utils.url.getHost(e);e&&u.cache.saveValue(d(e),g)},getErrorPageURL:s,extractHosts:m,createHashesMap:v,processSbResponse:p}}(adguard,window);