const browser=window.browser||chrome;!function(a,d){"use strict";a.runtime={setUninstallURL:d.runtime.setUninstallURL,onMessage:{addListener(n){a.runtimeImpl.onMessage.addListener((e,r,t)=>{const s=Object.create(null);r.tab&&(s.tab=a.tabsImpl.fromChromeTab(r.tab)),void 0!==r.frameId&&(s.frameId=r.frameId);r=n(e,s,t),e=!0===r;return e||t(r),e})}},get lastError(){return d.runtime.lastError}};const r=function(){const e=d.extension.getURL("");var r=e.indexOf("://");return 0<r?e.substring(0,r):e}();function i(e){return e.tabId===a.BACKGROUND_TAB_ID&&0===e.url.indexOf(r)}const u=document.createElement("a");function c(e){var r={tabId:e.tabId};"websocket"===e.type&&0===e.url.indexOf("http")&&(e.url=e.url.replace(/^http(s)?:/,"ws$1:"));const t={requestUrl:e.url,tab:r,requestId:e.requestId,statusCode:e.statusCode,method:e.method};let s=0,n=0,o;switch(e.type){case"main_frame":s=0,o=a.RequestTypes.DOCUMENT;break;case"sub_frame":s=e.frameId,n=e.parentFrameId,o=a.RequestTypes.SUBDOCUMENT;break;default:n=e.frameId,o=e.type.toUpperCase()}return-1===n&&(n=0),"IMAGESET"===o&&(o=a.RequestTypes.IMAGE),o===a.RequestTypes.OTHER&&(o=function(e){u.href=e,e=u.pathname;let r=a.utils.browser.parseContentTypeFromUrlPath(e);return null===r&&(r=a.RequestTypes.OBJECT),r}(e.url)),o in a.RequestTypes||(o=a.RequestTypes.OTHER),t.frameId=s,t.requestFrameId=n,t.requestType=o,e.requestHeaders&&(t.requestHeaders=e.requestHeaders),e.responseHeaders&&(t.responseHeaders=e.responseHeaders),e.tabId===a.BACKGROUND_TAB_ID&&(t.referrerUrl=e.originUrl||e.initiator),t.originUrl=e.originUrl||e.initiator,e.requestBody&&(t.requestBody=e.requestBody),t}var e={addListener(r,e,t,s){const n={};e&&(n.urls=e),t&&(n.types=t);const o=["blocking"];s&&0<s.length&&s.forEach(e=>{o.push(e)}),d.webRequest.onBeforeRequest.addListener(e=>{if(!i(e)){e=c(e);return r(e)}},n,o)}};const b=["requestHeaders","blocking"],t=["responseHeaders","blocking"];void 0!==d.webRequest.OnBeforeSendHeadersOptions&&d.webRequest.OnBeforeSendHeadersOptions.hasOwnProperty("EXTRA_HEADERS")&&b.push("extraHeaders"),void 0!==d.webRequest.OnHeadersReceivedOptions&&d.webRequest.OnHeadersReceivedOptions.hasOwnProperty("EXTRA_HEADERS")&&t.push("extraHeaders");var s={addListener(r,e){d.webRequest.onHeadersReceived.addListener(e=>{if(!i(e)){e=c(e),e=r(e);return e?"responseHeaders"in e?{responseHeaders:e.responseHeaders}:{}:void 0}},e?{urls:e}:{},t)}},n={addListener(r,e){let t={};if("Chrome"===a.prefs.browser&&a.prefs.chromeVersion<85){const n=["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","csp_report","media","websocket","other"],o=["stylesheet","script","media"];var s=n.filter(e=>!o.includes(e));t=Object.assign(t,{types:s})}e&&(t=Object.assign(t,{urls:e})),d.webRequest.onBeforeSendHeaders.addListener(e=>{if(!i(e)){e=c(e),e=r(e);return e?"requestHeaders"in e?{requestHeaders:e.requestHeaders}:{}:void 0}},t,b)}},o={addListener(r,e){d.webRequest.onResponseStarted.addListener(e=>{if(!i(e)){e=c(e);return r(e)}},e?{urls:e}:{},["responseHeaders"])}},l={addListener(r,e){d.webRequest.onErrorOccurred.addListener(e=>{if(!i(e)){e=c(e);return r(e)}},e?{urls:e}:{})}},p={addListener(r,e){d.webRequest.onCompleted.addListener(e=>{if(!i(e)){e=c(e);return r(e)}},e?{urls:e}:{},["responseHeaders"])}},g={addListener(t,e){d.webRequest.onBeforeRedirect.addListener(e=>{if(!i(e)){const r=c(e);return r.redirectUrl=e.redirectUrl,t(r)}},e?{urls:e}:{})}};a.getURL=d.runtime.getURL,a.backgroundPage={},a.backgroundPage.getWindow=function(){return d.extension.getBackgroundPage()},a.app={getId(){return d.runtime.id},getUrlScheme(){const e=a.getURL("test.html");var r=e.indexOf("://");return e.substring(0,r)},getVersion(){return d.runtime.getManifest().version},getLocale(){return d.i18n.getUILanguage()},getExtensionUrl(){const e=a.getURL("");return e.substring(0,e.length-1)},isOwnRequest(e){return e&&0===e.indexOf(this.getExtensionUrl())}},a.webRequest={onBeforeRequest:e,handlerBehaviorChanged:d.webRequest.handlerBehaviorChanged,onCompleted:p,onErrorOccurred:l,onHeadersReceived:s,onBeforeSendHeaders:n,onResponseStarted:o,onBeforeRedirect:g,webSocketSupported:void 0!==d.webRequest.ResourceType&&"websocket"===d.webRequest.ResourceType.WEBSOCKET,filterResponseData:d.webRequest.filterResponseData},a.webNavigation={onCreatedNavigationTarget:{addListener(r){void 0!==d.webNavigation.onCreatedNavigationTarget&&d.webNavigation.onCreatedNavigationTarget.addListener(e=>{e.tabId!==a.BACKGROUND_TAB_ID&&r({tabId:e.tabId,sourceTabId:e.sourceTabId,url:e.url})})}},onCommitted:{addListener(r){d.webNavigation.onCommitted.addListener(e=>{e.requestType=0===e.frameId?a.RequestTypes.DOCUMENT:a.RequestTypes.SUBDOCUMENT,e.tab={tabId:e.tabId},e.requestUrl=e.url,r(e)},{url:[{urlPrefix:"http"},{urlPrefix:"https"}]})}},onDOMContentLoaded:d.webNavigation.onDOMContentLoaded};const R=void 0!==d.browserAction.setIcon;!R&&d.browserAction.onClicked&&d.browserAction.onClicked.addListener(()=>{a.ui.openSettingsTab()}),a.browserAction={setBrowserAction(e,r,t,s,n){if(R){const o=e["tabId"];delete r.tabId,d.runtime.lastError||d.browserAction.setIcon({tabId:o,path:r},function(){d.runtime.lastError||(d.browserAction.setBadgeText({tabId:o,text:t}),d.runtime.lastError||t&&d.browserAction.setBadgeBackgroundColor({tabId:o,color:s}))})}},setPopup(){},resize(){},close(){}},a.contextMenus=d.contextMenus}(adguard,browser);