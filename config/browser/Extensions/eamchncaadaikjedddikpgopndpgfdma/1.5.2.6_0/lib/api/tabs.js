adguard.windowsImpl=function(e){"use strict";function o(e){return{windowId:e.id,type:"normal"===e.type||"popup"===e.type?e.type:"other"}}var n,t;void 0===browser.windows&&(browser.windows=(n={id:1,type:"normal"},{onCreated:t={addListener:function(){}},onRemoved:t,onFocusChanged:t,create:function(e,t){t(n)},update:function(e,t,n){n()},getAll:function(e,t){t(n)},getLastFocused:function(e){e(n)}}));var r=e.utils.channels.newChannel(),s=e.utils.channels.newChannel(),e=e.utils.channels.newChannel();browser.windows.onCreated.addListener(function(e){r.notify(o(e),e)}),browser.windows.onRemoved.addListener(function(e){s.notify(e)});return{onCreated:r,onRemoved:s,onUpdated:e,create:function(e,t){browser.windows.create(e,function(e){t(o(e),e)})},getLastFocused:function(t){browser.windows.getLastFocused(function(e){t(e.id)})},forEachNative:function(r){browser.windows.getAll({},function(e){for(var t=0;t<e.length;t++){var n=e[t];r(n,o(n))}})}}}(adguard),adguard.tabsImpl=function(a){"use strict";function o(e){return parseInt(e)}function s(e){var t=browser.runtime.lastError;return t&&a.console.error("Error while executing operation{1}: {0}",t,e?" '"+e+"'":""),t}function u(e){return{tabId:e.id,url:e.url,title:e.title,incognito:e.incognito,status:e.status}}var t=a.utils.channels.newChannel();browser.tabs.onCreated.addListener(function(e){t.notify(u(e))});var n=a.utils.channels.newChannel();browser.tabs.onRemoved.addListener(function(e){n.notify(e)});var r=a.utils.channels.newChannel();browser.tabs.onUpdated.addListener(function(e,t,n){r.notify(u(n))});var i=a.utils.channels.newChannel();function d(t,n,r){w(function(e){t!==e&&browser.windows.update(n,{focused:!0},function(){s("Update window "+n)||r()}),r()})}browser.tabs.onActivated.addListener(function(e){i.notify(e.tabId)}),browser.windows.onFocusChanged.addListener(function(e){e!==browser.windows.WINDOW_ID_NONE&&w(i.notify)});function c(e,t,n,r){"object"==typeof r&&browser.tabs.sendMessage?browser.tabs.sendMessage(o(e),t,r,n):(browser.tabs.sendMessage||browser.tabs.sendRequest)(o(e),t,n)}var w=function(t){browser.tabs.query({currentWindow:!0,active:!0},function(e){e&&0<e.length&&t(e[0].id)})};function b(){a.runtime.lastError}let f=!0;var e=browser.tabs.insertCSS?function(t,e,n){const r={code:n,runAt:"document_start",frameId:e,matchAboutBlank:!0};f&&(r.cssOrigin="user");try{browser.tabs.insertCSS(t,r,b)}catch(e){t=e.message||e;/\bcssOrigin\b/.test(t)&&(f=!1)}}:void 0,l=browser.tabs.executeScript?function(e,t,n){browser.tabs.executeScript(e,{code:n,frameId:t,runAt:"document_start",matchAboutBlank:!0},b)}:void 0,p=browser.tabs.executeScript?(e,t,n)=>{var{file:r,frameId:t=0}=t;const o={file:r,runAt:"document_start"};0!==t&&(o.frameId=t),browser.tabs.executeScript(e,o,()=>{b(),n&&n()})}:void 0;return{onCreated:t,onRemoved:n,onUpdated:r,onActivated:i,create:function(e,t){var n,r=e.url,o=!0===e.active;function s(e){browser.tabs.create({windowId:a.prefs.mobile?void 0:e.id,url:r,active:o},function(e){o&&d(e.id,e.windowId,function(){}),t(u(e))})}function i(e){return"normal"===e.type&&(n||!e.incognito)}"popup"!==e.type||a.utils.browser.isEdgeBeforeCreatorsUpdate()||a.prefs.mobile?(n=0===r.indexOf("http"),browser.windows.getLastFocused(function(e){i(e)?s(e):browser.windows.getAll({},function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];if(i(n))return void s(n)}browser.windows.create({},s)})})):browser.windows.create({url:r,type:"popup",width:1230,height:630},t)},remove:function(e,t){browser.tabs.remove(o(e),function(){s()||t(e)})},activate:function(t,n){browser.tabs.update(o(t),{active:!0},function(e){s("Before tab update")||d(t,e.windowId,function(){n(t)})})},reload:function(e,t){t?a.utils.browser.isEdgeBrowser()?setTimeout(function(){c(e,{type:"update-tab-url",url:t})},100):browser.tabs.update(o(e),{url:t},s):browser.tabs.reload?browser.tabs.reload(o(e),{bypassCache:!0},s):c(e,{type:"no-cache-reload"})},sendMessage:c,getAll:function(o){browser.tabs.query({},function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(u(r))}o(t)})},getActive:w,get:function(e,t){browser.tabs.get(o(e),function(e){browser.runtime.lastError||t(u(e))})},updateUrl:(e,t)=>{0!==e&&browser.tabs.update(e,{url:t},b)},insertCssCode:e,executeScriptCode:l,executeScriptFile:p,fromChromeTab:u}}(adguard);