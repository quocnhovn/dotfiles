!function(){var p=[].slice,s="pending",a="resolved",h="rejected",e=function(n,e){return null!=n?n.hasOwnProperty(e):void 0},r=function(n){return e(n,"length")&&e(n,"callee")},y=function(n){return e(n,"promise")&&"function"==typeof(null!=n?n.promise:void 0)},d=function(n){return r(n)?d(Array.prototype.slice.call(n)):Array.isArray(n)?n.reduce(function(n,e){return Array.isArray(e)?n.concat(d(e)):(n.push(e),n)},[]):[n]},l=function(n,e){return n<=0?e():function(){if(--n<1)return e.apply(this,arguments)}},i=function(e,r){return function(){var n=[e].concat(Array.prototype.slice.call(arguments,0));return r.apply(this,n)}},v=function(n,e,r){for(var t,o=d(n),i=[],u=0,l=o.length;u<l;u++)t=o[u],i.push(t.call.apply(t,[r].concat(p.call(e))));return i},g=function(){var t,r,o=s,u=[],l=[],c=[],f={resolved:{},rejected:{},pending:{}};return this.promise=function(i){var n;return(i=i||{}).state=function(){return o},i.done=(n=function(n,e,r){return function(){return o===s&&e.push.apply(e,d(arguments)),n()&&v(arguments,f[r]),i}})(function(){return o===a},u,a),i.fail=n(function(){return o===h},l,h),i.progress=n(function(){return o!==s},c,s),i.always=function(){var n;return(n=i.done.apply(i,arguments)).fail.apply(n,arguments)},i.pipe=n=function(n,e,r){var t=new g,o=function(n,e,r){return r?i[n](function(){var n=1<=arguments.length?p.call(arguments,0):[],n=r.apply(null,n);return y(n)?n.done(t.resolve).fail(t.reject).progress(t.notify):t[e](n)}):i[n](t[e])};return o("done","resolve",n),o("fail","reject",e),o("progress","notify",r),t},i.then=n,null==i.promise&&(i.promise=function(){return i}),i},this.promise(this),(t=this).resolve=(r=function(n,e,r){return function(){return o===s?(f[o=n]=arguments,v(e,f[n],r),t):this}})(a,u),this.reject=r(h,l),this.notify=r(s,c),this.resolveWith=function(n,e){return r(a,u,n).apply(null,e)},this.rejectWith=function(n,e){return r(h,l,n).apply(null,e)},this.notifyWith=function(n,e){return r(s,c,n).apply(null,e)},this},t=function(){var n,r,e,t,o,i,u=Array.prototype.slice.apply(arguments);if(1===u.length)return y(u[0])?u[0]:(new g).resolve(u[0]).promise();if(i=new g,!u.length)return i.resolve().promise();for(o=[],r=l(u.length,function(){return i.resolve.apply(i,o)}),u.forEach(function(n,e){return y(n)?n.done(function(){var n=1<=arguments.length?p.call(arguments,0):[];return o[e]=1<n.length?n:n[0],r()}):(o[e]=n,r())}),e=0,t=u.length;e<t;e++)n=u[e],y(n)&&n.fail(i.reject);return i.promise()},n=function(n){return n.Deferred=function(){return new g},n.ajax=i(n.ajax,function(n,e){var r,t,o;return null==e&&(e={}),t=new g,e.success=(r=function(n,r){return i(n,function(){var n=arguments[0],e=2<=arguments.length?p.call(arguments,1):[];return n&&n.apply(null,e),r.apply(null,e)})})(e.success,t.resolve),e.error=r(e.error,t.reject),o=n(e),(t=t.promise()).abort=function(){return o.abort()},t}),n.when=t};"undefined"!=typeof exports?(exports.Deferred=function(){return new g},exports.when=t,exports.installInto=n):"function"==typeof define&&define.amd?define(function(){return"undefined"!=typeof Zepto?n(Zepto):(g.when=t,g.installInto=n,g)}):"undefined"!=typeof Zepto?n(Zepto):(this.Deferred=function(){return new g},this.Deferred.when=t,this.Deferred.installInto=n)}.call(this);