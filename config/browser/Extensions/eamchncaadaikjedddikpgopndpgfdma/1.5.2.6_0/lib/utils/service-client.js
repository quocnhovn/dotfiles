adguard.backend=function(i){"use strict";const a={get backendUrl(){return"https://chrome.adtidy.org"},get apiKey(){return"4DDBE80A3DA94D819A00523252FB6380"},get filtersUrl(){return i.lazyGet(this,"filtersUrl",()=>i.utils.browser.isFirefoxBrowser()?"https://filters.adtidy.org/extension/firefox":i.utils.browser.isEdgeBrowser()?"https://filters.adtidy.org/extension/edge":i.utils.browser.isOperaBrowser()?"https://filters.adtidy.org/extension/opera":"https://filters.adtidy.org/extension/chromium")},get filterRulesUrl(){return this.filtersUrl+"/filters/{filter_id}.txt"},get optimizedFilterRulesUrl(){return this.filtersUrl+"/filters/{filter_id}_optimized.txt"},get filtersMetadataUrl(){const e=i.utils.browser.getExtensionParams();return this.filtersUrl+"/filters.js?"+e.join("&")},get reportUrl(){return this.backendUrl+"/url-report.html"},get ruleStatsUrl(){return this.backendUrl+"/rulestats.html"},get safebrowsingLookupUrl(){return i.uos.getTrackInfoApi()},get localFiltersFolder(){return"filters"},get redirectSourcesFolder(){return"lib/filter/rules/scriptlets"},get localFilterIds(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}},n={adguard:!0,adguard_ext_chromium:i.utils.browser.isChromium(),adguard_ext_firefox:i.utils.browser.isFirefoxBrowser(),adguard_ext_edge:i.utils.browser.isEdgeBrowser(),adguard_ext_safari:!1,adguard_ext_opera:i.utils.browser.isOperaBrowser()},s=Object.create(null);function d(e,t,r,o){const s=new XMLHttpRequest;try{var n;s.open("GET",e),s.setRequestHeader("Content-type",t),s.setRequestHeader("Pragma","no-cache"),s.overrideMimeType(t),s.mozBackgroundRequest=!0,r&&(s.onload=function(){r(s)}),o&&(n=function(){o(s)},s.onerror=n,s.onabort=n,s.ontimeout=n),s.send(null)}catch(e){o&&o(s,e)}}function l(e){return e+"&key="+a.apiKey}function c(e){try{return JSON.parse(e)}catch(e){return i.console.error("Error parse json {0}",e),null}}const u=(e,t,r)=>{r=`
        error:                    ${e}
        requested url:            ${t}
        request status text:      `+r.statusText;return new Error(r)};return{loadFiltersMetadata:(s,n,l)=>{s&&0!==s.length?d(a.filtersMetadataUrl,"application/json",e=>{if(e&&e.responseText){var t=c(e.responseText);if(t){const o=[];for(let e=0;e<s.length;e+=1){var r=i.utils.collections.find(t.filters,"filterId",s[e]);r&&o.push(i.subscriptions.createSubscriptionFilterFromJSON(r))}n(o)}else l(e,"invalid response")}else l(e,"empty response")},l):n([])},loadFilterRules:(e,t,r)=>{let o;var s;return t||a.localFilterIds.indexOf(e)<0?o=(s=e,t=(t=r)?a.optimizedFilterRulesUrl:a.filterRulesUrl,i.utils.strings.replaceAll(t,"{filter_id}",s)):(o=i.getURL(a.localFiltersFolder+`/filter_${e}.txt`),r&&(o=i.getURL(a.localFiltersFolder+`/filter_mobile_${e}.txt`))),FilterDownloader.download(o,n)},loadFilterRulesBySubscriptionUrl:function(t,r,o){t in s||(s[t]=!0,FilterDownloader.download(t,n).then(function(e){delete s[t],0===e[0].indexOf("[")&&e.shift(),r(e)},function(e){delete s[t];e=e instanceof Error?e.message:e;o(e)}))},loadLocalFiltersMetadata:()=>new Promise((r,o)=>{const s=i.getURL(a.localFiltersFolder+"/filters.json");d(s,"application/json",function(e){var t;e&&e.responseText?(t=c(e.responseText))?r(t):o(u("invalid response",s,e)):o(u("empty response",s,e))},(e,t)=>{t=t&&t.message||"couldn't load local filters metadata";o(u(t,s,e))})}),loadLocalFiltersI18Metadata:()=>new Promise((r,o)=>{const s=i.getURL(a.localFiltersFolder+"/filters_i18n.json");d(s,"application/json",function(e){var t;e&&e.responseText?(t=c(e.responseText))?r(t):o(u("invalid response",s,e)):o(u("empty response",s,e))},(e,t)=>{t=t&&t.message||"couldn't load local filters i18n metadata";o(u(t,s,e))})}),loadLocalScriptRules:()=>new Promise((r,o)=>{const s=i.getURL(a.localFiltersFolder+"/local_script_rules.json");d(s,"application/json",e=>{var t;e&&e.responseText?(t=c(e.responseText))?r(t):o(u("invalid response",s,e)):o(u("empty response",s,e))},(e,t)=>{t=t&&t.message||"couldn't load local script rules";o(u(t,s,e))})}),loadRedirectSources:()=>new Promise((t,r)=>{const o=i.getURL(a.redirectSourcesFolder)+"/redirects.yml";d(o,"application/x-yaml",e=>{e&&e.responseText?t(e.responseText):r(u("empty response",o,e))},(e,t)=>{t=t&&t.message||"couldn't load redirect sources";r(u(t,o,e))})}),lookupSafebrowsing:function(e,t,r){d(a.safebrowsingLookupUrl+"/"+encodeURIComponent(e.join(",")),"application/json",t,r)},sendUrlReport:function(e,t,r){let o="url="+encodeURIComponent(e);o+="&messageType="+encodeURIComponent(t),r&&(o+="&comment="+encodeURIComponent(r)),o=l(o);const s=new XMLHttpRequest;s.open("POST",a.reportUrl),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(o)},sendHitStats:function(e,t){let r="stats="+encodeURIComponent(e);if(r+="&v="+encodeURIComponent(i.app.getVersion()),r+="&b="+encodeURIComponent(i.prefs.browser),t)for(let e=0;e<t.length;e++){var o=t[e];r+="&f="+encodeURIComponent(o.filterId+","+o.version)}r=l(r);const s=new XMLHttpRequest;s.open("POST",a.ruleStatsUrl),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(r)},getResponseHeaders:function(t,r){d(t,"text/plain",e=>{const t=e.getAllResponseHeaders().trim().split(/[\r\n]+/);e=t.map(e=>{const t=e.split(": ");return{name:t.shift(),value:t.join(": ")}});r(e)},e=>{i.console.error("Error retrieved response from {0}, cause: {1}",t,e.statusText),r(null)})},configure:function(e){const t=e["filtersMetadataUrl"];t&&Object.defineProperty(a,"filtersMetadataUrl",{get(){return t}});const r=e["filterRulesUrl"];r&&Object.defineProperty(a,"filterRulesUrl",{get(){return r}});const o=e["localFiltersFolder"];o&&Object.defineProperty(a,"localFiltersFolder",{get(){return o}});const s=e["redirectSourcesFolder"];s&&Object.defineProperty(a,"redirectSourcesFolder",{get(){return s}});const n=e["localFilterIds"];n&&Object.defineProperty(a,"localFilterIds",{get(){return n}})}}}(adguard);